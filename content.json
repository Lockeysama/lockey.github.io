[{"title":"æ“ä½œç³»ç»ŸåŸºç¡€","date":"2020-04-22T09:12:30.000Z","path":"2020/04/22/åŸºç¡€/æ“ä½œç³»ç»ŸåŸºç¡€/","text":"æ¦‚å¿µ è¿›ç¨‹åœ°å€ç©ºé—´ï¼ˆè¿›ç¨‹è™šæ‹Ÿåœ°å€ï¼‰ ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´ï¼ˆLinuxï¼‰ å†…æ ¸å¯ä»¥è®¿é—®å—ä¿æŠ¤å†…å­˜ç©ºé—´ï¼Œä¹Ÿæœ‰è®¿é—®åº•å±‚æ‰€æœ‰è®¾å¤‡çš„æƒé™ ä¸ºäº†ä¿è¯å†…æ ¸å®‰å…¨ï¼ˆä¿è¯ç”¨æˆ·è¿›ç¨‹ä¸èƒ½ç›´æ¥æ“ä½œå†…æ ¸ï¼‰ï¼Œå°†è™šæ‹Ÿç©ºé—´åˆ’åˆ†ä¸ºç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ 32ä½æ“ä½œç³»ç»Ÿï¼š2^32 = 4GBï¼›å†…æ ¸ç©ºé—´ 1GBï¼ˆä»è™šæ‹Ÿåœ°å€0xC0000000åˆ°0xFFFFFFFFï¼‰ï¼Œç”¨æˆ·ç©ºé—´ 3GBï¼ˆä»è™šæ‹Ÿåœ°å€0x00000000åˆ°0xBFFFFFFFï¼‰ 64ä½æ“ä½œç³»ç»Ÿï¼š2^48ï¼ˆä¸éœ€è¦64é‚£ä¹ˆå¤§ã€è¿‡å¤§ä¼šå¯¼è‡´èµ„æºæµªè´¹ï¼‰ = 256Tï¼›å†…æ ¸ã€ç”¨æˆ·ç©ºé—´åˆ†åˆ«å 128T è¿›ç¨‹åˆ‡æ¢ï¼ˆä»»ä½•è¿›ç¨‹éƒ½åœ¨æ“ä½œç³»ç»Ÿçš„å†…æ ¸æ”¯æŒä¸‹è¿è¡Œï¼‰ å¯ä»¥æŒ‚èµ·åœ¨ CPU ä¸Šè¿è¡Œçš„è¿›ç¨‹ ä¿å­˜ä¸Šä¸‹æ–‡ï¼ˆè®¡æ•°å™¨ã€å¯„å­˜å™¨ç­‰ï¼‰ æ›´æ–° PCBï¼ˆè¿›ç¨‹æ§åˆ¶å—ï¼‰ä¿¡æ¯ æŠŠè¿›ç¨‹ PCB ç§»å…¥ç›¸åº”çš„é˜Ÿåˆ—ï¼ˆå°±ç»ªã€åœ¨æŸäº‹ä»¶é˜»å¡ç­‰é˜Ÿåˆ—ï¼‰ å¯ä»¥æ¢å¤ä»¥å‰æŒ‚èµ·çš„è¿›ç¨‹ é€‰æ‹©ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œï¼Œæ›´æ–°å…¶ PCB æ›´æ–°å†…å­˜ç®¡ç†çš„æ•°æ®ç»“æ„ æ¢å¤ä¸Šä¸‹æ–‡ è¿›ç¨‹é˜»å¡ã€å”¤é†’ è¿›ç¨‹çŠ¶æ€ è¿è¡Œæ€ï¼šè¿›ç¨‹è·å¾— CPU å¹¶è¿è¡Œ å°±ç»ªæ€ï¼šè¿›ç¨‹å…·å¤‡è¿è¡Œæ¡ä»¶ï¼Œä½†å°šæœªè·å¾— CPU é˜»å¡æ€ï¼šè¿›ç¨‹å› ç­‰å¾…æŸäº‹ä»¶å‘ç”Ÿè€Œæš‚æ—¶ä¸èƒ½è¿è¡Œ æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œç”±äºæå‡ºç³»ç»ŸæœåŠ¡è¯·æ±‚ï¼ˆå¦‚ I/O æ“ä½œï¼‰æœªå¾—åˆ°ç³»ç»Ÿçš„ç«‹å³å“åº”ï¼Œè¯¥è¿›ç¨‹ä¼šè°ƒç”¨é˜»å¡åŸè¯­æŠŠè‡ªå·±é˜»å¡ï¼Œç­‰å¾…ç›¸åº”äº‹ä»¶å‡ºç°åè¢«å”¤é†’ åªæœ‰å¤„äºè·å¾— CPU çš„è¿›ç¨‹æ‰èƒ½å°†å…¶è½¬æ¢ä¸ºé˜»å¡çŠ¶æ€ é˜»å¡ è¯·æ±‚ç³»ç»ŸæœåŠ¡ã€I/O æ“ä½œç­‰æœªå¾—åˆ°å³æ—¶å“åº” æ‰¾åˆ°è¦è¢«é˜»å¡è¿›ç¨‹çš„æ ‡è¯†å·å¯¹åº”çš„ PCB åœæ­¢æ‰§è¡Œ è‹¥è¯¥è¿›ç¨‹ä¸ºè¿è¡ŒçŠ¶æ€ï¼ˆè·å¾— CPUï¼‰ï¼Œåˆ™ä¿æŠ¤ç°åœºï¼Œæ”¹å˜çŠ¶æ€ä¸ºé˜»å¡çŠ¶æ€ æŠŠ PCB æ’å…¥ç›¸åº”é˜»å¡é˜Ÿåˆ— å”¤é†’ é˜»å¡åŸå› æœŸå¾…çš„äº‹ä»¶å‡ºç° æŠŠè¢«é˜»å¡çš„è¿›ç¨‹ç§»å‡ºé˜»å¡é˜Ÿåˆ— å°† PCB çŠ¶æ€æ”¹ä¸ºå°±ç»ªçŠ¶æ€ å°† PCB æ’å…¥åˆ°å°±ç»ªé˜Ÿåˆ—ä¸­ æ–‡ä»¶æè¿°ç¬¦ï¼ˆFDï¼‰ï¼ˆé€‚ç”¨äº Unixã€Linuxï¼›Windows ä¸­é€šå¸¸å« Handleï¼‰ åœ¨ Linux ä¸­ï¼Œä¸€åˆ‡çš†æ–‡ä»¶ å¯¹æ‰€æœ‰æ–‡ä»¶ï¼ˆç›®å½•ã€å­—ç¬¦è®¾å¤‡ã€å—è®¾å¤‡ã€å¥—æ¥å­—ã€æ‰“å°æœºã€è¿›ç¨‹ã€çº¿ç¨‹ã€ç®¡é“ç­‰ï¼‰æ“ä½œï¼Œè¯»å†™éƒ½å¯ç”¨fopen()/fclose()/fwrite()/fread()ç­‰å‡½æ•°è¿›è¡Œå¤„ç† ç”¨äºè¡¨è¿°æŒ‡å‘æ–‡ä»¶çš„å¼•ç”¨çš„æŠ½è±¡åŒ–æ¦‚å¿µ æ ‡å‡†æ–‡ä»¶æè¿°ç¬¦ 0ï¼šæ ‡å‡†è¾“å…¥ï¼›1ï¼šæ ‡å‡†è¾“å‡ºï¼›2ï¼šæ ‡å‡†é”™è¯¯ ç¼“å­˜ I/Oï¼ˆæ ‡å‡†I/Oï¼‰ å·¥ä½œè¿‡ç¨‹ Linux ä¸­ï¼Œæ“ä½œç³»ç»Ÿä¼šå°† I/O çš„æ•°æ®ç¼“å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿçš„é¡µç¼“å­˜ä¸­ æ•°æ®å…ˆè¢«æ‹·è´åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸ç¼“å†²åŒºä¸­ å†ä»å†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ°åº”ç”¨ç¨‹åºåœ°å€ç©ºé—´ ç¼ºç‚¹ï¼šå¼€é”€å¤§ åŸºäºç¼“å­˜ I/O å‡ºç°çš„æ¨¡å‹ é˜»å¡ I/O éé˜»å¡ I/O I/O å¤šè·¯å¤ç”¨ ä¿¡å·é©±åŠ¨ I/Oï¼ˆä¸å¸¸ç”¨ï¼‰ å¼‚æ­¥ I/O IOå¤šè·¯å¤ç”¨åŸç†å‰–æ","tags":[{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"http://www.lockey.xyz/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"}]},{"title":"å†…æ ¸ç½‘ç»œæ•°æ®æ”¶å‘æµç¨‹","date":"2020-04-22T09:10:26.000Z","path":"2020/04/22/åŸºç¡€/å†…æ ¸ç½‘ç»œæ•°æ®æ”¶å‘æµç¨‹/","text":"å‰ç½®åŸºç¡€ â†’ æ“ä½œç³»ç»ŸåŸºç¡€ â† â†’ Linuxå†…æ ¸ä¸­æ–­ â† ç½‘å¡ï¼ˆNICï¼‰ ç½‘å¡æ˜¯ä¸€å—è¢«è®¾è®¡ç”¨æ¥å…è®¸è®¡ç®—æœºåœ¨è®¡ç®—æœºç½‘ç»œä¸Šè¿›è¡Œé€šè®¯çš„è®¡ç®—æœºç¡¬ä»¶ã€‚ç”±äºå…¶æ‹¥æœ‰ MAC åœ°å€ï¼Œå› æ­¤å±äº OSI æ¨¡å‹çš„ç¬¬ 2 å±‚ã€‚å®ƒä½¿å¾—ç”¨æˆ·å¯ä»¥é€šè¿‡ç”µç¼†æˆ–æ— çº¿ç›¸äº’è¿æ¥ã€‚æ¯ä¸€ä¸ªç½‘å¡éƒ½æœ‰ä¸€ä¸ªè¢«ç§°ä¸º MAC åœ°å€çš„ç‹¬ä¸€æ— äºŒçš„48ä½ä¸²è¡Œå·ï¼Œå®ƒè¢«å†™åœ¨å¡ä¸Šçš„ä¸€å— ROM ä¸­ã€‚åœ¨ç½‘ç»œä¸Šçš„æ¯ä¸€ä¸ªè®¡ç®—æœºéƒ½å¿…é¡»æ‹¥æœ‰ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ MAC åœ°å€ã€‚æ²¡æœ‰ä»»ä½•ä¸¤å—è¢«ç”Ÿäº§å‡ºæ¥çš„ç½‘å¡æ‹¥æœ‰åŒæ ·çš„åœ°å€ã€‚è¿™æ˜¯å› ä¸ºç”µæ°”ç”µå­å·¥ç¨‹å¸ˆåä¼šï¼ˆIEEEï¼‰è´Ÿè´£ä¸ºç½‘ç»œæ¥å£æ§åˆ¶å™¨ï¼ˆç½‘å¡ï¼‰é”€å”®å•†åˆ†é…å”¯ä¸€çš„ MAC åœ°å€ã€‚ ç½‘å¡é©±åŠ¨ é©±åŠ¨ç¨‹åºï¼ˆDevice Driverï¼‰å…¨ç§°ä¸ºâ€œè®¾å¤‡é©±åŠ¨ç¨‹åºâ€ï¼Œæ˜¯ä¸€ç§å¯ä»¥ä½¿è®¡ç®—æœºä¸­å¤®å¤„ç†å™¨â€”â€” CPU æ§åˆ¶å’Œä½¿ç”¨è®¾å¤‡çš„ç‰¹æ®Šç¨‹åºï¼Œç›¸å½“äºç¡¬ä»¶çš„æ¥å£ï¼Œæ“ä½œç³»ç»Ÿé€šè¿‡è¿™ä¸ªæ¥å£ï¼Œæ§åˆ¶ç¡¬ä»¶è®¾å¤‡çš„å·¥ä½œã€‚æ‰€æœ‰çš„ç¡¬ä»¶éƒ½è¦å®‰è£…é©±åŠ¨ç¨‹åºï¼Œæ²¡æœ‰é©±åŠ¨ç¨‹åºçš„ç¡¬ä»¶æ˜¯è¿è¡Œä¸äº†çš„ï¼Œå°±åƒä¸€è¾†æœ‰è½®èƒä½†æ˜¯æ²¡æœ‰ä¼ åŠ¨è½´çš„æ±½è½¦ä¸€æ ·è·‘ä¸èµ·æ¥ï¼Œæ§åˆ¶ä¸äº†ã€‚å‡å¦‚æŸè®¾å¤‡çš„é©±åŠ¨ç¨‹åºæœªèƒ½æ­£ç¡®å®‰è£…ï¼Œä¾¿ä¸èƒ½æ­£å¸¸å·¥ä½œã€‚ ã€Œç½‘å¡é©±åŠ¨ã€ç¨‹åºå°±æ˜¯ CPU æ§åˆ¶å’Œä½¿ç”¨ç½‘å¡çš„ç¨‹åºã€‚ ç½‘å¡é©±åŠ¨å¤„ç†æ•°æ®çš„æ–¹å¼ NAPIï¼ˆä¸»æµï¼‰ NAPI æ˜¯ã€Œä¸­æ–­ã€å’Œã€Œè½®è¯¢ã€çš„ç»“åˆä½“ï¼Œé¿å¼€äº†å•è½®è¯¢çš„æ— æ•ˆåšåŠŸå’Œå•ä¸­æ–­çš„æ•°æ®é‡å¤§æ—¶é¢‘ç¹ä¸­æ–­çš„æ¶ˆè€—ã€‚åœ¨æ•°æ®é‡å°‘æ˜¯ä½¿ç”¨ä¸­æ–­ï¼Œæ•°æ®é‡å¤šæ—¶ä½¿ç”¨è½®è¯¢ã€‚å¹³æ—¶æ˜¯ä¸­æ–­æ¨¡å¼ï¼Œå½“æœ‰æ•°æ®åˆ°è¾¾æ—¶ï¼Œä¼šè§¦å‘ä¸­æ–­å¤„ç†å‡½æ•°ï¼Œä¸­æ–­å¤„ç†å‡½æ•°å…³é—­ä¸­æ–­å¼€å§‹å¤„ç†ï¼Œæ­¤æ—¶å†æœ‰æ•°æ®è¿‡æ¥ï¼Œå°±ä¸ä¼šè§¦å‘ä¸­æ–­ï¼Œå› ä¸ºä¸­æ–­å¤„ç†å‡½æ•°ä¸­ä¼šé‡‡ç”¨è½®è¯¢çš„æ–¹å¼å¤„ç†æ•°æ®ï¼Œç›´åˆ°æ²¡æœ‰æ–°æ•°æ®æ‰é‡æ–°æ‰“å¼€ä¸­æ–­ã€‚ NAPI çš„ç¼ºé™· ä¸èƒ½åŠæ—¶å¤„ç†æ•°æ®åŒ… æ•°æ®åˆ°è¾¾é€Ÿåº¦å¢åŠ ä¼šä½¿å†…å­˜æ¶ˆè€—å¢åŠ  åœ¨å¤§æ•°æ®åŒ…ï¼Œä½†æ˜¯ä½é€Ÿçš„æƒ…å†µä¸‹ï¼Œæ¥æ”¶ä¸­æ–­ä¼šæ€¥å‰§å¢åŠ ï¼Œé€ æˆæ•ˆç‡æ€¥å‰§ä¸‹é™ æ”¶åŒ…æµç¨‹ ç½‘å¡åˆ°å†…å­˜ æ•°æ®åŒ…ä»ç½‘ç»œè¿›å…¥ç½‘å¡ ç›®æ ‡åœ°å€æ˜¯æœ¬ç½‘å¡ï¼šè·³è½¬åˆ° 1.2 ç›®æ ‡åœ°å€ä¸æ˜¯æœ¬ç½‘å¡ å¼€å¯æ··æ‚æ¨¡å¼ï¼šè·³è½¬åˆ° 1.2 æœªå¼€å§‹æ··æ‚é­”å…½ï¼šä¸¢å¼ƒè¯¥ç½‘ç»œåŒ… ç½‘å¡å°†æ•°æ®åŒ…é€šè¿‡ DMAï¼ˆDirect Memory Accessï¼Œç›´æ¥å­˜å‚¨å™¨è®¿é—®ï¼‰æ–¹å¼å†™å…¥æŒ‡å®šå†…å­˜åœ°å€ï¼ˆè¯¥åœ°å€ç”±ç½‘å¡é©±åŠ¨åˆ†é…å¹¶åˆå§‹åŒ–ï¼‰ ç½‘å¡é€šè¿‡ IRQï¼ˆç¡¬ä»¶ä¸­æ–­ï¼‰é€šçŸ¥ CPU CPU æ ¹æ®ä¸­æ–­è¡¨ï¼Œè°ƒç”¨å·²æ³¨å†Œçš„ä¸­æ–­å‡½æ•°ï¼ˆä¸­æ–­å‡½æ•°ä¼šè°ƒç”¨é©±åŠ¨ä¸­ç›¸åº”çš„å‡½æ•°ï¼‰ é©±åŠ¨å…ˆç¦ç”¨ç½‘å¡ä¸­çš„ä¸­æ–­ï¼Œå†å‘Šè¯‰ç½‘å¡ä¸‹æ¬¡æ¥æ”¶åˆ°æ•°æ®ç›´æ¥å†™å…¥å†…å­˜ï¼Œä¸å†é€šçŸ¥ CPUï¼ˆé¿å… CPU æ¥æ”¶å¤§é‡ä¸­æ–­ï¼‰ å¯åŠ¨è½¯ä¸­æ–­ å†…æ ¸ç½‘ç»œæ¨¡å— å†…æ ¸ä¸­çš„ ksoftirqd è¿›ç¨‹è´Ÿè´£å¤„ç†è½¯ä¸­æ–­ï¼Œå½“æ”¶åˆ°è½¯ä¸­æ–­åï¼Œä¼šè°ƒç”¨å¯¹åº”çš„è½¯ä¸­æ–­å¤„ç†å‡½æ•°ï¼ˆ1.6 ä¸­æŠ›å‡ºçš„è½¯ä¸­æ–­ï¼Œä¼šè°ƒç”¨ç½‘ç»œæ¨¡å—çš„å¤„ç†å‡½æ•°ï¼‰ ç½‘ç»œæ¨¡å—ä¸­çš„å‡½æ•°ä¼šè°ƒç”¨é©±åŠ¨é‡Œçš„è½®è¯¢å‡½æ•°æ¥ä¸€ä¸ªä¸€ä¸ªçš„å¤„ç†æ•°æ®åŒ… é©±åŠ¨ä¼šä¸€ä¸ªä¸€ä¸ªçš„è¯»å–ç½‘å¡å†™åˆ°å†…å­˜ä¸­çš„æ•°æ®åŒ… é©±åŠ¨ç¨‹åºå°†å†…å­˜ä¸­çš„æ•°æ®åŒ…è½¬æ¢æˆå†…æ ¸ç½‘ç»œæ¨¡å—èƒ½è¯†åˆ«çš„å¥—æ¥å­—ç¼“å­˜æ ¼å¼ ç„¶åè°ƒç”¨ GRO ç›¸å…³å‡½æ•°ï¼Œæœ€ç»ˆå°†æ•°æ®æ”¾å…¥ CPU çš„é˜Ÿåˆ—ä¸­ï¼ˆå¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œä¼šè¢«ä¸¢å¼ƒï¼‰ CPU æ¥ç€å¤„ç†è‡ªå·±çš„è½¯ä¸­æ–­ä¸Šä¸‹æ–‡ä¸­çš„é˜Ÿåˆ—é‡Œçš„æ•°æ® å¾…å†…å­˜ä¸­æ‰€æœ‰æ•°æ®è¢«å¤„ç†å®Œåï¼Œå¯ç”¨ç½‘å¡ç¡¬ä¸­æ–­ ğŸŒ° socket ç¨‹åºè¿è¡Œæµç¨‹ åœ¨ socket ç¨‹åºä¸­ï¼Œç¨‹åºæ‰§è¡Œåˆ° recv å‡½æ•°æ—¶ï¼Œ è¿›ç¨‹è¿›å…¥ã€Œé˜»å¡ã€çŠ¶æ€ï¼ˆè¢«æ”¾å…¥å†…æ ¸ç­‰å¾…é˜Ÿåˆ—ï¼Œæš‚åœæ‰§è¡Œåç»­ä»£ç ï¼‰ å¾…ç½‘å¡æ¥æ”¶åˆ°æ•°æ® å°†åˆé€‚çš„æ•°æ®å†™å…¥æŒ‡å®šå†…å­˜ è§¦å‘ç¡¬ä¸­æ–­å¹¶è°ƒç”¨é©±åŠ¨é‡Œçš„å¤„ç†å‡½æ•°ï¼Œå‡½æ•°ç¦ç”¨ç½‘å¡ç¡¬ä¸­æ–­å¹¶è®©ç½‘å¡ä¸‹æ¬¡æ¥æ”¶åˆ°æ•°æ®ç›´æ¥å†™å…¥å†…å­˜ å¯ç”¨è½¯ä¸­æ–­ å†…æ ¸è´Ÿè´£è½¯ä¸­æ–­å¤„ç†çš„çš„ä»£ç å¼€å§‹æ‰§è¡Œ è°ƒç”¨é©±åŠ¨å¤„ç†å†…å­˜ä¸­çš„æ•°æ® æ•°æ®å¤„ç†å®Œåå¯ç”¨ç¡¬ä¸­æ–­ æ•°æ®è¢«é€å…¥åè®®æ ˆ å†…æ ¸æ ¹æ®æ•°æ®ä¸­çš„ç«¯å£ä¿¡æ¯ç­‰å¾—å‡ºäº†æ•°æ®å±äºå“ªä¸ª socket å†æ ¹æ® socket fd å¾—å‡ºèµ„æºæ‰€å±è¿›ç¨‹ è¯¥è¿›ç¨‹è¢«å†…æ ¸é‡æ–°æ”¾å…¥å°±ã€Œç»ªé˜Ÿã€åˆ—ç­‰å¾…åˆ†é… CPU è¿›ç¨‹å¾—åˆ° CPU ä½¿ç”¨æƒåï¼Œè¿›å…¥ã€Œè¿è¡Œã€çŠ¶æ€ï¼Œç»§ç»­å¤„ç† recv åçš„ä»£ç  å‚è€ƒé“¾æ¥ å¦‚æœè¿™ç¯‡æ–‡ç« è¯´ä¸æ¸…epollçš„æœ¬è´¨ï¼Œé‚£å°±è¿‡æ¥ææ­»æˆ‘å§ï¼ DPDKï¼ˆäºŒï¼‰ï¼šå‡†å¤‡çŸ¥è¯†9 â€” Linuxå†…æ ¸æ”¶æŠ¥æµç¨‹","tags":[{"name":"å†…æ ¸","slug":"å†…æ ¸","permalink":"http://www.lockey.xyz/tags/%E5%86%85%E6%A0%B8/"},{"name":"ç½‘ç»œæ•°æ®æ”¶å‘","slug":"ç½‘ç»œæ•°æ®æ”¶å‘","permalink":"http://www.lockey.xyz/tags/%E7%BD%91%E7%BB%9C%E6%95%B0%E6%8D%AE%E6%94%B6%E5%8F%91/"}]},{"title":"I/O å¤šè·¯å¤ç”¨ -- epoll","date":"2020-04-22T03:23:54.000Z","path":"2020/04/22/æœ¯è¯­/IOå¤šè·¯å¤ç”¨/","text":"âš ï¸ åŸºç¡€æ¦‚å¿µ â†’ Linuxå†…æ ¸ä¸­æ–­ â† â†’ æ“ä½œç³»ç»ŸåŸºç¡€ â† â†’ å†…æ ¸ç½‘ç»œæ•°æ®æ”¶å‘æµç¨‹ â† I/O å¤šè·¯å¤ç”¨ I/O å¤šè·¯å¤ç”¨å°±é€šè¿‡ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥ç›‘è§†å¤šä¸ªæè¿°ç¬¦ï¼Œä¸€æ—¦æŸä¸ªæè¿°ç¬¦å°±ç»ªï¼ˆä¸€èˆ¬æ˜¯è¯»å°±ç»ªæˆ–è€…å†™å°±ç»ªï¼‰ï¼Œèƒ½å¤Ÿé€šçŸ¥ç¨‹åºè¿›è¡Œç›¸åº”çš„è¯»å†™æ“ä½œã€‚ é€šå¸¸åœ¨ I/O å¤šè·¯å¤ç”¨ä¸­ï¼ˆå¦‚ epollï¼‰ï¼Œsocket éœ€è¦è®¾ç½®ä¸º no-blocking æ¨¡å¼ï¼Œä¸ç„¶ä¼šå‡ºç°é—®é¢˜ â†“ ğŸŒ°ä½ çš„ã€Œè¯» fdã€éœ€è¦è¯»å– 200 Byte çš„æ•°æ®æ‰ä¼šè¿”å›ï¼Œä½†æ˜¯å‘é€æ•°æ®æ–¹åªå‘é€äº† 199 Byteï¼Œäºæ˜¯ä½ çš„ã€Œè¯» fdã€å°±ä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œå¹¶æœ€ç»ˆå¯¼è‡´ epoll å¤„äºè¢«é˜»å¡çŠ¶æ€ï¼Ÿ epoll select å·¥ä½œæµç¨‹ï¼ˆå¼€å‘ï¼‰ å‡†å¤‡ä¸€ä¸ªæ•°ç»„ï¼Œç”¨æ¥å­˜æ”¾éœ€è¦ç›‘è§†çš„ socket fd è°ƒç”¨ select å¦‚æœæ•°ç»„ä¸­çš„ socket éƒ½æ²¡æœ‰æ•°æ®ï¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°æœ‰ socket æ¥æ”¶åˆ°æ•°æ®ï¼Œè¿›ç¨‹è¢«å”¤é†’ å¦‚æœæœ‰æ•°æ®åˆ™è·³è½¬ â†’ 3 select è¿”å› éå†æ•°ç»„ä¸­æ‰€æœ‰ fdï¼šé€šè¿‡ FD_ISSET åˆ¤æ–­å“ªä¸ª scoket æ¥æ”¶åˆ°æ•°æ® åç»­å¤„ç† select ç¼ºç‚¹ æ¯æ¬¡è°ƒç”¨ select éƒ½éœ€è¦å°†è¿›ç¨‹åŠ å…¥åˆ°æ‰€æœ‰è¢«ç›‘è§†çš„ socket ç­‰å¾…é˜Ÿåˆ— æ¯æ¬¡å”¤é†’éƒ½è¦æŠŠè¿›ç¨‹ä»æ¯ä¸ªé˜Ÿåˆ—ä¸­ç§»é™¤ æ¯æ¬¡éƒ½è¦æŠŠ fd åˆ—è¡¨ä¼ ç»™å†…æ ¸ å¼€é”€å·¨å¤§ï¼Œç›‘è§†çš„ socket è¶Šå¤šï¼Œæ•ˆç‡è¶Šä½ï¼ˆæ‰€ä»¥æ‰ä¼šè§„å®šé»˜è®¤æœ€å¤§ç›‘è§†æ•°ä¸º 1024ï¼‰ è¢«å”¤é†’åï¼Œç”±äºä¸çŸ¥é“æ˜¯å“ªä¸ª socket çš„æ•°æ®ï¼Œåˆéœ€è¦éå†ä¸€æ¬¡æ‰€æœ‰ fd epoll å·¥ä½œæµç¨‹ï¼ˆå¼€å‘ï¼‰ ç”¨ epoll_create åˆ›å»ºä¸€ä¸ª epoll å¯¹è±¡ epfdï¼Œå¹¶å»ºç«‹äº†ä¸€ä¸ªã€Œå°±ç»ªåˆ—è¡¨ã€ï¼Œç”¨æ¥å­˜å‚¨å°±ç»ªçš„ socket å†ç”¨ epoll_ctl å°†æ‰€æœ‰éœ€è¦ç›‘è§†çš„ socket åŠ å…¥ epfd å†è°ƒç”¨ epoll_wait é˜»å¡è¿›ç¨‹ï¼Œç­‰å¾…æ•°æ® è§‚å¯Ÿå°±ç»ªåˆ—è¡¨æœ‰æ²¡æœ‰æ•°æ®ï¼šæœ‰å°±è¿”å›ï¼Œæ²¡æœ‰å°± sleepï¼Œç›´åˆ° timeout åè¿”å› å¤„ç†è¿”å›çš„å°±ç»ªåˆ—è¡¨ä¸­æ”¾å…¥ socket epoll å¯¹æ¯” selete çš„æ”¹è¿› åˆ†ç¦»ç­‰å¾…é˜Ÿåˆ—å’Œé˜»å¡è¿›ç¨‹çš„åŠŸèƒ½ï¼ˆselect æ¯æ¬¡éƒ½ä¼šå¯¹ fd åˆ—è¡¨è¿›è¡Œæ‹·è´ï¼Œè¿›ç¨‹é¢‘ç¹åŠ å…¥ã€ç§»é™¤ç›‘è§†é˜Ÿåˆ—ç­‰æ“ä½œï¼‰ epoll_ctl ç»´æŠ¤ç­‰å¾…é˜Ÿåˆ— å†…æ ¸ eventpoll ä¼šå°†å¾—åˆ°æ•°æ®çš„ fd åŠ å…¥å°±ç»ªé˜Ÿåˆ—ï¼Œè¿›ç¨‹ä¸éœ€è¦éå†æ‰€æœ‰ fd å› ä¸ºä¸éœ€è¦éå†æ‰€æœ‰ fdï¼Œè€Œæ¯æ¬¡å°±ç»ªçš„ fd ä¸ä¼šå¤ªå¤šï¼Œæ‰€ä»¥ç­‰å¾…é˜Ÿåˆ—å°†ä¸éœ€è¦è®¾ç½®ä¸Šé™ æå¤§çš„é™ä½èµ„æºæµªè´¹ epoll_wait é˜»å¡è¿›ç¨‹ è¿›ç¨‹ä¸ä¼šå› ä¸ºæœ‰ socket å°±ç»ªå°±è¢«é¢‘ç¹å”¤é†’ epoll çš„ç¼ºç‚¹ åªèƒ½åœ¨ Linux å¹³å°ä¸‹ä½¿ç”¨ å¤æ‚åº¦ç›¸å¯¹é«˜ä¸€ç‚¹ åœ¨å°‘é‡å¹¶å‘ä¸” socket éƒ½æ¯”è¾ƒæ´»è·ƒçš„æƒ…å†µä¸‹ï¼Œepoll ç”±äºå…¶å”¤é†’åŸç†ï¼Œæ€§èƒ½ä¸å¦‚ select å‚è€ƒé“¾æ¥ å¦‚æœè¿™ç¯‡æ–‡ç« è¯´ä¸æ¸…epollçš„æœ¬è´¨ï¼Œé‚£å°±è¿‡æ¥ææ­»æˆ‘å§ï¼","tags":[{"name":"I/Oå¤šè·¯å¤ç”¨","slug":"I-Oå¤šè·¯å¤ç”¨","permalink":"http://www.lockey.xyz/tags/I-O%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/"},{"name":"epoll","slug":"epoll","permalink":"http://www.lockey.xyz/tags/epoll/"}]},{"title":"åŒæ­¥/å¼‚æ­¥/é˜»å¡/éé˜»å¡ã€äº‹ä»¶é©±åŠ¨ã€I/O å¤šè·¯å¤ç”¨","date":"2020-04-22T03:16:56.000Z","path":"2020/04/22/æœ¯è¯­/åŒæ­¥å¼‚æ­¥é˜»å¡éé˜»å¡/","text":"é²è¿…è¯´ æœ‰å¼‚æ­¥å°±æœ‰åŒæ­¥ï¼Œæœ‰éé˜»å¡å°±æœ‰é˜»å¡ ç»„åˆå¯å¾—ï¼šåŒæ­¥é˜»å¡ã€åŒæ­¥ä¸é˜»å¡ã€å¼‚æ­¥é˜»å¡ã€å¼‚æ­¥ä¸é˜»å¡ ä¸€ä¸ªæ¥è‡ªé€¼ä¹ä¸Šçš„ ğŸŒ° â†“ è€å¼ çˆ±å–èŒ¶ï¼ŒåºŸè¯ä¸è¯´ï¼Œç…®å¼€æ°´ã€‚ å‡ºåœºäººç‰©ï¼šè€å¼ ï¼Œæ°´å£¶ä¸¤æŠŠï¼ˆæ™®é€šæ°´å£¶ï¼Œç®€ç§°æ°´å£¶ï¼›ä¼šå“çš„æ°´å£¶ï¼Œç®€ç§°å“æ°´å£¶ï¼‰ã€‚ è€å¼ æŠŠæ°´å£¶æ”¾åˆ°ç«ä¸Šï¼Œç«‹ç­‰æ°´å¼€ã€‚ï¼ˆåŒæ­¥é˜»å¡ï¼‰ è€å¼ è§‰å¾—è‡ªå·±æœ‰ç‚¹å‚» è€å¼ æŠŠæ°´å£¶æ”¾åˆ°ç«ä¸Šï¼Œå»å®¢å…çœ‹ç”µè§†ï¼Œæ—¶ä¸æ—¶å»å¨æˆ¿çœ‹çœ‹æ°´å¼€æ²¡æœ‰ã€‚ï¼ˆåŒæ­¥éé˜»å¡ï¼‰ è€å¼ è¿˜æ˜¯è§‰å¾—è‡ªå·±æœ‰ç‚¹å‚»ï¼Œäºæ˜¯å˜é«˜ç«¯äº†ï¼Œä¹°äº†æŠŠä¼šå“ç¬›çš„é‚£ç§æ°´å£¶ã€‚æ°´å¼€ä¹‹åï¼Œèƒ½å¤§å£°å‘å‡ºå˜€~~~~çš„å™ªéŸ³ã€‚ è€å¼ æŠŠå“æ°´å£¶æ”¾åˆ°ç«ä¸Šï¼Œç«‹ç­‰æ°´å¼€ã€‚ï¼ˆå¼‚æ­¥é˜»å¡ï¼‰ è€å¼ è§‰å¾—è¿™æ ·å‚»ç­‰æ„ä¹‰ä¸å¤§ è€å¼ æŠŠå“æ°´å£¶æ”¾åˆ°ç«ä¸Šï¼Œå»å®¢å…çœ‹ç”µè§†ï¼Œæ°´å£¶å“ä¹‹å‰ä¸å†å»çœ‹å®ƒäº†ï¼Œå“äº†å†å»æ‹¿å£¶ã€‚ï¼ˆå¼‚æ­¥éé˜»å¡ï¼‰è€å¼ è§‰å¾—è‡ªå·±èªæ˜äº†ã€‚ æ‰€è°“åŒæ­¥å¼‚æ­¥ï¼Œåªæ˜¯å¯¹äºæ°´å£¶è€Œè¨€ã€‚æ™®é€šæ°´å£¶ï¼ŒåŒæ­¥ï¼›å“æ°´å£¶ï¼Œå¼‚æ­¥ã€‚è™½ç„¶éƒ½èƒ½å¹²æ´»ï¼Œä½†å“æ°´å£¶å¯ä»¥åœ¨è‡ªå·±å®Œå·¥ä¹‹åï¼Œæç¤ºè€å¼ æ°´å¼€äº†ã€‚è¿™æ˜¯æ™®é€šæ°´å£¶æ‰€ä¸èƒ½åŠçš„ã€‚åŒæ­¥åªèƒ½è®©è°ƒç”¨è€…å»è½®è¯¢è‡ªå·±ï¼ˆæƒ…å†µ 2 ä¸­ï¼‰ï¼Œé€ æˆè€å¼ æ•ˆç‡çš„ä½ä¸‹ã€‚ æ‰€è°“é˜»å¡éé˜»å¡ï¼Œä»…ä»…å¯¹äºè€å¼ è€Œè¨€ã€‚ç«‹ç­‰çš„è€å¼ ï¼Œé˜»å¡ï¼›çœ‹ç”µè§†çš„è€å¼ ï¼Œéé˜»å¡ã€‚æƒ…å†µ 1 å’Œæƒ…å†µ 3 ä¸­è€å¼ å°±æ˜¯é˜»å¡çš„ï¼Œåª³å¦‡å–Šä»–éƒ½ä¸çŸ¥é“ã€‚è™½ç„¶ 3 ä¸­å“æ°´å£¶æ˜¯å¼‚æ­¥çš„ï¼Œå¯å¯¹äºç«‹ç­‰çš„è€å¼ æ²¡æœ‰å¤ªå¤§çš„æ„ä¹‰ã€‚æ‰€ä»¥ä¸€èˆ¬å¼‚æ­¥æ˜¯é…åˆéé˜»å¡ä½¿ç”¨çš„ï¼Œè¿™æ ·æ‰èƒ½å‘æŒ¥å¼‚æ­¥çš„æ•ˆç”¨ã€‚ ä»€ä¹ˆæ˜¯ã€Œäº‹ä»¶é©±åŠ¨ã€ï¼Ÿ ä¼ ç»Ÿç¼–ç¨‹å¤§éƒ¨åˆ†æ˜¯çº¿æ€§æ¨¡å¼çš„ï¼Œæ§åˆ¶æµç¨‹ç”±è¾“å…¥æ•°æ®å’Œç¼–å†™çš„ç¨‹åºå†³å®šï¼›åœ¨çŸ¥é“è¿™ä¸ªç¨‹åºå½“å‰çš„è¿è¡ŒçŠ¶æ€ï¼ˆåŒ…æ‹¬è¾“å…¥æ•°æ®å’Œç¨‹åºæœ¬èº«ï¼‰çš„å‰æä¸‹ï¼Œä½ å°±çŸ¥é“æ¥ä¸‹æ¥ç”šè‡³ä¸€ç›´åˆ°ç»“æŸå®ƒçš„è¿è¡Œæµç¨‹ã€‚ ã€Œäº‹ä»¶é©±åŠ¨ã€æ˜¯æŒ‡åœ¨æŒç»­äº‹åŠ¡ç®¡ç†è¿‡ç¨‹ä¸­ï¼Œè¿›è¡Œå†³ç­–çš„ä¸€ç§ç­–ç•¥ï¼Œå³è·Ÿéšå½“å‰æ—¶é—´ç‚¹ä¸Šå‡ºç°çš„äº‹ä»¶ï¼Œè°ƒåŠ¨å¯ç”¨èµ„æºï¼Œæ‰§è¡Œç›¸å…³ä»»åŠ¡ï¼Œä½¿ä¸æ–­å‡ºç°çš„é—®é¢˜å¾—ä»¥è§£å†³ï¼Œé˜²æ­¢äº‹åŠ¡å †ç§¯ã€‚äº‹ä»¶é©±åŠ¨æ¨¡å¼æ¯”è¾ƒé«˜å†·ï¼Œæœ‰ä¸ªå¥½è±ååŸåˆ™ï¼šâ€ä¸è¦æ‰“ç”µè¯ç»™æˆ‘ä»¬ï¼Œæˆ‘ä»¬ä¼šæ‰“ç”µè¯ç»™ä½ â€œã€‚äº‹ä»¶é©±åŠ¨ç¨‹åºåœ¨å¯åŠ¨åä¼šå¤„äºç­‰å¾…çŠ¶æ€ï¼Œä¼šç­‰å¾…äº‹ä»¶è§¦å‘ï¼Œç„¶åæ‰§è¡Œå“åº”å‡½æ•°ã€‚åˆè¢«ç§°ä¸ºâ†’ I&#x2F;Oå¤šè·¯å¤ç”¨ â†â€¦â€¦","tags":[{"name":"åŒæ­¥","slug":"åŒæ­¥","permalink":"http://www.lockey.xyz/tags/%E5%90%8C%E6%AD%A5/"},{"name":"å¼‚æ­¥","slug":"å¼‚æ­¥","permalink":"http://www.lockey.xyz/tags/%E5%BC%82%E6%AD%A5/"},{"name":"é˜»å¡","slug":"é˜»å¡","permalink":"http://www.lockey.xyz/tags/%E9%98%BB%E5%A1%9E/"},{"name":"éé˜»å¡","slug":"éé˜»å¡","permalink":"http://www.lockey.xyz/tags/%E9%9D%9E%E9%98%BB%E5%A1%9E/"},{"name":"äº‹ä»¶é©±åŠ¨","slug":"äº‹ä»¶é©±åŠ¨","permalink":"http://www.lockey.xyz/tags/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8/"},{"name":"I/O å¤šè·¯å¤ç”¨","slug":"I-O-å¤šè·¯å¤ç”¨","permalink":"http://www.lockey.xyz/tags/I-O-%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/"}]},{"title":"Web æœåŠ¡çš„åŸºç¡€æ¦‚å¿µ","date":"2020-04-22T02:54:43.000Z","path":"2020/04/22/æœ¯è¯­/WebæœåŠ¡/","text":"Web æœåŠ¡åŸºç¡€æ¦‚å¿µ å¦‚æœéœ€è¦è·‘èµ·ä¸€ä¸ªæ™®é€šçš„ Web æœåŠ¡ï¼ˆç½‘ç«™ã€æ¥å£æœåŠ¡ï¼‰ï¼Œ ä¸€èˆ¬éœ€è¦æœ‰ä¸€å°ä¸»æœºï¼ˆäº‘ä¸»æœºç­‰ï¼‰ï¼Œç„¶ååœ¨ä¸»æœºä¸Šå¯åŠ¨ Web åº”ç”¨ç¨‹åºã€‚ åœ¨ Python ä¸­ï¼Œå¤§éƒ¨åˆ† Web æ¡†æ¶ï¼ˆDjangoã€Flaskç­‰ï¼‰è‡ªå¸¦çš„ Web æœåŠ¡å™¨æ€§èƒ½è¾ƒå·®ï¼Œä¸é€‚åˆåœ¨ç”Ÿäº§ç¯å¢ƒæŠ•å…¥ä½¿ç”¨ï¼Œè¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆè¾ƒå¤šï¼Œç›®å‰ä½¿ç”¨è¾ƒå¤šçš„æ˜¯ä½¿ç”¨ä¸“ä¸šçš„ HTTP æœåŠ¡å™¨ï¼ˆè½¯ä»¶ï¼Œå¦‚ï¼šNginxã€Apacheã€IISç­‰ï¼‰ æä¾› Web æœåŠ¡ï¼Œç”¨ æœåŠ¡å™¨ç½‘å…³æ¥å£ï¼ˆWSGIï¼‰æœåŠ¡å™¨ ä½œä¸º HTTP æœåŠ¡å™¨å’Œ Web åº”ç”¨ç¨‹åºæˆ–æ¡†æ¶ä¹‹é—´çš„æ¥å£ï¼Œæ„æˆä¸€ä¸ªå®Œæ•´çš„ Web æœåŠ¡ã€‚ ä»€ä¹ˆæ˜¯ Web åº”ç”¨ç¨‹åºï¼Ÿ ä¸€ä¸ª Web åº”ç”¨ç¨‹åºæ˜¯ç”±å®Œæˆç‰¹å®šä»»åŠ¡çš„å„ç§ Web ç»„ä»¶æ„æˆï¼Œå¹¶é€šè¿‡ Web å°†æœåŠ¡å±•ç¤ºç»™å¤–ç•Œã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒWeb åº”ç”¨ç¨‹åºæ˜¯ç”±å¤šä¸ª Servletã€JSP é¡µé¢ã€HTML æ–‡ä»¶ä»¥åŠå›¾åƒæ–‡ä»¶ç­‰ç»„æˆã€‚æ‰€æœ‰è¿™äº›ç»„ä»¶ç›¸äº’åè°ƒä¸ºç”¨æˆ·æä¾›ä¸€ç»„å®Œæ•´çš„æœåŠ¡ã€‚ ä»€ä¹ˆæ˜¯ HTTP æœåŠ¡å™¨ï¼Ÿ HTTP æœåŠ¡å™¨é€šå¸¸ä¹Ÿå« Web æœåŠ¡å™¨â€¦â€¦ï¼ˆï¼Ÿï¼Ÿï¼Ÿé»‘äººé—®å·è„¸ï¼Ÿï¼Ÿï¼Ÿï¼‰ å®ƒé€šè¿‡ HTTP åè®®å¤„ç† Web è¯·æ±‚ï¼ˆæ¥æ”¶å’Œç®¡ç†ï¼‰ã€‚ ä»€ä¹ˆæ˜¯ WSGI æœåŠ¡å™¨ï¼Ÿ WSGIï¼ˆPython Web Server Gateway Interfaceï¼‰åŸºäº CGIï¼ˆCommon Gateway Interfaceï¼‰ æ ‡å‡†è®¾è®¡ï¼Œæ˜¯ä¸º Python å®šä¹‰çš„ Web æœåŠ¡å™¨å’Œ Web åº”ç”¨ç¨‹åºæˆ–æ¡†æ¶ä¹‹é—´çš„ä¸€ç§ç®€å•è€Œé€šç”¨çš„æ¥å£ï¼ˆå…¶ä»–è¯­è¨€åœ¨è¿™ä¹‹åä¹Ÿå‡ºç°ç±»ä¼¼çš„æ¥å£ï¼‰ã€‚WSGI æœåŠ¡å™¨æ˜¯åŸºäº WSGI åè®®å®ç°çš„ç”¨æ¥è°ƒç”¨ Web åº”ç”¨ç¨‹åºçš„æœåŠ¡å™¨ï¼Œå¦å¤–ï¼Œå®ƒä¹Ÿå¯ä»¥æ¥æ”¶æ¥è‡ª HTTP æœåŠ¡å™¨çš„å®ç° WSGI æ¥å£çš„è¯·æ±‚æ•°æ®ï¼Œå®Œç¾å¯¹æ¥äº† Web åº”ç”¨ç¨‹åºå’Œ HTTP æœåŠ¡å™¨çš„è¯·æ±‚ã€æ•°æ®äº¤äº’ã€‚ WSGI çš„ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ éƒ¨ç½²å¤šæ ·åŒ– ç»„ä»¶é—´é«˜åº¦è§£è€¦ï¼ˆä»»ä½•ä¸€ä¸ªç¬¦åˆ WSGI è§„èŒƒçš„åº”ç”¨ç¨‹åºéƒ½å¯ä»¥éƒ¨ç½²åœ¨ä»»ä½•ä¸€ä¸ªå®ç°äº† WSGI è§„èŒƒçš„æœåŠ¡å™¨ä¸Šï¼‰ ç¼ºç‚¹ æ— æ³•å¤„ç† WebSocketã€HTTP/2 ä¸€ä¸ª URL å¤šä¸ªè¯·æ±‚çš„æ¨¡å¼ ç»§ä»»è€… ASGIï¼ˆå¼‚æ­¥æœåŠ¡å™¨ç½‘å…³æ¥å£ï¼‰ ASGIï¼ˆAsynchronous Server Gateway Interfaceï¼‰æ˜¯ WSGI çš„ç²¾ç¥ç»§æ‰¿è€…ï¼Œæ—¨åœ¨åœ¨å…·æœ‰å¼‚æ­¥åŠŸèƒ½çš„ Python Web æœåŠ¡å™¨ï¼Œæ¡†æ¶å’Œåº”ç”¨ç¨‹åºä¹‹é—´æä¾›æ ‡å‡†æ¥å£ã€‚ ASGI æœåŠ¡å™¨ ä¸»æµå®ç° Uvicorn Daphne Hypercorn","tags":[{"name":"Web","slug":"Web","permalink":"http://www.lockey.xyz/tags/Web/"},{"name":"æœåŠ¡","slug":"æœåŠ¡","permalink":"http://www.lockey.xyz/tags/%E6%9C%8D%E5%8A%A1/"},{"name":"WSGI","slug":"WSGI","permalink":"http://www.lockey.xyz/tags/WSGI/"},{"name":"ASGI","slug":"ASGI","permalink":"http://www.lockey.xyz/tags/ASGI/"}]},{"title":"Linux å†…æ ¸ä¸­æ–­åˆè¯†","date":"2020-04-22T02:52:16.000Z","path":"2020/04/22/åŸºç¡€/Linuxå†…æ ¸ä¸­æ–­/","text":"å†…æ ¸å¯¹ç¡¬ä»¶è®¾å¤‡çš„ç®¡ç†æ–¹å¼ è½®è¯¢ï¼šå†…æ ¸å®šæœŸå¯¹è®¾å¤‡çŠ¶æ€è¿›è¡ŒæŸ¥è¯¢ âå‘¨æœŸæ€§é‡å¤æ‰§è¡Œã€æµªè´¹èµ„æºã€æ•ˆç‡ä½ä¸‹ ä¸­æ–­ï¼šç¡¬ä»¶åœ¨éœ€è¦çš„æ—¶å€™å‘å†…æ ¸å‘å‡ºä¿¡å· âœ…èµ„æºåˆ©ç”¨ç‡é«˜ ä¸­æ–­ ä»€ä¹ˆæ˜¯ä¸­æ–­? ç‰©ç†å­¦è§’åº¦è¯´ï¼Œä¸­æ–­æ˜¯ä¸€ç§ã€Œç”µä¿¡å·ã€ ç”±ç¡¬ä»¶è®¾å¤‡äº§ç”Ÿå¹¶é€å…¥ä¸­æ–­æ§åˆ¶å™¨çš„è¾“å…¥å¼•è„šä¸Š ä¸­æ–­æ§åˆ¶å™¨æ”¶åˆ°ä¿¡å·ï¼Œå‘å¤„ç†å™¨å‘é€ç›¸åº”ä¿¡å· å¤„ç†å™¨æ¥æ”¶åˆ°ä¿¡å·ï¼Œä¸­æ–­å½“å‰æ­£åœ¨å¤„ç†çš„å·¥ä½œï¼Œè½¬è€Œå»å¤„ç†ä¸­æ–­ä¿¡å·ï¼Œä¹‹åé€šçŸ¥ OS äº§ç”Ÿä¸­æ–­ OS å¤„ç†ä¸­æ–­ ä¸åŒè®¾å¤‡å¯¹åº”ä¸åŒä¸­æ–­ æ¯ä¸ªä¸­æ–­ç”¨ä¸€ä¸ªå”¯ä¸€æ•°å­—æ ‡è¯†ï¼ˆå€¼è¢«ç§°ä¸ºä¸­æ–­è¯·æ±‚çº¿ï¼‰ ä¸­æ–­åˆ†ç±» åŒæ­¥ä¸­æ–­ ç”± CPU å†…éƒ¨ç”µä¿¡å·äº§ç”Ÿ å½“å‰æŒ‡ä»¤æ‰§è¡Œå®Œæ‰ä¼šäº§ç”Ÿä¸­æ–­ CPU ä¸»åŠ¨äº§ç”Ÿï¼Œæ‰§è¡Œç‚¹å¯æ§ ä¹Ÿç§°ä¸ºå¼‚å¸¸ï¼ˆä»£ç é”™è¯¯äº§ç”Ÿæˆ– CPU å¤„ç†å¼‚å¸¸æ¡ä»¶ï¼‰ å¼‚æ­¥ä¸­æ–­ å¤–è®¾äº§ç”Ÿ å‘ç”Ÿæ—¶é—´ç‚¹ä¸å¯é¢„æœŸ é€šå¸¸æ¥è¯´ï¼šå¼‚æ­¥ä¸­æ–­è¢«ç§°ä¸ºä¸­æ–­ï¼Œä¸ºæ¥è‡ª I/O è®¾å¤‡çš„ä¿¡å·ï¼›åŒæ­¥ä¸­æ–­åˆ†ä¸ºæ•…éšœã€é™·é˜±ã€ç»ˆæ­¢ã€‚ ç¡¬ä¸­æ–­ä¸è½¯ä¸­æ–­ ç¡¬ä¸­æ–­ï¼šä¸€èˆ¬å°±æ˜¯æŒ‡çš„ç¡¬ä»¶ä¸­æ–­ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„ä¸­æ–­ï¼Œç”±ç¡¬ä»¶è§¦å‘ è½¯ä¸­æ–­ï¼šæ˜¯é€šä¿¡è¿›ç¨‹ä¹‹é—´ç”¨æ¥æ¨¡æ‹Ÿç¡¬ä¸­æ–­çš„ä¸€ç§ä¿¡å·é€šä¿¡æ–¹å¼ã€‚æ˜¯å±äºä¸€ç§ç¼–ç¨‹æ‰‹æ®µï¼Œä¹Ÿæœ‰ç§°ä¹‹ä¸ºè½¯ä¸­æ–­é€šä¿¡æœºåˆ¶ å‚è€ƒé“¾æ¥ IBM","tags":[{"name":"ä¸­æ–­","slug":"ä¸­æ–­","permalink":"http://www.lockey.xyz/tags/%E4%B8%AD%E6%96%AD/"},{"name":"å†…æ ¸","slug":"å†…æ ¸","permalink":"http://www.lockey.xyz/tags/%E5%86%85%E6%A0%B8/"}]},{"title":"Uvicorn - æœ€å¼ºå¼‚æ­¥æœåŠ¡å™¨ç½‘å…³æ¥å£ï¼Ÿ","date":"2020-04-20T06:47:47.000Z","path":"2020/04/20/Python/Uvicorn--æœ€å¼ºå¼‚æ­¥æœåŠ¡å™¨ï¼Ÿ/","text":"å‰ç½®çŸ¥è¯† â†’ WebæœåŠ¡ã€ASGI â† â†’ å¼‚æ­¥éé˜»å¡åŠäº‹ä»¶é©±åŠ¨ â† â†’ I&#x2F;Oå¤šè·¯å¤ç”¨ â† Uvicorn The lightning-fast ASGI server. åŸºäº uvloop å’Œ httptools çš„ ASGI å®ç°ã€‚ ä»€ä¹ˆæ˜¯ uvloopï¼Ÿ æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„å¼‚æ­¥éé˜»å¡æ¡†æ¶ æ˜¯å®Œæ•´çš„ asyncio äº‹ä»¶å¾ªç¯çš„æ›¿ä»£å“ å»ºç«‹åœ¨ libuv ä¹‹ä¸Š libuv æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ï¼Œäº‹ä»¶é©±åŠ¨çš„ I/O åº“ï¼Œå¹¶ä¸”æä¾›äº†è·¨å¹³å°ï¼ˆå¦‚windows, linuxï¼‰çš„ API ç”± Cython ç¼–å†™ ä»€ä¹ˆæ˜¯ libuvï¼Ÿ libuv æ¶æ„å›¾ â†“ libuv æä¾›äº†ä¸åŒçš„æ¥å£æ¥æ“ä½œç½‘ç»œ I/Oã€æ–‡ä»¶ I/Oã€DNS ç›¸å…³å‡½æ•°ä»¥åŠç”¨æˆ·ä»£ç  ç½‘ç»œ I/O çš„å¤„ç†ï¼Œåœ¨ä¸åŒå¹³å°ä¸‹ä½¿ç”¨ä¸åŒçš„å¼‚æ­¥æ¨¡å‹ Linux â€“ epoll OSX &amp; BSDs â€“ kqueue Windows â€“ IOCP SunOS â€“ event ports æ–‡ä»¶ I/Oã€DNS å‡½æ•°åŠç”¨æˆ·ä»£ç å¤„ç†ä¸ä¾èµ–å¹³å°ï¼Œç›´æ¥ä½¿ç”¨çº¿ç¨‹æ± å¤„ç† ä»£ç ç”± C è¯­è¨€å®ç° ä»€ä¹ˆæ˜¯ httptoolsï¼Ÿ æ˜¯ NodeJS HTTP è§£æçš„ Python å®ç° ç”± Cython ç¼–å†™ å°ç»“ å·ç§°â€æœ€å¼ºâ€œçš„ Uvicornï¼Œæ˜¯ä¸€ä¸ªåŸºäºäº‹ä»¶çš„éé˜»å¡æ¡†æ¶ï¼Œä»£ç ç”± Cython å®ç°ï¼Œå¯¹æ¯” Daphne çš„ Twistedï¼ˆPython å®ç°ï¼‰ äº‹ä»¶é©±åŠ¨ï¼Œç†è®ºä¸Šæ¥è¯´ï¼Œé€Ÿåº¦ç¡®å®æ˜¯åœ¨ Daphone ä¹‹ä¸Šçš„ï¼ŒCython + éé˜»å¡ + äº‹ä»¶å¾ªç¯çš„ç»„åˆï¼Œç›®å‰æ¥çœ‹ï¼Œç¡®å®æ˜¯ä¸€ä¸ªæœ€å¼ºç»„åˆã€‚ æ€»ç»“ ã€Œæˆ‘æ„¿ç§°ä½ ä¸ºæœ€å¼ºã€ å‚è€ƒé“¾æ¥ IOå¤šè·¯å¤ç”¨åŸç†å‰–æ Linuxç†è§£-ä¸€åˆ‡çš†æ–‡ä»¶","tags":[{"name":"Uvicorn","slug":"Uvicorn","permalink":"http://www.lockey.xyz/tags/Uvicorn/"},{"name":"å¼‚æ­¥æœåŠ¡å™¨","slug":"å¼‚æ­¥æœåŠ¡å™¨","permalink":"http://www.lockey.xyz/tags/%E5%BC%82%E6%AD%A5%E6%9C%8D%E5%8A%A1%E5%99%A8/"}]},{"title":"K8S metrics-server æ­å»º/è¸©å‘","date":"2020-04-02T03:59:05.000Z","path":"2020/04/02/DevOps/K8S_metrics-server_æ­å»º_è¸©å‘/","text":"ç®€ä»‹ æ­å»º ä¸‹è½½é…ç½®æ–‡ä»¶ ä¿®æ”¹deploy/kubernetes/metrics-server-deployment.yaml imageï¼ˆå›½å†…ï¼‰ ä¿®æ”¹deploy/kubernetes/metrics-server-deployment.yaml args é…ç½®ï¼ˆåœ¨å‡ºç°ï¼šno metrics known for pod timeoutç­‰é”™è¯¯æ—¶ä¿®æ”¹ï¼›åº”è¯¥ä¼šæœ‰å®‰å…¨éšæ‚£ï¼Œæ…ç”¨ï¼‰ å¢åŠ  - --kubelet-insecure-tls # ä¸éªŒè¯TLS å¢åŠ  - --kubelet-preferred-address-types=InternalDNS,InternalIP,ExternalDNS,ExternalIP,Hostname # ç›´æ¥è®¿é—®IP æµ‹è¯• kubectl top node kubectl top pod æ˜¾ç¤ºèµ„æºä¿¡æ¯","tags":[{"name":"metrics-server","slug":"metrics-server","permalink":"http://www.lockey.xyz/tags/metrics-server/"}]},{"title":"Docker æ„å»ºç§æœ‰ pip ä»“åº“ï¼ˆdevpiï¼‰","date":"2020-04-01T06:09:19.000Z","path":"2020/04/01/Python/Dockeræ„å»ºç§æœ‰pipä»“åº“/","text":"ä½¿ç”¨åœºæ™¯ ç½‘ç»œç¯å¢ƒä¸ä½³ã€ä¸å…è®¸ éœ€è¦ç»å¸¸æ€§çš„ä½¿ç”¨pipï¼ˆæ¯”å¦‚ docker é•œåƒæ„å»ºï¼‰ è§‰å¾—ç¬¬ä¸‰æ–¹æºçš„ä½¿ç”¨ï¼Œä½¿å¸¦å®½å‹åŠ›å¤§ ä½¿ç”¨ Docker å¯åŠ¨ï¼ˆdevipï¼‰æœåŠ¡ docker run -d --name devpi \\ --publish 3141:3141 \\ --volume /Users/lockey/pypi:/data \\ # è‡ªè¡Œæ›¿æ¢æŒ‚è½½ç›®å½• --env=DEVPI_PASSWORD=secret \\ # è‡ªè¡Œæ›´æ”¹ç™»å½•å¯†ç  --restart always \\ muccg/devpi:4.5.0 å‡†å¤‡ pip install devpi è®¾ç½® devpi use http://10.0.0.38:3141/root/public ç™»å½• devpi login root ä¸Šä¼  ä¸‹è½½éœ€è¦ä¸Šä¼ çš„ pip åŒ…ï¼ˆwhlã€gzã€zipç­‰ï¼‰ devpi upload --from-dir --formats=* . # è‡ªè¡Œä¿®æ”¹ä¸Šä¼ ç›®å½• ä½¿ç”¨ åŒæ™®é€šç¬¬ä¸‰æ–¹æºä¿®æ”¹æ­¥éª¤ å‚è€ƒé“¾æ¥ DockerHUB","tags":[{"name":"Python","slug":"Python","permalink":"http://www.lockey.xyz/tags/Python/"},{"name":"pip","slug":"pip","permalink":"http://www.lockey.xyz/tags/pip/"},{"name":"devpi","slug":"devpi","permalink":"http://www.lockey.xyz/tags/devpi/"},{"name":"ç§æœ‰","slug":"ç§æœ‰","permalink":"http://www.lockey.xyz/tags/%E7%A7%81%E6%9C%89/"}]},{"title":"åœ¨K8Sé›†ç¾¤ä¸­æ­å»ºRedisé›†ç¾¤(istioç½‘ç»œ)","date":"2020-03-25T06:46:50.000Z","path":"2020/03/25/DevOps/åœ¨K8Sé›†ç¾¤ä¸­æ­å»ºRedisé›†ç¾¤/","text":"èƒŒæ™¯ åœ¨ K8S é›†ç¾¤ä¸­æ­å»º Redis é›†ç¾¤ K8S é›†ç¾¤ä½¿ç”¨ istio æ¥ç®¡ç½‘ç»œ æ³¨æ„äº‹é¡¹ ç”±äº istio æ¥ç®¡ç½‘ç»œï¼Œä¼šé€ æˆ Redis é›†ç¾¤åˆå§‹åŒ–ä¸èƒ½æˆåŠŸï¼ˆä¸€ç›´å¡åœ¨ï¼šWaiting for the cluster to joinï¼‰ ä»¥ä¸Šé—®é¢˜éœ€è¦åœ¨ pod å¯åŠ¨çš„æ—¶å€™è®¾ç½® cluster-announce-ipï¼Œå…·ä½“è§ä¸‹ â†“ éƒ¨ç½²é›†ç¾¤å‰æ ä½¿ç”¨ PV/PVC å­˜å‚¨ï¼ˆå¯æ­å»º NFSï¼‰ ä½¿ç”¨ StatefulSet é…ç½®é›†ç¾¤ ç¡®è®¤èŠ‚ç‚¹é—´ 6379ã€16379 ç«¯å£å¯è®¿é—® éƒ¨ç½² éƒ¨ç½² NFS ç®¡ç†(nfs-client-provisioner) cat &lt;&lt; EOF &gt; ncp.yaml --- kind: ServiceAccount apiVersion: v1 metadata: name: nfs-client-provisioner --- kind: ClusterRole apiVersion: rbac.authorization.k8s.io/v1 metadata: name: nfs-client-provisioner-runner rules: - apiGroups: [&quot;&quot;] resources: [&quot;persistentvolumes&quot;] verbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;, &quot;create&quot;, &quot;delete&quot;] - apiGroups: [&quot;&quot;] resources: [&quot;persistentvolumeclaims&quot;] verbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;, &quot;update&quot;] - apiGroups: [&quot;storage.k8s.io&quot;] resources: [&quot;storageclasses&quot;] verbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;] - apiGroups: [&quot;&quot;] resources: [&quot;events&quot;] verbs: [&quot;list&quot;, &quot;watch&quot;, &quot;create&quot;, &quot;update&quot;, &quot;patch&quot;] - apiGroups: [&quot;&quot;] resources: [&quot;endpoints&quot;] verbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;, &quot;create&quot;, &quot;update&quot;, &quot;patch&quot;] --- kind: ClusterRoleBinding apiVersion: rbac.authorization.k8s.io/v1 metadata: name: run-nfs-client-provisioner subjects: - kind: ServiceAccount name: nfs-client-provisioner namespace: default roleRef: kind: ClusterRole name: nfs-client-provisioner-runner apiGroup: rbac.authorization.k8s.io --- kind: Deployment apiVersion: apps/v1 metadata: name: nfs-client-provisioner spec: replicas: 1 selector: matchLabels: app: nfs-client-provisioner strategy: type: Recreate template: metadata: labels: app: nfs-client-provisioner spec: serviceAccountName: nfs-client-provisioner containers: - name: nfs-client-provisioner image: &lt;é•œåƒä»“åº“(ç½‘ç»œæ–¹ä¾¿å¯ä»¥è‡ªè¡Œåˆ° Docker HUB æ‰¾é•œåƒã€ç‰ˆæœ¬)&gt;/nfs-client-provisioner:latest volumeMounts: - name: nfs-client-root mountPath: /persistentvolumes env: - name: PROVISIONER_NAME value: nfs-client-provisioner - name: NFS_SERVER value: &lt;NFS æœåŠ¡ç«¯ä¸»æœº IP&gt; - name: NFS_PATH value: &lt;NSF æœåŠ¡ç«¯å¯¼å‡ºç›®å½•&gt; volumes: - name: nfs-client-root nfs: server: &lt;NFS æœåŠ¡ç«¯ä¸»æœº IP&gt; path: &lt;NSF æœåŠ¡ç«¯å¯¼å‡ºç›®å½•&gt; --- apiVersion: storage.k8s.io/v1 kind: StorageClass metadata: name: nfs-storage provisioner: nfs-client-provisioner EOF éƒ¨ç½² Redis é›†ç¾¤ cat &lt;&lt; EOF &gt; redis-cluster.yaml --- apiVersion: v1 kind: ConfigMap metadata: name: redis-cluster data: update-node.sh: | #!/bin/sh REDIS_NODES=&quot;/data/nodes.conf&quot; sed -i -e &quot;/myself/ s/[0-9]\\{1,3\\}\\.[0-9]\\{1,3\\}\\.[0-9]\\{1,3\\}\\.[0-9]\\{1,3\\}/${POD_IP}/&quot; ${REDIS_NODES} cp /conf/redis.conf /redis.conf sed -i &quot;s/MY_IP/${POD_IP}/&quot; /redis.conf # è§£å†³ istio ç½‘ç»œä¸‹ï¼ŒRedis é›†ç¾¤åˆå§‹åŒ–å¤±è´¥é—®é¢˜ exec &quot;$@&quot; redis.conf: |+ cluster-enabled yes cluster-require-full-coverage no cluster-node-timeout 15000 cluster-config-file /data/nodes.conf cluster-migration-barrier 1 appendonly yes protected-mode no cluster-announce-ip MY_IP # è§£å†³ istio ç½‘ç»œä¸‹ï¼ŒRedis é›†ç¾¤åˆå§‹åŒ–å¤±è´¥é—®é¢˜ #åˆ›å»ºstatefulsetæœåŠ¡ --- apiVersion: apps/v1 kind: StatefulSet metadata: name: redis-cluster spec: serviceName: redis-cluster replicas: 6 selector: matchLabels: app: redis-cluster template: metadata: labels: app: redis-cluster spec: containers: - name: redis image: &lt;é•œåƒä»“åº“(ç½‘ç»œæ–¹ä¾¿å¯ä»¥è‡ªè¡Œåˆ° Docker HUB æ‰¾é•œåƒã€ç‰ˆæœ¬&gt;/redis:5.0.1-alpine ports: - containerPort: 6379 name: client - containerPort: 16379 name: gossip command: [&quot;/conf/update-node.sh&quot;, &quot;redis-server&quot;, &quot;/redis.conf&quot;] env: - name: POD_IP valueFrom: fieldRef: fieldPath: status.podIP volumeMounts: - name: conf mountPath: /conf readOnly: false - name: data mountPath: /data readOnly: false volumes: - name: conf configMap: name: redis-cluster defaultMode: 0755 volumeClaimTemplates: # pvcæ¨¡æ¿ - metadata: name: data annotations: volume.beta.kubernetes.io/storage-class: nfs-storage # æŒ‡å®šå­˜å‚¨ç±»ä¸ºnfs-storage spec: accessModes: [ &quot;ReadWriteOnce&quot; ] resources: requests: storage: 1Gi # æŒ‡å®šæŒä¹…å·å¤§å° --- apiVersion: v1 kind: Service metadata: name: redis-cluster spec: type: ClusterIP ports: - port: 6379 targetPort: 6379 name: client - port: 16379 targetPort: 16379 name: gossip selector: app: redis-cluster åˆå§‹åŒ–é›†ç¾¤ $kubectl exec -it redis-cluster-0 -- redis-cli --cluster create --cluster-replicas 1 $(kubectl get pods -l app=redis-cluster -o jsonpath='{range.items[*]}{.status.podIP}:6379 ') æµ‹è¯• ä½¿ç”¨redis-cli -cæµ‹è¯•é›†ç¾¤å‘½ä»¤ å‚è€ƒé“¾æ¥ Deploying Redis Cluster on Top of Kubernetes Is it possible to create a Redis Cluster within Kubernetes using a Istio Search Mesh?","tags":[{"name":"K8S","slug":"K8S","permalink":"http://www.lockey.xyz/tags/K8S/"},{"name":"istio","slug":"istio","permalink":"http://www.lockey.xyz/tags/istio/"},{"name":"Redis","slug":"Redis","permalink":"http://www.lockey.xyz/tags/Redis/"},{"name":"é›†ç¾¤","slug":"é›†ç¾¤","permalink":"http://www.lockey.xyz/tags/%E9%9B%86%E7%BE%A4/"}]},{"title":"Ubuntu18.04 NFS å®‰è£…ä½¿ç”¨","date":"2020-03-25T06:12:31.000Z","path":"2020/03/25/Linux/Ubuntu18.04--NFSå®‰è£…ä½¿ç”¨/","text":"ç¯å¢ƒ Ubuntu 18.04 å®‰è£… å®‰è£…è½¯ä»¶åŒ… $apt install nfs-kernel-server å¦‚å‡ºç°ä¾èµ–é”™è¯¯ â†“ . . . The following packages have unmet dependencies: nfs-kernel-server : Depends: libtirpc1 but it is not going to be installed Depends: nfs-common (= 1:1.2.8-6ubuntu1.2) but it is not going to be installed E: Unable to correct problems, you have held broken packages. é”™è¯¯è§£å†³åŠæ³•ï¼š apt å®‰è£…ä¾èµ– ç¬¬ä¸€æ­¥å¦‚æœå‡ºç°æ›´å¤šä¾èµ–æŠ¥é”™çœ‹ç¬¬ 3 æ­¥ æ‰‹åŠ¨å®‰è£… ä¸‹è½½å®‰è£…åŒ…ï¼ˆlibtirpc1_0.2.5-1.2ubuntu0.1_amd64.debï¼‰nfs-kernel-server_1.3.4-2.1ubuntu5_amd64.debnfs-common_1.3.4-2.1ubuntu5_amd64.debkeyutils_1.5.9-9.2ubuntu2_amd64.deb ä½¿ç”¨dpkg -iå®‰è£…ä¸‹è½½å¥½çš„ deb åŒ…ï¼›å¦‚å‡ºç°é”™è¯¯æç¤ºï¼Œå¯ä»¥æ ¹æ®æç¤ºä½¿ç”¨ apt æˆ–å†ä¸‹è½½å®‰è£…åŒ…å®‰è£… å†æœ‰é—®é¢˜å¯ä»¥ä½¿ç”¨ journalctl ç­‰å·¥å…·æ’æŸ¥é—®é¢˜ é…ç½® åˆ›å»ºå¯¼å‡ºç›®å½•ï¼ˆæœåŠ¡ç«¯ã€å®¢æˆ·ç«¯å…±äº«ç›®å½•ï¼‰$mkdir -p /xxx/xxxxx å¼€æ”¾æƒé™$chown nobody:nogroup /xxx/xxxxx &amp;&amp; chmod 777 /xxx/xxxxx(æƒé™å¼€æ”¾è‡ªå·±æ§åˆ¶ï¼Œå…¨å¼€æœ‰é£é™©ï¼Œéœ€è°¨æ…ä½¿ç”¨) é…ç½®å¯¼å‡ºç›®å½•æƒé™$vim /etc/exports(å…·ä½“è§„åˆ™ exports é‡Œæœ‰ example) é‡å¯ nfs-kernel-serverã€rpcbind æœåŠ¡ ä½¿ç”¨ å®¢æˆ·ç«¯ä¸»æœºéœ€è¦å®‰è£… nfs-common å®‰è£…æ–¹æ³•åŒä¸Š åœ¨å®¢æˆ·ç«¯ä¸»æœºåˆ›å»ºæŒ‚è½½ç›®å½• $mkdir -p /xxx/xxxxx æŒ‚è½½ $mount -t nfs &lt;NFSæœåŠ¡ç«¯ä¸»æœºIP&gt;:&lt;NFSæœåŠ¡ç«¯ä¸»æœºå¯¼å‡ºç›®å½•&gt; &lt;å®¢æˆ·ç«¯ä¸»æœºæŒ‚è½½ç›®å½•&gt; æµ‹è¯• åœ¨å®¢æˆ·ç«¯æŒ‚è½½ç›®å½•ä¸­æ“ä½œï¼ˆåˆ›å»ºæ–‡ä»¶ã€æ–‡ä»¶å¤¹ç­‰ï¼‰ï¼Œèƒ½åœ¨æœåŠ¡ç«¯å¯¼å‡ºç›®å½•ä¸­åŒæ­¥ åœ¨æœåŠ¡ç«¯å¯¼å‡ºç›®å½•ä¸­æ“ä½œï¼ˆåˆ›å»ºæ–‡ä»¶ã€æ–‡ä»¶å¤¹ç­‰ï¼‰ï¼Œèƒ½åœ¨å®¢æˆ·ç«¯æŒ‚è½½ç›®å½•ä¸­åŒæ­¥","tags":[{"name":"NFS","slug":"NFS","permalink":"http://www.lockey.xyz/tags/NFS/"},{"name":"nfs-kernel-server","slug":"nfs-kernel-server","permalink":"http://www.lockey.xyz/tags/nfs-kernel-server/"},{"name":"Depends","slug":"Depends","permalink":"http://www.lockey.xyz/tags/Depends/"}]},{"title":"istio å®‰è£…ä½¿ç”¨","date":"2020-03-16T08:06:48.000Z","path":"2020/03/16/DevOps/istioå®‰è£…ä½¿ç”¨/","text":"æ¦‚å¿µ Istio æ˜¯Googleã€IBM å’ŒLyft è”åˆå¼€æºçš„æœåŠ¡ç½‘æ ¼ï¼ˆService Meshï¼‰æ¡†æ¶ï¼Œæ—¨åœ¨è§£å†³å¤§é‡å¾®æœåŠ¡çš„å‘ç°ã€è¿æ¥ã€ç®¡ç†ã€ç›‘æ§ä»¥åŠå®‰å…¨ç­‰é—®é¢˜ã€‚ Istio å¯¹åº”ç”¨æ˜¯é€æ˜çš„ï¼Œä¸éœ€è¦æ”¹åŠ¨ä»»ä½•æœåŠ¡ä»£ç å°±å¯ä»¥å®ç°é€æ˜çš„æœåŠ¡æ²»ç†ã€‚ å®˜æ–¹æ–‡æ¡£ï¼ˆä¸­è‹±æ–‡å¯åˆ‡æ¢ï¼‰ istio æ³¨æ„ å®˜æ–¹æ–‡æ¡£å®åœ¨å¤ªå…¨äº†ï¼Œæ²¡ä»€ä¹ˆå¥½æ•´ç†çš„ ç¨å¾®é˜…è¯»æ–‡æ¡£é‡Œçš„â€œæ¦‚å¿µéƒ¨åˆ†â€ å®‰è£…istio æ¨èä½¿ç”¨ï¼šistioctlï¼›helm æ–¹å¼åœ¨æ–°ç‰ˆæœ¬å·²ç»å¼ƒç”¨ istio é»˜è®¤ä½¿ç”¨å›½å¤–é•œåƒä»“åº“ï¼Œå¯ä»¥è‡ªè¡Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆinstall &gt; kubenetesï¼‰ å®‰è£…ç¤ºä¾‹èµ°ä¸€é å®‰è£…ä»»åŠ¡èµ°ä¸€é istio æ¥ç®¡äº†ç½‘ç»œï¼Œä¼šå¯¹éƒ¨åˆ†ç¬¬ä¸‰æ–¹æœåŠ¡çš„ç½‘ç»œè®¿é—®é€ æˆå½±å“(å¦‚ï¼šRedis é›†ç¾¤çš„åˆå§‹åŒ–ç­‰)","tags":[{"name":"K8S","slug":"K8S","permalink":"http://www.lockey.xyz/tags/K8S/"},{"name":"Kubernetes","slug":"Kubernetes","permalink":"http://www.lockey.xyz/tags/Kubernetes/"},{"name":"istio","slug":"istio","permalink":"http://www.lockey.xyz/tags/istio/"},{"name":"Server Mesh","slug":"Server-Mesh","permalink":"http://www.lockey.xyz/tags/Server-Mesh/"}]},{"title":"Docker å¼€æºä»“åº“ç³»ç»Ÿ Harbor æ­å»ºä¸ä½¿ç”¨","date":"2020-03-12T10:21:45.000Z","path":"2020/03/12/DevOps/Dockerå¼€æºä»“åº“ç³»ç»ŸHarboræ­å»ºä¸ä½¿ç”¨/","text":"ç®€ä»‹ å®˜æ–¹ Harboræ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨é•œåƒç®¡ç†ç³»ç»Ÿï¼Œå®ƒé€šè¿‡åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶æ¥ä¿æŠ¤é•œåƒï¼Œæ‰«æé•œåƒä¸­çš„æ¼æ´ï¼Œå¹¶å°†å›¾åƒç­¾åä¸ºå¯ä¿¡çš„ã€‚ä½œä¸ºä¸€ä¸ªCNCFå­µåŒ–é¡¹ç›®ï¼ŒHarbor ä¸ºæ‚¨æä¾›äº†åˆè§„æ€§ã€æ€§èƒ½å’Œäº’æ“ä½œæ€§ï¼Œå¸®åŠ©æ‚¨è·¨äº‘åŸç”Ÿè®¡ç®—å¹³å°(å¦‚ Kubernetes å’Œ Docker )ä¸€è‡´è€Œå®‰å…¨åœ°ç®¡ç†é•œåƒã€‚ éå®˜æ–¹ å¼€æº ä¼ä¸šçº§å®¹å™¨é•œåƒç®¡ç†ç³»ç»Ÿ æˆç†Ÿ ç”Ÿæ€å¥å…¨ ä½¿ç”¨çš„å¤§å‚ä¼—å¤š æ­é…åœ¨é›†ç¾¤å†…éƒ¨ï¼ŒåŠ é€Ÿé›†ç¾¤åˆ›å»ºã€å‡çº§ ç¯å¢ƒ æ“ä½œç³»ç»Ÿï¼šLinux(Ubuntu18.04) å®¹å™¨ç®¡ç†ï¼šDocker + Docker-Compose å®‰è£… ä¸‹è½½å®‰è£…åŒ… è§£å‹å¹¶è¿›å…¥å®‰è£…åŒ… ä¿®æ”¹harbor.ymlé…ç½®ï¼ˆhostnameã€harbor_admin_passwordç­‰ï¼‰ ä¿®æ”¹docker-compose.ymlï¼ˆå¦‚éœ€è¦ä¿®æ”¹é•œåƒæºç­‰ï¼Œæœ‰æ¡ä»¶å¯ä»¥ç•¥è¿‡ï¼‰ ä½¿ç”¨ docker-compose å¯åŠ¨ Harbor ä½¿ç”¨ å‘½ä»¤è¡Œæ“ä½œä¸ DockerHUB åŸºæœ¬ä¸€è‡´ æµè§ˆå™¨ ä¿®æ”¹ /etc/hosts æ–‡ä»¶ï¼Œè®¾ç½®ç›®æ ‡ä¸»æœºIPå’Œ harbor.yml ä¸­è®¾ç½®çš„ hostname ä½¿ç”¨é»˜è®¤ç”¨æˆ·å admin å’Œ harbor.yml ä¸­è®¾ç½®çš„å¯†ç ç™»å½• æ³¨æ„äº‹é¡¹ ä½¿ç”¨ç§æœ‰ä»“åº“æ—¶ï¼š é¦–å…ˆéœ€è¦åœ¨ Docker å®¢æˆ·æœºä¸Šç™»å½•ï¼ˆ$docker login &lt;hostname&gt;ï¼‰ æ–°ç‰ˆæœ¬ä½¿ç”¨ httpsï¼Œå¦‚ç™»å½•ä¸ä¸Šï¼š ä¿®æ”¹ daemon.json å¢åŠ  insecure registriesï¼ˆè§ä¸‹é¢ç¤ºä¾‹ â†“ï¼‰ é‡å¯ docker æœåŠ¡ Docker daemon.json å¢åŠ  insecure registries vim /etc/docker/daemon.json --- { &quot;registry-mirrors&quot;: [&quot;https://xxx.mirror.aliyuncs.com&quot;], &quot;insecure-registries&quot; : [&quot;&lt;harbor hostname&gt;&quot;] } --- systemctl daemon-reload systemctl restart docker","tags":[{"name":"Docker","slug":"Docker","permalink":"http://www.lockey.xyz/tags/Docker/"},{"name":"Harbor","slug":"Harbor","permalink":"http://www.lockey.xyz/tags/Harbor/"},{"name":"å®¹å™¨","slug":"å®¹å™¨","permalink":"http://www.lockey.xyz/tags/%E5%AE%B9%E5%99%A8/"},{"name":"ä»“åº“","slug":"ä»“åº“","permalink":"http://www.lockey.xyz/tags/%E4%BB%93%E5%BA%93/"}]},{"title":"Ubuntu18.04 KVM å®‰è£…ä½¿ç”¨ï¼ˆGUIï¼‰","date":"2020-03-12T06:22:05.000Z","path":"2020/03/12/Linux/Ubuntu18.04--KVMå®‰è£…ä½¿ç”¨/","text":"å‡†å¤‡ æ£€æŸ¥ç¡¬ä»¶è™šæ‹ŸåŒ–æ”¯æŒ $egrep -c '(vmx|svm)' /proc/cpuinfo è¾“å‡ºå¤§äº0å³å¯ æ£€æŸ¥ç¡¬ä»¶åŠ é€Ÿ KVM æ”¯æŒ $apt install cpu-checker $kvm-ok è¾“å‡ºï¼šKVM acceleration can be usedå³å¯ æ¡¥æ¥æ¨¡å¼(å¯é€‰) è®¾ç½®å®¿ä¸»æœºæ¡¥æ¥ç½‘ç»œï¼ŒNetplan æ¨¡å¼ä¸‹çš„ NetworkManager ç®¡ç†æ–¹å¼ä½¿ç”¨ $nm-connection-editorè¿›è¡Œç®¡ç† å®‰è£… KVM $apt install -y qemu qemu-kvm libvirt-bin bridge-utils virt-manager å¯åŠ¨å’Œå¼€æœºå¯åŠ¨ libvirt æœåŠ¡ $systemctl start libvirtd $systemctl enable libvirtd ä½¿ç”¨ KVM å¯ä»¥ä½¿ç”¨ $virt-manager GUI ç•Œé¢ç®¡ç† å®‰è£…å®Œç³»ç»Ÿï¼Œè®¾ç½®è®¾ç½®è™šæ‹Ÿæœº NIC ä¿¡æ¯ï¼ˆåœ¨è™šæ‹Ÿæœºä¿¡æ¯é¢æ¿ï¼‰ä¸ºï¼šæŒ‡å®šå…±äº«è®¾å¤‡ï¼Œè¾“å…¥å®¿ä¸»æœºæ¡¥æ¥ç½‘ç»œå(å¦‚ï¼šbr0)ï¼Œé€‰æ‹© virtio å³å¯ åšä¸»æ¡¥æ¥ç½‘ç»œè®¾ç½®é™æ€ IP æ²¡æˆåŠŸï¼Œå®åœ¨ä¸è¡Œå¯ä»¥ä½¿ç”¨ DHCP è‡ªåŠ¨åˆ†å‘ï¼ KVM å¸¸ç”¨å‘½ä»¤ å‘½ä»¤ | åŠŸèƒ½ | å¤‡æ³¨ â€”:---:â€” virsh list | æŸ¥çœ‹è¿è¡Œè™šæ‹Ÿæœº | æŸ¥çœ‹æ‰€æœ‰å¯ä»¥åŠ --allå‚æ•° æœªå®Œâ€¦å¾…ç»­â€¦","tags":[{"name":"KVM","slug":"KVM","permalink":"http://www.lockey.xyz/tags/KVM/"},{"name":"Ubuntu18.04","slug":"Ubuntu18-04","permalink":"http://www.lockey.xyz/tags/Ubuntu18-04/"}]},{"title":"Linux åŸºç¡€éšç¬”","date":"2020-03-12T02:58:56.000Z","path":"2020/03/12/Linux/LinuxåŸºç¡€éšç¬”/","text":"Linux ä¸ å‘è¡Œç‰ˆ å‘è¡Œç‰ˆ Ubuntu é•œåƒç‰ˆæœ¬ä¸åç¼€ ç‰ˆæœ¬ ç‰ˆæœ¬é—´å…·ä½“åŒºåˆ«è§å®˜ç½‘ æ›´æ–°é—´éš”é€šå¸¸ä¸º6ä¸ªæœˆ æŠ€æœ¯æ”¯æŒè‡³å°‘æä¾›18ä¸ªæœˆï¼›LTSï¼ˆLong Time Supportï¼‰Desktopç‰ˆæœ¬è‡³å°‘3å¹´ï¼ŒServerç‰ˆæœ¬è‡³å°‘5å¹´ ç‰ˆæœ¬å·é€šå¸¸ä¸º xx.10 Desktop æ¡Œé¢ç‰ˆï¼šé€šå¸¸æŒ‡å¸¦æ“ä½œç•Œé¢çš„ç‰ˆæœ¬ï¼ˆç±»ä¼¼ Win ç³»ç»Ÿå’Œ Mac ç³»ç»Ÿï¼‰ Live-Server æœåŠ¡å™¨ç‰ˆï¼šé€šå¸¸ä¸åŒ…å«ç•Œé¢ï¼Œæ“ä½œé å‘½ä»¤ç»ˆç«¯ï¼Œå®‰è£…æ—¶å¯ä»¥é€‰æ‹©æ€§å®‰è£…é¢å¤–æ’ä»¶æˆ–æœ€å°åŒ–å®‰è£…ã€‚å¤§éƒ¨åˆ†æœåŠ¡å™¨ä¼šé€‰æ‹©è¿™ç§ç±»å‹çš„é•œåƒã€‚","tags":[{"name":"Linux","slug":"Linux","permalink":"http://www.lockey.xyz/tags/Linux/"},{"name":"åŸºç¡€","slug":"åŸºç¡€","permalink":"http://www.lockey.xyz/tags/%E5%9F%BA%E7%A1%80/"}]},{"title":"é«˜å¯ç”¨K8Sæ­å»ºï¼ˆUbuntu18.04ï¼‰","date":"2020-03-11T02:53:25.000Z","path":"2020/03/11/DevOps/é«˜å¯ç”¨K8Sæ­å»º/","text":"æœ¬æ–‡èµ„æ–™æ•´ç†è‡ªç½‘ç»œï¼Œå¯¹å…¶ä¸­è¿‡æ—¶éƒ¨åˆ†è¿›è¡Œä¿®æ­£ï¼ è¿è¡Œç¯å¢ƒä¸ºï¼šKVM è™šæ‹Ÿæœºï¼ˆå…ˆæ ¹æ®ä¸‹æ–‡ç¬¬ä¸€éƒ¨åˆ†åˆ¶ä½œåŸºç¡€é•œåƒï¼Œå†ç”¨åŸºç¡€é•œåƒå…‹éš†ä¸ºå„ä¸ª masterã€worker èŠ‚ç‚¹ï¼Œå¯ä»¥èŠ‚çœæ—¶é—´ï¼‰ é€‚ç”¨ç‰ˆæœ¬ä¸ºï¼š æ“ä½œç³»ç»Ÿï¼šUbuntu18.04 Kubeadmï¼šGitVersion:&quot;v1.17.3&quot; K8Sç»„ä»¶ç‰ˆæœ¬å¦‚ä¸‹ï¼š kube-apiserver:v1.17.4 kube-controller-manager:v1.17.4 kube-scheduler:v1.17.4 kube-proxy:v1.17.4 pause:3.1 etcd:3.4.3-0 coredns:1.6.5 ç¬¬ä¸€éƒ¨åˆ†----åŸºç¡€é•œåƒå‡†å¤‡ Harbor å®‰è£… è¯¦è§ ç¡®ä¿èŠ‚ç‚¹ä¹‹ä¸­ä¸å¯ä»¥æœ‰é‡å¤çš„ä¸»æœºåã€MAC åœ°å€æˆ– product_uuid hostname ä¿®æ”¹ Ubuntuï¼šhostnamectl set-hostname xxx æŸ¥çœ‹ product_uuid sudo cat /sys/class/dmi/id/product_uuid å…³é—­é˜²ç«å¢™ï¼ˆç”Ÿäº§ç¯å¢ƒä¸å»ºè®®å…³é—­ï¼‰ systemctl stop ufw systemctl disable ufw ç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®å¯ç”¨é˜²ç«å¢™ï¼Œå¹¶å¼€å¯ etcdã€apiserverç­‰å¤šä¸ªç«¯å£ å…³é—­ swap æŸ¥çœ‹ swapï¼š$cat /proc/swaps æ³¨é‡Š swap è®¾ç½®ï¼š$vim /etc/fstab å…³é—­ swapï¼š$swapoff -a ç¦ç”¨ GRUB ipv6 ç¼–è¾‘ï¼š$vim /etc/default/grub ä¿®æ”¹ï¼š GRUB_CMDLINE_LINUX_DEFAULT=&quot;&quot; GRUB_CMDLINE_LINUX=&quot;&quot; â†“ GRUB_CMDLINE_LINUX_DEFAULT=&quot;ipv6.disable=1&quot; GRUB_CMDLINE_LINUX=&quot;ipv6.disable=1&quot; æ›´æ–°ï¼š$update-grub è®¾ç½®å¯¹åº”æ—¶åŒºï¼ˆå¦‚ä¸Šæµ·ï¼‰ æ‰§è¡Œï¼š$ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime è®¾ç½® DNS ç¼–è¾‘ï¼š$vim /etc/systemd/resolved.conf ä¿®æ”¹ï¼š # åœ°å€æ¥è‡ªé˜¿é‡Œ DNS DNS=223.5.5.5 223.6.6.6 å‡çº§æ“ä½œç³»ç»Ÿå†…æ ¸ å‚è€ƒè‡ªé’æœ¨ã®Javaå°å±‹ æŸ¥çœ‹æœ¬æœºå†…æ ¸ï¼š$uname -a å¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©ç‰ˆæœ¬ æ‰§è¡Œï¼š$dpkg -i xxx.debå‡çº§å†…æ ¸ï¼ˆå¯ä½¿ç”¨é€šé…ç¬¦ï¼‰ æ¸…ç†æ—§å†…æ ¸ï¼š$dpkg --list | grep linux | awk '{print $2}' | grep æ—§å†…æ ¸ç‰ˆæœ¬ | xargs apt purge -y å†…æ ¸æ“ä½œé£é™©è¾ƒå¤§ï¼Œè¯·ä¸€æ­¥æ­¥ç¡®è®¤æ²¡é—®é¢˜å†æ‰§è¡Œï¼ å¯ç”¨ IPVS å†…æ ¸æ¨¡å— æ‰§è¡Œï¼š echo &gt; /etc/modules-load.d/ipvs.conf module=(ip_vs ip_vs_rr ip_vs_wrr ip_vs_sh ip_vs_lc br_netfilter nf_conntrack) for kernel_module in ${module[@]};do /sbin/modinfo -F filename $kernel_module |&amp; grep -qv ERROR &amp;&amp; echo $kernel_module &gt;&gt; /etc/modules-load.d/ipvs.conf || : done æŸ¥çœ‹ï¼š$lsmod | grep ip_vs è¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ä¸ºæˆåŠŸ â†“ ip_vs_sh 16384 0 ip_vs_wrr 16384 0 ip_vs_rr 16384 0 ip_vs 147456 6 ip_vs_rr,ip_vs_sh,ip_vs_wrr nf_conntrack 143360 6 xt_conntrack,nf_nat,ipt_MASQUERADE,nf_nat_ipv4,nf_conntrack_netlink,ip_vs libcrc32c 16384 5 nf_conntrack,nf_nat,btrfs,raid456,ip_vs å†…æ ¸å‚æ•°è°ƒæ•´ cat &gt; /etc/sysctl.conf &lt;&lt; EOF # https://github.com/moby/moby/issues/31208 # ipvsadm -l --timout # ä¿®å¤ipvsæ¨¡å¼ä¸‹é•¿è¿æ¥timeouté—®é¢˜ å°äº900å³å¯ net.ipv4.tcp_keepalive_time = 800 net.ipv4.tcp_keepalive_intvl = 30 net.ipv4.tcp_keepalive_probes = 10 net.ipv6.conf.all.disable_ipv6 = 1 net.ipv6.conf.default.disable_ipv6 = 1 net.ipv6.conf.lo.disable_ipv6 = 1 net.ipv4.neigh.default.gc_stale_time = 120 net.ipv4.conf.all.rp_filter = 0 net.ipv4.conf.default.rp_filter = 0 net.ipv4.conf.default.arp_announce = 2 net.ipv4.conf.lo.arp_announce = 2 net.ipv4.conf.all.arp_announce = 2 net.ipv4.ip_forward = 1 net.ipv4.tcp_max_tw_buckets = 5000 net.ipv4.tcp_syncookies = 1 net.ipv4.tcp_max_syn_backlog = 1024 net.ipv4.tcp_synack_retries = 2 net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 fs.inotify.max_user_watches=89100 fs.file-max=52706963 fs.nr_open=52706963 net.bridge.bridge-nf-call-arptables = 1 vm.swappiness = 0 vm.max_map_count=262144 EOF ç¡®ä¿ iptables å·¥å…·ä¸ä½¿ç”¨ nftables åç«¯ åˆ‡æ¢æ—§ç‰ˆï¼ˆUbuntuï¼‰ update-alternatives --set iptables /usr/sbin/iptables-legacy update-alternatives --set ip6tables /usr/sbin/ip6tables-legacy update-alternatives --set arptables /usr/sbin/arptables-legacy update-alternatives --set ebtables /usr/sbin/ebtables-legacy docker-ce å®‰è£… å®‰è£…ä¾èµ–ç³»ç»Ÿå·¥å…·ï¼š$apt install -y apt-transport-https ca-certificates curl software-properties-common å®‰è£…GPGè¯ä¹¦ï¼š$curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add - å†™å…¥æºï¼š$add-apt-repository &quot;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable&quot; æ‰§è¡Œï¼š$apt update å®‰è£… docker-ceï¼š$apt install -y docker-ceï¼ˆå¦å¯æŒ‡å®šç‰ˆæœ¬å·å®‰è£…æŒ‡å®šç‰ˆæœ¬ï¼‰ è®¾ç½®é•œåƒåŠ é€Ÿï¼Œå¯ä»¥é€‰æ‹©é˜¿é‡Œäº‘é•œåƒåŠ é€ŸæœåŠ¡ï¼Œè¯¦è§é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿé¡µé¢æ–‡æ¡£ docker-compose å®‰è£… æ‰§è¡Œï¼š curl -L https://github.com/docker/compose/releases/download/1.25.4/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose chmod +x /usr/local/bin/docker-compose Kubeadm å¥—ä»¶å®‰è£…ï¼ˆå›½å†…ï¼‰ æ–°å¢æºæ–‡ä»¶ï¼š$vim /etc/apt/sources.list.d/kubernetes.list å†™å…¥æºï¼š$deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main æ‰§è¡Œï¼š$apt update å¾—åˆ°é”™è¯¯ä¿¡æ¯çš„ key çš„æœ«å°¾8ä½ æ‰§è¡Œï¼š$gpg --keyserver keyserver.ubuntu.com --recv-keys ã€8ä½keyã€‘ æ‰§è¡Œï¼š$gpg --export --armor ã€8ä½keyã€‘ | sudo apt-key add - å†æ¬¡æ‰§è¡Œï¼š$apt update å®‰è£… Kubeadm å¥—ä»¶ï¼š$apt install -y kubelet kubeadm kubectl ç¬¬äºŒéƒ¨åˆ†----é«˜å¯ç”¨é›†ç¾¤æ­å»º æœ¬æ–‡é«˜å¯ç”¨æ¨¡å¼ä¸ºï¼šETCD é«˜å¯ç”¨ + API-Server é«˜å¯ç”¨ ETCDï¼šç”±äº ETCD ä½¿ç”¨ Raft ç®—æ³•ï¼Œæ‰€ä»¥èŠ‚ç‚¹ä¸€èˆ¬ä¸ºå¥‡æ•°ä¸ªï¼Œæœ¬æ–‡ä½¿ç”¨3ä¸ªèŠ‚ç‚¹ API-Serverï¼šæœ¬æ–‡ä½¿ç”¨3ä¸ªèŠ‚ç‚¹ Nginx æœ¬åœ°ä»£ç† ç”¨äºè®¿é—® master èŠ‚ç‚¹ï¼Œå¹¶åœ¨å…¶ä¸­æŸäº› master èŠ‚ç‚¹ä¸å¯ç”¨æ—¶ï¼Œè‡ªåŠ¨è®¿é—®å¯ç”¨èŠ‚ç‚¹ã€‚ å¯ä»¥éƒ¨ç½²åœ¨æ¯ä¸€å° K8S èŠ‚ç‚¹ä¸Šéƒ¨ç½²ï¼Œä¹Ÿå¯å¦å¤–éƒ¨ç½²å¤–éƒ¨ Nginx è´Ÿè½½å‡è¡¡èŠ‚ç‚¹ï¼Œæœ¬æ–‡åœ¨æ¯å° K8S èŠ‚ç‚¹ä¸Šå‡æœ‰éƒ¨ç½² é…ç½® master èŠ‚ç‚¹ hosts cat &gt;&gt; /etc/hosts &lt;&lt; EOF 127.0.0.1 server.k8s.local 10.0.0.65 server1.k8s.local 10.0.0.66 server2.k8s.local 10.0.0.67 server3.k8s.local EOF IP è¯·è·Ÿè¯·æ ¹æ®å®é™…æƒ…å†µæ›¿æ¢ ç¼–å†™ Nginx é…ç½®æ–‡ä»¶ mkdir -p /etc/nginx cat &gt; /etc/nginx/nginx.conf &lt;&lt; EOF worker_processes auto; user root; events { worker_connections 20240; use epoll; } error_log /var/log/nginx_error.log info; stream { upstream kube-servers { hash $remote_addr consistent; server server1.k8s.local:6443 weight=5 max_fails=1 fail_timeout=3s; server server2.k8s.local:6443 weight=5 max_fails=1 fail_timeout=3s; server server3.k8s.local:6443 weight=5 max_fails=1 fail_timeout=3s; } server { listen 8443 reuseport; proxy_connect_timeout 3s; # åŠ å¤§timeout proxy_timeout 3000s; proxy_pass kube-servers; } } EOF å¯åŠ¨ Nginx docker run --restart=always \\ -v /etc/apt/sources.list:/etc/apt/sources.list \\ -v /etc/nginx/nginx.conf:/etc/nginx/nginx.conf \\ --name kps \\ --net host \\ -it \\ -d \\ nginx é«˜å¯ç”¨å¤–éƒ¨ ETCD é›†ç¾¤æ­å»º ç”±äº etcd ä¸éœ€è¦å¯¹å¤–å¼€æ”¾ï¼Œæ‰€ä»¥æœ¬æ–‡ä¸ä½¿ç”¨ tls å¯åŠ¨å‚æ•°æ³¨æ„äº‹é¡¹ï¼š â€“auto-compaction-retention ç”±äºETCDæ•°æ®å­˜å‚¨å¤šç‰ˆæœ¬æ•°æ®ï¼Œéšç€å†™å…¥çš„ä¸»é”®å¢åŠ å†å²ç‰ˆæœ¬éœ€è¦å®šæ—¶æ¸…ç†ï¼Œé»˜è®¤çš„å†å²æ•°æ®æ˜¯ä¸ä¼šæ¸…ç†çš„ï¼Œæ•°æ®è¾¾åˆ°2Gå°±ä¸èƒ½å†™å…¥ï¼Œå¿…é¡»è¦æ¸…ç†å‹ç¼©å†å²æ•°æ®æ‰èƒ½ç»§ç»­å†™å…¥;æ‰€ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼Œåœ¨ä¸Šç”Ÿäº§ç¯å¢ƒä¹‹å‰å°±æå‰ç¡®å®šï¼Œå†å²æ•°æ®å¤šé•¿æ—¶é—´å‹ç¼©ä¸€æ¬¡;æ¨èä¸€å°æ—¶å‹ç¼©ä¸€æ¬¡æ•°æ®è¿™æ ·å¯ä»¥æå¤§çš„ä¿è¯é›†ç¾¤ç¨³å®šï¼Œå‡å°‘å†…å­˜å’Œç£ç›˜å ç”¨ â€“max-request-bytes etcd Raftæ¶ˆæ¯æœ€å¤§å­—èŠ‚æ•°ï¼ŒETCDé»˜è®¤è¯¥å€¼ä¸º1.5M; ä½†æ˜¯å¾ˆå¤šä¸šåŠ¡åœºæ™¯å‘ç°åŒæ­¥æ•°æ®çš„æ—¶å€™1.5Må®Œå…¨æ²¡æ³•æ»¡è¶³è¦æ±‚ï¼Œæ‰€ä»¥æå‰ç¡®å®šåˆå§‹å€¼å¾ˆé‡è¦;ç”±äº1.5Må¯¼è‡´æˆ‘ä»¬çº¿ä¸Šçš„ä¸šåŠ¡æ— æ³•å†™å…¥å…ƒæ•°æ®çš„é—®é¢˜ï¼Œæˆ‘ä»¬ç´§æ€¥å‡çº§ä¹‹åæŠŠè¯¥å€¼ä¿®æ”¹ä¸ºé»˜è®¤32Mï¼Œä½†æ˜¯å®˜æ–¹æ¨èçš„æ˜¯10Mï¼Œå¤§å®¶å¯ä»¥æ ¹æ®ä¸šåŠ¡æƒ…å†µè‡ªå·±è°ƒæ•´ â€“quota-backend-bytes ETCD dbæ•°æ®å¤§å°ï¼Œé»˜è®¤æ˜¯2Gï¼Œå½“æ•°æ®è¾¾åˆ°2Gçš„æ—¶å€™å°±ä¸å…è®¸å†™å…¥ï¼Œå¿…é¡»å¯¹å†å²æ•°æ®è¿›è¡Œå‹ç¼©æ‰èƒ½ç»§ç»­å†™å…¥;å‚åŠ 1é‡Œé¢è¯´çš„ï¼Œæˆ‘ä»¬å¯åŠ¨çš„æ—¶å€™å°±åº”è¯¥æå‰ç¡®å®šå¤§å°ï¼Œå®˜æ–¹æ¨èæ˜¯8Gï¼Œè¿™é‡Œæˆ‘ä»¬ä¹Ÿä½¿ç”¨8Gçš„é…ç½® åœ¨ etcd é›†ç¾¤ä¸ªèŠ‚ç‚¹ä¸»æœºä¸Šè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ˆæ³¨æ„ä¿®æ”¹ä¸­æ‹¬å·å†…å¯¹åº”çš„ä¿¡æ¯ï¼‰ï¼š mkdir -p /var/etcd docker rm [name] -f rm -rf /var/etcd/* docker run --restart=always --net host -it --name [name] -d \\ -v /var/etcd:/var/etcd \\ -v /etc/localtime:/etc/localtime \\ [ä»“åº“å]/etcd:[ç‰ˆæœ¬å·] \\ etcd --name [etcd name] \\ --auto-compaction-retention &quot;1h&quot; --max-request-bytes &quot;33554432&quot; --quota-backend-bytes &quot;8589934592&quot; \\ --data-dir=/var/etcd/etcd-data \\ --listen-client-urls http://0.0.0.0:2379 \\ --listen-peer-urls http://0.0.0.0:2380 \\ --initial-advertise-peer-urls http://[æœ¬èŠ‚ç‚¹åŸŸåæˆ–IP]:2380 \\ --advertise-client-urls http://[æœ¬èŠ‚ç‚¹åŸŸåæˆ–IP]:2379,http://[æœ¬èŠ‚ç‚¹åŸŸåæˆ–IP]:2380 \\ -initial-cluster-token etcd-cluster \\ -initial-cluster &quot;[æœ¬æœº etcd name]=http://[æœ¬èŠ‚ç‚¹åŸŸåæˆ–IP]:2380,[å…¶ä»–etcd name1]=http://[å…¶ä»–èŠ‚ç‚¹åŸŸåæˆ–IP]:2380,[å…¶ä»–etcd name2]=http://[å…¶ä»–èŠ‚ç‚¹åŸŸåæˆ–IP]:2380&quot; \\ -initial-cluster-state new æµ‹è¯• etcd é›†ç¾¤ è¿›å…¥æ­£åœ¨è¿è¡Œçš„ etcd å®¹å™¨ï¼š$docker exec -it [name] sh æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š$etcdctl --write-out=table --endpoints=&quot;http://[èŠ‚ç‚¹åŸŸåæˆ–IP]:2379,http://[èŠ‚ç‚¹åŸŸåæˆ–IP]:2379,http://[èŠ‚ç‚¹åŸŸåæˆ–IP]:2379&quot; endpoint status æŸ¥çœ‹é›†ç¾¤å¥åº·ï¼š$etcdctl --write-out=table --endpoints=&quot;http://[èŠ‚ç‚¹åŸŸåæˆ–IP]:2379,http://[èŠ‚ç‚¹åŸŸåæˆ–IP]:2379,http://[èŠ‚ç‚¹åŸŸåæˆ–IP]:2379&quot; endpoint health æµ‹è¯•é›†ç¾¤å¯ç”¨æ€§ï¼š # ä»»æ„èŠ‚ç‚¹å­˜å…¥æ•°æ® etcdctl put /test/key &quot;123&quot; # ä»»æ„èŠ‚ç‚¹å–å‡ºæ•°æ®ï¼Œå–å‡ºæ­£å¸¸ï¼Œé›†ç¾¤å¯ç”¨ etcdctl get /test/key API-Serverï¼ˆMasterï¼‰ é«˜å¯ç”¨ é…ç½®è‡ªå®šä¹‰ kubeadm-config.yaml æ³¨æ„ä¿®æ”¹å¯¹åº”çš„ç‰ˆæœ¬å·ï¼Œä»“åº“è·¯å¾„ç­‰ apiVersion: kubeadm.k8s.io/v1beta1 kind: ClusterConfiguration kubernetesVersion: v1.17.0 imageRepository: [ä»“åº“è·¯å¾„] apiServer: extraArgs: storage-backend: etcd3 extraVolumes: - hostPath: /etc/localtime mountPath: /etc/localtime name: localtime certSANs: - &quot;prod-server.k8s.local&quot; - &quot;server1.k8s.local&quot; - &quot;server2.k8s.local&quot; - &quot;server3.k8s.local&quot; - &quot;127.0.0.1&quot; - &quot;10.0.0.65&quot; - &quot;10.0.0.66&quot; - &quot;10.0.0.67&quot; - &quot;kubernetes&quot; - &quot;kubernetes.default&quot; - &quot;kubernetes.default.svc&quot; - &quot;kubernetes.default.svc.cluster&quot; - &quot;kubernetes.default.svc.cluster.local&quot; controllerManager: extraArgs: experimental-cluster-signing-duration: 867000h extraVolumes: - hostPath: /etc/localtime mountPath: /etc/localtime name: localtime scheduler: extraVolumes: - hostPath: /etc/localtime mountPath: /etc/localtime name: localtime networking: # pod ç½‘æ®µ podSubnet: 172.224.0.0/12 # SVC ç½‘ç»œ serviceSubnet: 10.96.0.0/12 controlPlaneEndpoint: server.k8s.local:8443 etcd: external: endpoints: - http://server1.k8s.local:2379 - http://server2.k8s.local:2379 - http://server3.k8s.local:2379 --- apiVersion: kubeproxy.config.k8s.io/v1alpha1 kind: KubeProxyConfiguration mode: ipvs ipvs: scheduler: lc minSyncPeriod: 5s syncPeriod: 15s åˆå§‹åŒ– Master æ‰§è¡Œï¼š$kubeadm init --config=kubeadm-config.yaml --upload-certs â€“config=kubeadm-config.yaml ä¸ºä¸Šä¸€æ­¥éª¤ç¼–å†™çš„æ–‡ä»¶ â€“upload-certs å‚æ•°å°†è¯ä¹¦ä¸Šä¼ åˆ° etcd ä¸­ï¼Œåç»­ä¸éœ€è¦æ‰‹åŠ¨åˆ†å‘ åˆå§‹åŒ–ç»“æŸï¼Œæ§åˆ¶å°è¾“å‡ºï¼š Your Kubernetes control-plane has initialized successfully! To start using your cluster, you need to run the following as a regular user: å¤åˆ¶å¹¶æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼šå¯ä»¥ä»¥æ™®é€šç”¨æˆ·æ“ä½œé›†ç¾¤ mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config You should now deploy a pod network to the cluster. Run â€œkubectl apply -f [podnetwork].yamlâ€ with one of the options listed at: https://kubernetes.io/docs/concepts/cluster-administration/addons/ You can now join any number of the control-plane node running the following command on each as root: å¤åˆ¶å¹¶æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼šå…¶ä½™ master å¯ä»¥åŠ å…¥åˆ°åˆ°è¯¥é›†ç¾¤ kubeadm join server.k8s.local:8443 --token uue99t.w9cenfznjoo2e1u6 â€“discovery-token-ca-cert-hash sha256:afd406ce180ce4c9271c0e7b4c3381df72cd75e766f934fd439d101ae1022a43 â€“control-plane --certificate-key 1621bb7101d2fa4050779aaa753e89d49ee7db57129b6b4986c82b45fb4dcbe5 Please note that the certificate-key gives access to cluster sensitive data, keep it secret! As a safeguard, uploaded-certs will be deleted in two hours; If necessary, you can use &quot;kubeadm init phase upload-certs --upload-certs&quot; to reload certs afterward. Then you can join any number of worker nodes by running the following on each as root: å¤åˆ¶å¹¶æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼šworker å¯ä»¥åŠ å…¥åˆ°åˆ°è¯¥é›†ç¾¤ kubeadm join server.k8s.local:8443 --token uue99t.w9cenfznjoo2e1u6 â€“discovery-token-ca-cert-hash sha256:afd406ce180ce4c9271c0e7b4c3381df72cd75e766f934fd439d101ae1022a43 ä»¥ä¸Šå‘½ä»¤ä¸­å‡ºç°çš„ hashã€key éœ€è¦è·Ÿä½¿ç”¨è€…å®‰è£…åå‡ºç°çš„ä¸€è‡´ï¼Œä¸å¯ç›´æ¥å¤åˆ¶ä½¿ç”¨ï¼ Token å¤±æ•ˆ(24å°æ—¶)å¯ä»¥ä½¿ç”¨å‘½ä»¤é‡æ–°ç”Ÿæˆ â†“ kubeadm token create --print-join-command Masterï¼ˆâ€“control-plane --certificate-keyï¼‰ï¼ˆ2å°æ—¶å¤±æ•ˆï¼‰â†“ kubeadm init phase upload-certs --upload-certs --config kubeadm-config.yaml master æµ‹è¯• æ‰§è¡Œï¼š$kubectl get node å¯ä»¥æŸ¥çœ‹é›†ç¾¤æ˜¯å¦åŠ å…¥æˆåŠŸï¼ˆå¯ä»¥æ˜¾ç¤ºåŠ å…¥é›†ç¾¤å†…çš„æ‰€æœ‰èŠ‚ç‚¹ï¼‰ æ‰§è¡Œï¼š$kubectl get pod -A å¯ä»¥æŸ¥çœ‹æ‰€æœ‰é›†ç¾¤å†…æ­£åœ¨è¿è¡Œçš„podï¼ˆæ£€æŸ¥ apiserverã€controller-managerã€proxyã€scheduler æ˜¯å¦æ˜¯ running çŠ¶æ€ï¼Œcoredns ç›®å‰ä¸º pending çŠ¶æ€ï¼‰ ç»“æŸ è‡³æ­¤ï¼Œé«˜å¯ç”¨ K8S å®‰è£…æˆåŠŸã€‚ ç”œç‚¹ é›†ç¾¤é‡ç½®ï¼š$kubeadm reset å¦‚æœæ˜¯å¤–æ¥ ETCD ï¼Œéœ€è¦æ¸…ç©ºå¤–æ¥ ETCD æ•°æ®ï¼š$etcdctl del &quot;&quot; --prefix å‚è€ƒé“¾æ¥ åœ¨é˜¿é‡Œäº‘çš„VPCéƒ¨ç½²é«˜å¯ç”¨kubernetes","tags":[{"name":"K8S","slug":"K8S","permalink":"http://www.lockey.xyz/tags/K8S/"},{"name":"Kubernetes","slug":"Kubernetes","permalink":"http://www.lockey.xyz/tags/Kubernetes/"},{"name":"ç¼–æ’","slug":"ç¼–æ’","permalink":"http://www.lockey.xyz/tags/%E7%BC%96%E6%8E%92/"},{"name":"é«˜å¯ç”¨","slug":"é«˜å¯ç”¨","permalink":"http://www.lockey.xyz/tags/%E9%AB%98%E5%8F%AF%E7%94%A8/"}]},{"title":"K8S","date":"2019-12-31T06:33:19.000Z","path":"2019/12/31/DevOps/K8S/","text":"éƒ¨ç½²çš„æ¼”åŒ–å†å² ä¼ ç»Ÿéƒ¨ç½² èµ„æºåˆ†é…é—®é¢˜ è™šæ‹ŸåŒ–éƒ¨ç½² é‡çº§è¾ƒé‡ å®¹å™¨åŒ–éƒ¨ç½² æ•æ·åº”ç”¨ç¨‹åºçš„åˆ›å»ºå’Œéƒ¨ç½² æŒç»­å¼€å‘ã€é›†æˆå’Œéƒ¨ç½²æ–¹ä¾¿ å¼€å‘è¿ç»´åˆ†ç¦» å¯è§‚å¯Ÿæ€§ä¸°å¯Œ è·¨å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒä¸€è‡´ äº‘å’Œæ“ä½œç³»ç»Ÿåˆ†å‘çš„å¯ç§»æ¤æ€§å¼º ä»¥åº”ç”¨ç¨‹åºä¸ºä¸­å¿ƒç®¡ç† é€‚åˆæ¾æ•£è€¦åˆã€åˆ†å¸ƒå¼ã€å¼¹æ€§ã€è§£æ”¾çš„å¾®æœåŠ¡ èµ„æºéš”ç¦» èµ„æºåˆ©ç”¨ç‡é«˜ å®¹å™¨éƒ¨ç½²æ—¶ä»£é¢ä¸´çš„é—®é¢˜ é—®é¢˜ æœåŠ¡é›†ç¾¤è¶Šæ¥è¶Šå¤§ ä¼ ç»Ÿçš„é›†ç¾¤å®¹å™¨éƒ¨ç½²æ–¹å¼è¾ƒç¹ç å·¥ä½œé‡æ—¥ç›ŠåŠ å¤§ å®¹æ˜“å‡ºé”™ è§£å†³æ–¹å‘ éœ€è¦ä¸€ä¸ªå¼ºå¤§çš„å®¹å™¨ç®¡ç†ã€ç¼–æ’ç³»ç»Ÿ è§£å†³æ–¹æ¡ˆ kubernetes[K8S] K8Sæ˜¯ä»€ä¹ˆï¼Ÿ ç‰¹ç‚¹ å¯ç§»æ¤ å¯æ‰©å±• å¼€æº ç”Ÿæ€ç³»ç»Ÿåºå¤§ä¸”æœ‰æ´»åŠ› ä½œç”¨ æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ å­˜å‚¨ç¼–æ’ è‡ªåŠ¨éƒ¨ç½²å’Œå›æ»š è‡ªåŠ¨äºŒè¿›åˆ¶æ‰“åŒ… è‡ªæˆ‘ä¿®å¤ ç§˜é’¥ä¸é…ç½®ç®¡ç† å…¶å®ƒæ„ä¹‰ ä¿ƒè¿›å£°æ˜å¼é…ç½® è‡ªåŠ¨åŒ– æ¶æ„ æ¶æ„å›¾ ç»„ä»¶ Masterã€é›†ç¾¤æ§åˆ¶å¹³é¢ã€‘ kube-apiservice ä¸»èŠ‚ç‚¹ä¸Šè´Ÿè´£æä¾› Kubernetes API æœåŠ¡çš„ç»„ä»¶ æ”¯æŒæ°´å¹³æ‰©ç¼© etcd ä½œä¸ºä¿å­˜ Kubernetes æ‰€æœ‰é›†ç¾¤æ•°æ®çš„åå°æ•°æ®åº“ å…¼å…·ä¸€è‡´æ€§å’Œé«˜å¯ç”¨æ€§çš„é”®å€¼æ•°æ®åº“ é€šå¸¸éœ€è¦æœ‰ä¸ªå¤‡ä»½è®¡åˆ’ kube-scheduler ç›‘è§†æ–°åˆ›å»ºçš„æœªæŒ‡å®šè¿è¡ŒèŠ‚ç‚¹çš„ Pod é€‰æ‹©èŠ‚ç‚¹è®© Pod åœ¨ä¸Šé¢è¿è¡Œ kube-controller-manager Node Controller è´Ÿè´£åœ¨èŠ‚ç‚¹æ•…éšœæ—¶è¿›è¡Œé€šçŸ¥å’Œå“åº” Replication Controllerï¼ˆRCï¼‰ è´Ÿè´£ä¸ºç³»ç»Ÿä¸­æ¯ä¸ªå‰¯æœ¬æ§åˆ¶å™¨å¯¹è±¡ç»´æŠ¤æ­£ç¡®æ•°é‡çš„ Pod Endpoints Controller å¡«å……ç«¯ç‚¹ï¼ˆEndpointsï¼‰å¯¹è±¡ï¼ˆå³åŠ å…¥ Service ä¸ Podï¼‰ Service Account &amp; Token Controllers ä¸ºæ–°çš„å‘½åç©ºé—´åˆ›å»ºé»˜è®¤è´¦æˆ·å’Œ API è®¿é—®ä»¤ç‰Œ cloud-controller-manager è¿è¡Œä¸åŸºç¡€äº‘æä¾›å•†äº¤äº’çš„æ§åˆ¶å™¨ Nodeã€ç»´æŠ¤è¿è¡Œçš„ Pod å¹¶æä¾› Kubernetes è¿è¡Œç¯å¢ƒã€‘ kubelet ä¿è¯å®¹å™¨éƒ½è¿è¡Œåœ¨ Pod ä¸­ æ¥æ”¶ä¸€ç»„é€šè¿‡å„ç±»æœºåˆ¶æä¾›ç»™å®ƒçš„ PodSpecsï¼Œç¡®ä¿ PodSpecs ä¸­æè¿°çš„å®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€ä¸”å¥åº· ä¸ä¼šç®¡ç†ä¸æ˜¯ç”± Kubernetes åˆ›å»ºçš„å®¹å™¨ kube-proxy æ˜¯é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ç½‘ç»œä»£ç†ï¼Œå®ç° Kubernetes Service æ¦‚å¿µçš„ä¸€éƒ¨åˆ† ç»´æŠ¤èŠ‚ç‚¹ä¸Šçš„ç½‘ç»œè§„åˆ™ å…è®¸ä»é›†ç¾¤å†…éƒ¨æˆ–å¤–éƒ¨ç½‘ç»œä¼šè¯ä¸ Pod è¿›è¡Œç½‘ç»œé€šä¿¡ å®¹å™¨è¿è¡Œç¯å¢ƒï¼ˆDocker ç­‰ï¼‰ è´Ÿè´£è¿è¡Œå®¹å™¨ Addonsã€ä½¿ç”¨ Kubernetes èµ„æº (DaemonSet, Deploymentç­‰) å®ç°é›†ç¾¤åŠŸèƒ½ï¼›å‘½åç©ºé—´ä¸ºï¼škube-systemã€‘ DNS æ‰€æœ‰ Kubernetes é›†ç¾¤éƒ½åº”å…·æœ‰ DNS (éå¼ºåˆ¶æ€§è¦æ±‚) ä¸º Kubernetes é›†ç¾¤æä¾› DNS è®°å½• Kubernetes å¯åŠ¨çš„å®¹å™¨è‡ªåŠ¨å°† DNS æœåŠ¡å™¨åŒ…å«åœ¨ DNS æœç´¢ä¸­ Dashboard Web UI ä½¿ç”¨æˆ·å¯ä»¥ç®¡ç†é›†ç¾¤ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºä»¥åŠé›†ç¾¤æœ¬èº«è¿›è¡Œæ•…éšœæ’é™¤ å®¹å™¨èµ„æºç›‘æ§ å°†å…³äºå®¹å™¨çš„ä¸€äº›å¸¸è§çš„æ—¶é—´åºåˆ—åº¦é‡å€¼ä¿å­˜åˆ°ä¸€ä¸ªé›†ç¾¤æ•°æ®åº“ä¸­ æä¾›ç”¨äºæµè§ˆè¿™äº›æ•°æ®çš„ç•Œé¢ é›†ç¾¤å±‚é¢æ—¥å¿— è´Ÿè´£å°†å®¹å™¨çš„æ—¥å¿—ä¿å­˜åˆ°ä¸€ä¸ªé›†ä¸­çš„æ—¥å¿—å­˜å‚¨ä¸­ æä¾›æœç´¢å’Œæµè§ˆæ¥å£ Node å…¶ä»–ç»„ä»¶ kubectlã€æ“æ§ Kubernetes é›†ç¾¤ã€‘ è´Ÿè´£ç®¡ç† Pods å’Œå®ƒä»¬ä¸Šé¢çš„å®¹å™¨ï¼Œé•œåƒã€volumesã€etc è®¾è®¡ç†å¿µ æ ¸å¿ƒç†å¿µï¼š å®¹é”™æ€§ æ‰©å±•æ€§ API è®¾è®¡åŸåˆ™ æ‰€æœ‰ API åº”è¯¥æ˜¯å£°æ˜å¼çš„ AIP å¯¹è±¡æ˜¯å½¼æ­¤äº’è¡¥ä¸”å¯ç»„åˆçš„ é«˜å±‚ API ä»¥æ“ä½œæ„å›¾ä¸ºåŸºç¡€è®¾è®¡ åº•å±‚ API æ ¹æ®é«˜å±‚ API çš„æ§åˆ¶éœ€è¦è®¾è®¡ å°½é‡é¿å…ç®€å•å°è£…ï¼Œä¸è¦æœ‰åœ¨å¤–éƒ¨ API æ— æ³•æ˜¾å¼çŸ¥é“çš„å†…éƒ¨éšè—æœºåˆ¶ API æ“ä½œå¤æ‚åº¦ä¸å¯¹è±¡æ•°é‡æˆæ­£æ¯” API å¯¹è±¡çŠ¶æ€ä¸èƒ½ä¾èµ–äºç½‘ç»œè¿æ¥çŠ¶æ€ å°½é‡é¿å…è®©æ“ä½œæœºåˆ¶ä¾èµ–äºå…¨å±€çŠ¶æ€ æ§åˆ¶æœºåˆ¶è®¾è®¡åŸåˆ™ æ§åˆ¶é€»è¾‘åº”è¯¥åªä¾èµ–äºå½“å‰çŠ¶æ€ å‡è®¾ä»»ä½•é”™è¯¯çš„å¯èƒ½ï¼Œå¹¶åšå®¹é”™å¤„ç† å°½é‡é¿å…å¤æ‚çŠ¶æ€æœºï¼Œæ§åˆ¶é€»è¾‘ä¸è¦ä¾èµ–æ— æ³•ç›‘æ§çš„å†…éƒ¨çŠ¶æ€ å‡è®¾ä»»ä½•æ“ä½œéƒ½å¯èƒ½è¢«ä»»ä½•æ“ä½œå¯¹è±¡æ‹’ç»ï¼Œç”šè‡³è¢«é”™è¯¯è§£æ æ¯ä¸ªæ¨¡å—éƒ½å¯ä»¥åœ¨å‡ºé”™åè‡ªåŠ¨æ¢å¤ æ¯ä¸ªæ¨¡å—éƒ½å¯ä»¥åœ¨å¿…è¦çš„æ—¶å€™ä¼˜é›…çš„é™çº§æœåŠ¡ æ ¸å¿ƒæŠ€æœ¯æ¦‚å¿µ æœ¯è¯­ è¯­ä¹‰ å¤‡æ³¨ Pod é›†ç¾¤ä¸­éƒ¨ç½²åº”ç”¨æˆ–æœåŠ¡çš„æœ€å°å•å…ƒï¼Œå¯ä»¥åŒ…å«å¤šä¸ªå®¹å™¨ å‰¯æœ¬é›†ï¼ˆReplica Setï¼ŒRSï¼‰ æ–°ä¸€ä»£ RCï¼Œæ”¯æŒæ›´å¤šåŒ¹é…æ¨¡å¼ éƒ¨ç½²ï¼ˆDeploymentï¼‰ è¡¨ç¤ºç”¨æˆ·å¯¹é›†ç¾¤çš„ä¸€æ¬¡æ›´æ–°æ“ä½œ æœåŠ¡ï¼ˆServiceï¼‰ å®¢æˆ·ç«¯è¦è®¿é—®çš„æœåŠ¡å°±æ˜¯ Service å¯¹è±¡ æ¯ä¸ª Service ä¼šå¯¹åº”ä¸€ä¸ªé›†ç¾¤å†…éƒ¨çš„è™šæ‹Ÿ IPï¼Œé›†ç¾¤å†…éƒ¨é€šè¿‡è™šæ‹Ÿ IP è®¿é—®æœåŠ¡ ä»»åŠ¡ï¼ˆJobï¼‰ æ§åˆ¶æ‰¹å¤„ç†å‹ä»»åŠ¡çš„å¯¹è±¡ åå°æ”¯æ’‘æœåŠ¡é›†ï¼ˆDaemonSetï¼‰ ä¿è¯æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰æ­¤ç±» Pod è¿è¡Œ å…¸å‹çš„æ”¯æŒæœåŠ¡æœ‰ï¼šå­˜å‚¨ã€æ—¥å¿—ã€ç›‘æ§ç­‰ æœ‰çŠ¶æ€æœåŠ¡é›†ï¼ˆPetSetï¼‰ æ¯ä¸ª Pod çš„åå­—è¦äº‹å…ˆç¡®å®šï¼ŒæŒ‚è½½è‡ªå·±ç‹¬ç«‹çš„å­˜å‚¨ é€‚åˆ PetSet çš„ä¸šåŠ¡ï¼šMySQLã€PostgreSQLã€Zookeeperç­‰ é›†ç¾¤è”é‚¦ï¼ˆFederationï¼‰ æä¾›æ‰©åŒºåŸŸè·¨æœåŠ¡å•†èƒ½åŠ› æ¯ä¸ª Federation æœ‰è‡ªå·±çš„åˆ†å¸ƒå¼å­˜å‚¨ã€API Server å’Œ Controller Manager å­˜å‚¨å·ï¼ˆVolumeï¼‰ ä¸ Docker å­˜å‚¨å·ç±»ä¼¼ï¼Œä¸è¿‡ä½œç”¨è®¿é—®æ˜¯ Pod æŒä¹…å­˜å‚¨å·ï¼ˆPersistent Volumeï¼ŒPVï¼‰å’ŒæŒä¹…å­˜å‚¨å·å£°æ˜ï¼ˆPersistent Volume Claimï¼ŒPVCï¼‰ ä½¿é›†ç¾¤å…·å¤‡å­˜å‚¨çš„é€»è¾‘æŠ½è±¡èƒ½åŠ› PV å’Œ PVC çš„å…³ç³»ç›¸å½“äº Node å’Œ Pod çš„å…³ç³» åç§°ï¼ˆNamesï¼‰ Kubernetes REST API ä¸­çš„æ‰€æœ‰å¯¹è±¡éƒ½ç”±åç§°å’Œ UID æ˜ç¡®æ ‡è¯†ï¼›ä¸€æ¬¡åªèƒ½æœ‰ä¸€ä¸ªç»™å®šç±»å‹çš„å¯¹è±¡å…·æœ‰ç»™å®šçš„åç§°ï¼ˆå¦‚æœåˆ é™¤å¯¹è±¡ï¼Œåˆ™å¯ä»¥åˆ›å»ºåŒåçš„æ–°å¯¹è±¡ï¼‰ UIDs ç³»ç»Ÿç”Ÿæˆçš„å­—ç¬¦ä¸²ï¼Œå”¯ä¸€æ ‡è¯†å¯¹è±¡ï¼›åœ¨é›†ç¾¤çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­åˆ›å»ºçš„æ¯ä¸€ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªä¸åŒçš„ UIDï¼Œç”¨æ¥åŒºåˆ†ç±»ä¼¼å®ä½“çš„å†å²äº‹ä»¶ å‘½åç©ºé—´ï¼ˆNamespaceï¼‰ Kubernetes æ”¯æŒå¤šä¸ªè™šæ‹Ÿé›†ç¾¤ï¼Œä¾èµ–äºåŒä¸€ç‰©ç†é›†ç¾¤ã€‚è¿™äº›è™šæ‹Ÿé›†ç¾¤è¢«ç§°ä¸ºå‘½åç©ºé—´ã€‚ æ ‡ç­¾å’Œé€‰æ‹©å™¨ï¼ˆLabels &amp; Selectorsï¼‰ æ ‡ç­¾æ˜¯é™„åŠ åˆ° Kubernetes å¯¹è±¡ä¸Šçš„é”®å€¼å¯¹ï¼Œç”¨äºæŒ‡å®šå¯¹ç”¨æˆ·æœ‰æ„ä¹‰ä¸”ç›¸å…³çš„å¯¹è±¡æ ‡è¯†å±æ€§ï¼Œä½†ä¸ç›´æ¥å¯¹æ ¸å¿ƒç³»ç»Ÿæœ‰è¯­ä¹‰å«ä¹‰ æ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥å®šä¹‰ä¸€ç»„é”®/å€¼æ ‡ç­¾ï¼Œæ¯ä¸ªé”®å¯¹äºç»™å®šå¯¹è±¡å¿…é¡»å”¯ä¸€ æ³¨è§£ï¼ˆAnnotationsï¼‰ å¯ä»¥ä½¿ç”¨æ³¨è§£ä¸ºå¯¹è±¡é™„åŠ ä»»æ„çš„éæ ‡è¯†çš„å…ƒæ•°æ® å­—æ®µé€‰æ‹©å™¨ï¼ˆField Selectorsï¼‰ å…è®¸æ ¹æ®å¤šä¸ªæˆ–å¤šä¸ªèµ„æºå­—æ®µçš„å€¼ç­›é€‰ Kubernetes èµ„æº Kubernetes å¯¹è±¡ç®¡ç† åº”è¯¥åªä½¿ç”¨ä¸€ç§æŠ€æœ¯æ¥ç®¡ç† Kubernetes å¯¹è±¡ï¼›æ··åˆå’ŒåŒ¹é…æŠ€æœ¯ä½œç”¨äºåŒä¸€å¯¹è±¡ä¸Šå°†å¯¼è‡´æœªå®šä¹‰è¡Œä¸º ç±»å‹ ä½¿ç”¨ç¯å¢ƒ ä¼˜ç‚¹ ç¼ºç‚¹ å‘½ä»¤å¼å‘½ä»¤ æµ‹è¯• 1. å‘½ä»¤ç®€å•ï¼Œæ˜“å­¦ã€æ˜“è®°ï¼›2. å¿«é€Ÿæ›´æ”¹é›†ç¾¤ 1. å‘½ä»¤ä¸ä¸å˜æ›´å®¡æŸ¥æµç¨‹é›†æˆï¼›2. ä¸æä¾›ä¸æ›´æ”¹ç®¡ç†çš„å®¡æ ¸è·Ÿè¸ªï¼›3.é™¤äº†å®æ—¶å†…å®¹ï¼Œå‘½ä»¤ä¸æä¾›è®°å½•æºï¼›4. ä¸æä¾›ç”¨äºåˆ›å»ºæ–°å¯¹è±¡çš„æ¨¡æ¿ å‘½ä»¤å¼å¯¹è±¡é…ç½® ç”Ÿäº§ ä¸å‘½ä»¤å¼å‘½ä»¤ç›¸æ¯”ï¼š1. å¯ä»¥å­˜å‚¨åœ¨æºæ§åˆ¶ç³»ç»Ÿä¸­ï¼Œå¦‚ï¼šGitï¼›2. å¯ä»¥ä¸æµç¨‹é›†æˆï¼Œå¦‚ï¼šåœ¨æ¨é€å’Œå®¡è®¡ä¹‹å‰æ£€æŸ¥æ›´æ–°ï¼›3.æä¾›ç”¨äºåˆ›å»ºæ–°å¯¹è±¡çš„æ¨¡æ¿ï¼›ä¸å£°æ˜å¼å¯¹è±¡é…ç½®ç›¸æ¯”ï¼š1. é…ç½®è¡Œä¸ºç®€å•æ˜“æ‡‚ï¼›2. æ›´åŠ æˆç†Ÿ ä¸å‘½ä»¤å¼å‘½ä»¤ç›¸æ¯”ï¼š1. éœ€è¦å¯¹å¯¹è±¡æ¶æ„æœ‰äº†è§£ï¼›2. éœ€è¦äº› YAML æ–‡ä»¶ï¼›ä¸å£°æ˜å¼å¯¹è±¡é…ç½®ç›¸æ¯”ï¼š1. å¯¹æ´»åŠ¨å¯¹è±¡çš„æ›´æ–°å¿…é¡»åæ˜ åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå¦åˆ™å°†åœ¨ä¸‹ä¸€æ¬¡æ›¿æ¢æ—¶ä¸¢å¤±ï¼›2. é’ˆå¯¹æ–‡ä»¶è€Œä¸æ˜¯ç›®å½• å£°æ˜å¼å¯¹è±¡é…ç½® ç”Ÿäº§ 1. å³ä½¿æœªå°†å¯¹æ´»åŠ¨å¯¹è±¡æ‰€åšçš„æ›´æ”¹æœªåˆå¹¶å›é…ç½®æ–‡ä»¶ä¸­ï¼Œä¹Ÿå°†ä¿ç•™è¿™äº›æ›´æ”¹ï¼›2. æ›´å¥½çš„æ”¯æŒå¯¹ç›®å½•è¿›è¡Œæ“ä½œå¹¶è‡ªåŠ¨æ£€æµ‹æ¯ä¸ªå¯¹è±¡çš„æ“ä½œç±»å‹ï¼ˆåˆ›å»ºã€ä¿®è¡¥ã€åˆ é™¤ï¼‰ 1. é…ç½®éš¾äºè°ƒè¯•å¹¶ä¸”å‡ºç°å¼‚å¸¸æ—¶éš¾ä»¥ç†è§£ï¼›2. ä½¿ç”¨å·®å¼‚çš„éƒ¨åˆ†æ›´æ–°ä¼šåˆ›å»ºå¤æ‚çš„åˆå¹¶å’Œè¡¥ä¸æ“ä½œ ä½¿ç”¨ å®‰è£… cat &lt;&lt;EOF &gt; /etc/apt/sources.list.d/kubernetes.list deb http://mirrors.ustc.edu.cn/kubernetes/apt kubernetes-xenial main EOF apt-get update apt-get install -y kubelet kubeadm kubectl apt-mark hold kubelet kubeadm kubectl å‚è€ƒèµ„æ–™ K8S(å®˜æ–¹) Kubernetes ä¸­æ–‡ç¤¾åŒº | ä¸­æ–‡æ–‡æ¡£ Kubernetes ä¸­æ–‡æ‰‹å†Œ","tags":[{"name":"K8S","slug":"K8S","permalink":"http://www.lockey.xyz/tags/K8S/"},{"name":"Kubernetes","slug":"Kubernetes","permalink":"http://www.lockey.xyz/tags/Kubernetes/"},{"name":"ç¼–æ’","slug":"ç¼–æ’","permalink":"http://www.lockey.xyz/tags/%E7%BC%96%E6%8E%92/"}]},{"title":"ELK","date":"2019-12-20T02:00:31.000Z","path":"2019/12/20/DevOps/ELK/","text":"ELK æ˜¯ä»€ä¹ˆ? æ˜¯ ElasticSearchã€Logstashã€Kibana ä¸‰ä¸ªå¼€æºè½¯ä»¶çš„ç»„åˆ å…·å¤‡æ•°æ®æ”¶é›†ã€å­˜å‚¨ã€åˆ†æåŠŸèƒ½ é€‚åˆå®æ—¶æ•°æ®åˆ†æå’Œæ£€ç´¢çš„åœºæ™¯ å…·æœ‰åˆ†å¸ƒå¼ç‰¹æ€§ æ˜“æ‰©å±• ELK åŠŸèƒ½ ElasticSearch å­˜å‚¨ ç´¢å¼• Logstash æ”¶é›† å¤„ç† Kibana å¯è§†åŒ– ç»Ÿè®¡åˆ†æ Beatï¼ˆæ‰©å±•ç»„ä»¶ï¼‰ MetricBeat æ”¶é›†å„ç§ä¸»æœºä¿¡æ¯ï¼ˆCPUã€å†…å­˜â€¦â€¦ï¼‰ï¼Œè¯¦è§å®˜ç½‘ Filebeat è½»é‡çº§æ—¥å¿—æ”¶é›†ç»„ä»¶ ç®€å•æ¶æ„ ä½¿ç”¨ ä½¿ç”¨ Docker å®‰è£… ELK å‚è€ƒ https://github.com/deviantony/docker-elk.git Kibana ä¸­æ–‡è®¾ç½® $ vim kibana/config/kibana.yml æ–°å¢ä¸­æ–‡é…ç½® â†“â†“â†“ i18n.locale: â€œzh-CNâ€ ElasticSearch é»˜è®¤éœ€è¦ 4G å†…å­˜ï¼›å¯ä»¥é€šè¿‡è®¾ç½® ES_JAVA_OPTS æ¥ä¿®æ”¹ å¦‚ï¼šES_JAVA_OPTS=&quot;-Xms512m -Xmx512m&quot; ä½¿ç”¨ Docker å®‰è£… MetricBeat è·å–é…ç½®æ–‡ä»¶ ä¸‹è½½ $ wget https://artifacts.elastic.co/downloads/beats/metricbeat/metricbeat-7.4.1-linux-x86_64.tar.gz è§£å‹ $ tar zxvf metricbeat-7.4.1-linux-x86_64.tar.gz æå– metricbeat.yml modules.d ä½¿ç”¨ Docker Compose $ vim docker-compose.yml version: '2' services: metricbeat: image: docker.elastic.co/beats/metricbeat:7.4.1 container_name: metricbeat volumes: - /var/run/docker.sock:/var/run/docker.sock:ro - /proc:/hostfs/proc:ro - /sys/fs/cgroup:/hostfs/sys/fs/cgroup:ro - /:/hostfs:ro - ./metricbeat/metricbeat.yml:/usr/share/metricbeat/metricbeat.yml:ro - ./metricbeat/modules.d:/usr/share/metricbeat/modules.d:ro - /usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro user: &quot;root&quot; command: -system.hostfs=/hostfs -e restart: always docker exec -it metricbeat metricbeat modules enable systemop0=>operation: Dataï¼ˆLogï¼‰ op1=>operation: MetricBeat op2=>operation: Redis op3=>operation: Logstash op4=>operation: ElasticSearch op5=>operation: Kibana op0(right)->op2 op1(right)->op4 op2(right)->op3 op3(right)->op4 op4(right)->op5{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12} var code = document.getElementById(\"flowchart-0-code\").value; var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-0-options\").value)); var diagram = flowchart.parse(code); diagram.drawSVG(\"flowchart-0\", options);","tags":[{"name":"ELK","slug":"ELK","permalink":"http://www.lockey.xyz/tags/ELK/"},{"name":"ElasticSearch","slug":"ElasticSearch","permalink":"http://www.lockey.xyz/tags/ElasticSearch/"},{"name":"Logstash","slug":"Logstash","permalink":"http://www.lockey.xyz/tags/Logstash/"},{"name":"Kibana","slug":"Kibana","permalink":"http://www.lockey.xyz/tags/Kibana/"},{"name":"MetricBeat","slug":"MetricBeat","permalink":"http://www.lockey.xyz/tags/MetricBeat/"},{"name":"æ—¥å¿—","slug":"æ—¥å¿—","permalink":"http://www.lockey.xyz/tags/%E6%97%A5%E5%BF%97/"}]},{"title":"Zabbix","date":"2019-12-13T07:07:21.000Z","path":"2019/12/13/DevOps/Zabbix/","text":"ä»€ä¹ˆæ˜¯ Zabbix ï¼Ÿ Zabbix æ˜¯ä¸€ç§ç³»ç»Ÿç›‘æ§ã€‚ç½‘ç»œç›‘æ§ã€æœåŠ¡ç›‘æ§å·¥å…·ã€‚ ç›‘æ§å¯¹è±¡ ä¸»æœº è½¯ä»¶ æ¨¡å—åŠŸèƒ½ Monitoring ä¿¡æ¯èšåˆ çŠ¶æ€å±•ç¤º ä¿¡æ¯æŸ¥è¯¢ ç›‘æ§ç»Ÿè®¡ Inventory èµ„äº§ä¿¡æ¯ ç®¡ç† æŸ¥è¯¢ Report æŠ¥è¡¨ å®¡è®¡ æ—¥å¿— Configuration ä¸»æœºä¿¡æ¯é…ç½® ç›‘æ§è§„åˆ™é…ç½® æŠ¥è­¦è§„åˆ™é…ç½® ç»Ÿè®¡å›¾è¡¨é…ç½® è‡ªåŠ¨å‘ç°é…ç½® Administrator ç”¨æˆ·æƒé™ç®¡ç† æŠ¥è­¦æ–¹å¼é…ç½® è„šæœ¬é…ç½® ä»£ç†é…ç½® Personal æ¥æ”¶æŠ¥è­¦é…ç½® æ¥æ”¶æŠ¥è­¦è§„åˆ™ ä¸ªäººä¿¡æ¯ç®¡ç† Zabbix ç‰¹ç‚¹ å®‰è£…ç®€å• ç›‘æ§æ–¹ä¾¿ å…è´¹å¼€æº è‡ªåŠ¨åŒ– C/S ç»“æ„ã€åˆ†å¸ƒå¼æ¶æ„ ä¸åŒç±»å‹æ¯”è¾ƒ ç³»ç»Ÿåç§° é»˜è®¤ç›‘æ§ è‡ªå®šä¹‰ç›‘æ§ æ‰¹é‡ç›‘æ§ ä¿®æ”¹ç›‘æ§ å›¾è¡¨ æŠ¥è­¦ å…¶ä»– Zabbix è‡ªå¸¦ç›‘æ§å¤š å¯è‡ªå®šä¹‰ç¼–å†™æ’ä»¶ server ç«¯å¯é…ç½®è‡ªåŠ¨æ³¨å†Œè§„åˆ™ï¼›client ç«¯æ— éœ€æ“ä½œ æ‰‹åŠ¨åœ¨æ¨¡æ¿ä¸­æ–°å¢ç›‘æ§ è‡ªå¸¦å›¾è¡¨æ’ä»¶ æ”¯æŒå¤šç§æŠ¥è­¦ï¼Œä¾èµ–æ’ä»¶ è‡ªå¸¦ Web ç›‘æ§ Nagios è‡ªå¸¦ç›‘æ§å°‘ å¯è‡ªå®šä¹‰ç¼–å†™æ’ä»¶ ç”¨è„šæœ¬åœ¨ server ç«¯æ–°å¢ hostï¼Œ å¹¶æ‹·è´ service æ–‡ä»¶ ç”¨è„šæœ¬ä¿®æ”¹æ‰€æœ‰ä¸»æœºçš„ service æ–‡ä»¶ï¼ŒåŠ å…¥æ–°å¢æœåŠ¡ å¯ä»¥æŒ‰ç…§å›¾è¡¨æ’ä»¶ æ”¯æŒå¤šç§æŠ¥è­¦ï¼Œä¾èµ–æ’ä»¶ Zabbix ä½¿ç”¨æ›´å‹å¥½ï¼Œæ¢ç´¢åŠŸèƒ½éœ€è¦è¾ƒå¤šæ—¶é—´ï¼Œå­¦ä¹ æˆæœ¬è¾ƒå¤§ Nagios å®¹æ˜“ä¸Šæ‰‹ï¼Œè„šæœ¬å¾ˆå¼ºå¤§ï¼Œä½†å†™èµ·æ¥ä¹Ÿè´¹æ—¶è´¹åŠ› æ¶æ„å›¾ éƒ¨ç½²æ–¹å¼ ç½‘ç»œåè®®æ¨¡å¼ï¼šserver-client ä»£ç†æ¨¡å¼ï¼šserver-proxy-client èŠ‚ç‚¹æ¨¡å¼ï¼šmaster-node-client ä½¿ç”¨ å®‰è£… æ‰“å¼€å®˜ç½‘ä¸‹è½½é¡µé¢ é€‰æ‹©æ“ä½œç³»ç»Ÿ æŒ‰å¼•å¯¼å®‰è£… å®‰è£… Server ç«¯ æ·»åŠ æº å®‰è£… Server å®‰è£… MySQL åˆå§‹åŒ– MySQL å¯åŠ¨ zabbix-server å®‰è£… Web ç«¯ å®‰è£… Web é…ç½® timezoneï¼š $ vim /etc/php-fpm.d/zabbix.conf ; php_value[date.timezone] = Asian/Shanghai å¯åŠ¨ [httpd|nginx|apache2] php-fpm æ‰“å¼€ http://[ip]/zabbix é»˜è®¤ç”¨æˆ·å¯†ç ï¼šAdmin : zabbix å®‰è£… Agent ç«¯ æ·»åŠ æº å®‰è£… Agent é…ç½®è¿æ¥çš„ Server $ vim /etc/zabbix/zabbix_agentd.conf å¯åŠ¨ zabbix-agent è¸©å‘æŒ‡å— Mariadb ä»£æ›¿ MySQL å…³é—­ SeLinuxï¼Œå¦åˆ™å¯èƒ½å‡ºç°ï¼šcannot set resource limit é»˜è®¤ä½¿ç”¨ httpd ä½œä¸º Web æœåŠ¡ Web ä½¿ç”¨ é…ç½®è‡ªåŠ¨å‘ç° é…ç½®æŠ¥è­¦ é…ç½®å‘é€æŠ¥è­¦ é…ç½®æ¥æ”¶æŠ¥è­¦ é…ç½®ç»Ÿè®¡å›¾è¡¨ é…ç½®èšåˆå›¾è¡¨ ç”¨æˆ·ç®¡ç† é…ç½®èšåˆå›¾è¡¨ é€šç”¨è®¾ç½®å¥—è·¯ Web API åŠŸèƒ½ è¿œç¨‹ç®¡ç† Zabbix é…ç½® è¿œç¨‹æ£€ç´¢é…ç½®å’Œå†å²æ•°æ® æ¥å…¥æ–¹å¼ http://[ip]:[port]/zabbix/api_jsonrpc.php ä½¿ç”¨ JSON-RPC å®ç° æ•°æ®ä¼ è¾“ä»¥ JSON æ ¼å¼ Headers Content-Type: application/json-rpc Content-Type: application/json Content-Type: application/jsonrequest æ¥å…¥æ­¥éª¤ ç™»å½•è·å– token è¯·æ±‚å¤´å¸¦å…¥ Authorization: [token] å‚è€ƒèµ„æ–™ ä¸­å°å‹ä¼ä¸šé€šç”¨è‡ªåŠ¨åŒ–è¿ç»´æ¶æ„ zabbixä¸nagioså¯¹æ¯”op1=>operation: Configuration op2=>operation: Discovery op3=>operation: Create Discovery Rules op4=>operation: Create Rules op1(right)->op2 op2(right)->op3 op3(right)->op4{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12} var code = document.getElementById(\"flowchart-0-code\").value; var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-0-options\").value)); var diagram = flowchart.parse(code); diagram.drawSVG(\"flowchart-0\", options);op1=>operation: Configuration op2=>operation: Create Action op3=>operation: Create Condition op4=>operation: Create Operation op1(right)->op2 op2(right)->op3 op3(right)->op4{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12} var code = document.getElementById(\"flowchart-1-code\").value; var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-1-options\").value)); var diagram = flowchart.parse(code); diagram.drawSVG(\"flowchart-1\", options);op1=>operation: Administrator op2=>operation: Media Type op3=>operation: Email op4=>operation: Update op1(right)->op2 op2(right)->op3 op3(right)->op4{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12} var code = document.getElementById(\"flowchart-2-code\").value; var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-2-options\").value)); var diagram = flowchart.parse(code); diagram.drawSVG(\"flowchart-2\", options);op1=>operation: Administrator op2=>operation: Users op3=>operation: Admin op4=>operation: Media op5=>operation: Add op1(right)->op2 op2(right)->op3 op3(right)->op4 op4(right)->op5{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12} var code = document.getElementById(\"flowchart-3-code\").value; var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-3-options\").value)); var diagram = flowchart.parse(code); diagram.drawSVG(\"flowchart-3\", options);op1=>operation: Configuration op2=>operation: Hosts op3=>operation: Graphs op4=>operation: æ¡ç›®é€‰æ‹© op1(right)->op2 op2(right)->op3 op3(right)->op4{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12} var code = document.getElementById(\"flowchart-4-code\").value; var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-4-options\").value)); var diagram = flowchart.parse(code); diagram.drawSVG(\"flowchart-4\", options);op1=>operation: Monitoring op2=>operation: Screens op3=>operation: Add op4=>operation: Edit Screen op1(right)->op2 op2(right)->op3 op3(right)->op4{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12} var code = document.getElementById(\"flowchart-5-code\").value; var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-5-options\").value)); var diagram = flowchart.parse(code); diagram.drawSVG(\"flowchart-5\", options);op1=>operation: Administrator op2=>operation: Users op3=>operation: User Groups op1(right)->op2 op2(right)->op3{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12} var code = document.getElementById(\"flowchart-6-code\").value; var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-6-options\").value)); var diagram = flowchart.parse(code); diagram.drawSVG(\"flowchart-6\", options);op1=>operation: Monitoring op2=>operation: Screens op3=>operation: Add op4=>operation: Edit Screen op1(right)->op2 op2(right)->op3 op3(right)->op4{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12} var code = document.getElementById(\"flowchart-7-code\").value; var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-7-options\").value)); var diagram = flowchart.parse(code); diagram.drawSVG(\"flowchart-7\", options);op1=>operation: åˆ›å»ºç›‘æ§è„šæœ¬ op2=>operation: åˆ›å»º Zabbix Item op3=>operation: åˆ›å»º Zabbix Trigger op4=>operation: åˆ›å»º Zabbix Action op1(right)->op2 op2(right)->op3 op3(right)->op4{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12} var code = document.getElementById(\"flowchart-8-code\").value; var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-8-options\").value)); var diagram = flowchart.parse(code); diagram.drawSVG(\"flowchart-8\", options);","tags":[{"name":"è¿ç»´","slug":"è¿ç»´","permalink":"http://www.lockey.xyz/tags/%E8%BF%90%E7%BB%B4/"},{"name":"Zabbix","slug":"Zabbix","permalink":"http://www.lockey.xyz/tags/Zabbix/"},{"name":"ç›‘æ§","slug":"ç›‘æ§","permalink":"http://www.lockey.xyz/tags/%E7%9B%91%E6%8E%A7/"}]},{"title":"äº‘è®¡ç®—","date":"2019-12-10T07:43:55.000Z","path":"2019/12/10/DevOps/äº‘è®¡ç®—/","text":"æ¦‚å¿µ äº‘è®¡ç®—ï¼ˆcloud computingï¼‰æ˜¯åˆ†å¸ƒå¼è®¡ç®—çš„ä¸€ç§ï¼ŒæŒ‡çš„æ˜¯é€šè¿‡ç½‘ç»œâ€œäº‘â€å°†å·¨å¤§çš„æ•°æ®è®¡ç®—å¤„ç†ç¨‹åºåˆ†è§£æˆæ— æ•°ä¸ªå°ç¨‹åºï¼Œç„¶åï¼Œé€šè¿‡å¤šéƒ¨æœåŠ¡å™¨ç»„æˆçš„ç³»ç»Ÿè¿›è¡Œå¤„ç†å’Œåˆ†æè¿™äº›å°ç¨‹åºå¾—åˆ°ç»“æœå¹¶è¿”å›ç»™ç”¨æˆ·ã€‚äº‘è®¡ç®—æ—©æœŸï¼Œç®€å•åœ°è¯´ï¼Œå°±æ˜¯ç®€å•çš„åˆ†å¸ƒå¼è®¡ç®—ï¼Œè§£å†³ä»»åŠ¡åˆ†å‘ï¼Œå¹¶è¿›è¡Œè®¡ç®—ç»“æœçš„åˆå¹¶ã€‚å› è€Œï¼Œäº‘è®¡ç®—åˆç§°ä¸ºç½‘æ ¼è®¡ç®—ã€‚é€šè¿‡è¿™é¡¹æŠ€æœ¯ï¼Œå¯ä»¥åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…ï¼ˆå‡ ç§’ç§ï¼‰å®Œæˆå¯¹æ•°ä»¥ä¸‡è®¡çš„æ•°æ®çš„å¤„ç†ï¼Œä»è€Œè¾¾åˆ°å¼ºå¤§çš„ç½‘ç»œæœåŠ¡ã€‚ ç°é˜¶æ®µæ‰€è¯´çš„äº‘æœåŠ¡å·²ç»ä¸å•å•æ˜¯ä¸€ç§åˆ†å¸ƒå¼è®¡ç®—ï¼Œè€Œæ˜¯åˆ†å¸ƒå¼è®¡ç®—ã€æ•ˆç”¨è®¡ç®—ã€è´Ÿè½½å‡è¡¡ã€å¹¶è¡Œè®¡ç®—ã€ç½‘ç»œå­˜å‚¨ã€çƒ­å¤‡ä»½å†—æ‚å’Œè™šæ‹ŸåŒ–ç­‰è®¡ç®—æœºæŠ€æœ¯æ··åˆæ¼”è¿›å¹¶è·ƒå‡çš„ç»“æœã€‚ ç‰¹ç‚¹ è™šæ‹ŸåŒ–(è®¡ç®—ã€å­˜å‚¨ã€ç½‘ç»œç­‰) äº§å“æœåŠ¡åŒ–(IaaSã€PaaSã€SaaSâ€¦â€¦) å¼¹æ€§ä¼¸ç¼© æ¶æ„ åŸºç¡€è®¾æ–½å±‚(IaaS) å¹³å°å±‚(PaaS) è½¯ä»¶æœåŠ¡å±‚(SaaS) åˆ†ç±» ç§æœ‰äº‘ å…¬æœ‰äº‘ æ··åˆäº‘ è¤æ®µå­è®º ç”·äººæ‰¾ä¸ªå¥³å‹æˆ–è€å©†æ˜¯è‡ªå»ºç§æœ‰äº‘ï¼Œå•èº«çº¦ç‚®æˆ–è€…åˆ°å¨±ä¹åœºæ‰€æ¶ˆè´¹æ˜¯å…¬æœ‰äº‘æœåŠ¡ï¼ŒæŒ‰éœ€ä½¿ç”¨å¹¶å¯å¼¹æ€§æ‰©å®¹ï¼Œå·²å©šç”·äººæ‰¾äºŒå¥¶å°èœœåˆ™å±äºæ··åˆäº‘ã€‚","tags":[{"name":"äº‘è®¡ç®—","slug":"äº‘è®¡ç®—","permalink":"http://www.lockey.xyz/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/"}]},{"title":"DevOps","date":"2019-12-09T10:06:13.000Z","path":"2019/12/09/DevOps/DevOps/","text":"å‰ç½®çŸ¥è¯† äº‘è®¡ç®— æ¦‚å¿µ DevOps = Development(å¼€å‘äººå‘˜) + Operations(è¿ç»´äººå‘˜) DevOps æ˜¯ä¸€ç§é‡è§†â€œå¼€å‘äººå‘˜â€å’Œâ€œè¿ç»´äººå‘˜â€ä¹‹é—´æ²Ÿé€šåˆä½œçš„æ–‡åŒ–ã€è¿åŠ¨æˆ–è€…æƒ¯ä¾‹ã€‚é€šè¿‡è‡ªåŠ¨åŒ–â€œè½¯ä»¶äº¤ä»˜â€å’Œâ€œæ¶æ„å˜æ›´â€çš„æµç¨‹ï¼Œä½¿æ„å»ºã€æµ‹è¯•ã€å‘å¸ƒè½¯ä»¶èƒ½æ›´å¿«ã€æ›´é¢‘ç¹å’Œæ›´å¯é ã€‚ å„éƒ¨é—¨å…³ç³»å›¾ å¯¹åº”ç”¨ç¨‹åºå‘å¸ƒçš„å½±å“ å‡å°‘å˜æ›´èŒƒå›´ æ¶ˆé™¤ç­‰å¾…ã€å¿«é€Ÿåé¦ˆ ä½¿é—®é¢˜å®šä½ã€è°ƒè¯•å˜å¾—ç®€å• åŠ å¼ºå‘å¸ƒè°è°ƒï¼Œæå‡äº¤ä»˜è´¨é‡ è‡ªåŠ¨åŒ–ï¼Œç¨³å®šã€å¿«é€Ÿã€äº¤ä»˜ç»“æœå¯é¢„æµ‹ èµ„æºåˆ©ç”¨æœ€å¤§åŒ– å…³é”®ç‚¹ Automated infrastructureï¼ˆè‡ªåŠ¨åŒ–ï¼Œç³»ç»Ÿä¹‹é—´çš„é›†æˆï¼‰ shared version controlï¼ˆSVNå…±äº«æºç ï¼‰ one step build and deployï¼ˆæŒç»­æ„å»ºå’Œéƒ¨ç½²ï¼‰ feature flagsï¼ˆä¸»å¹²å¼€å‘ï¼‰ Shared metrics IRC and IM robotsï¼ˆä¿¡æ¯æ•´åˆï¼‰ CI/CD ä¸€çº¿è´¯ç©¿ä»¥ä¸ŠæŠ€æœ¯è¦ç‚¹ ä¸»å¹²å¼€å‘æ˜¯ CI çš„å‰æ è‡ªåŠ¨åŒ–ä»¥åŠä»£ç å‘¨è¾¹é›†ä¸­ç®¡ç†æ˜¯å®æ–½ CI çš„å¿…è¦æ¡ä»¶ CI/CD æ˜¯ DevOps çš„æŠ€æœ¯æ ¸å¿ƒï¼Œåœ¨æ²¡æœ‰è‡ªåŠ¨åŒ–æµ‹è¯•ã€CI/CD ä¹‹ä¸‹ï¼ŒDevOps å°±æ˜¯ç©ºä¸­æ¥¼é˜ å·¥ä½œæµ å·¥å…·ç®± ä»£ç ç®¡ç†ï¼ˆSCMï¼‰ GitHubã€GitLabã€BitBucketã€SubVersion æ„å»ºå·¥å…· Antã€Gradleã€maven è‡ªåŠ¨éƒ¨ç½² Capistranoã€CodeDeployã€Ansibleã€Jenkins æŒç»­é›†æˆï¼ˆCIï¼‰ Bambooã€Hudsonã€Jenkins é…ç½®ç®¡ç† Ansibleã€Chefã€Puppetã€SaltStackã€ScriptRock GuardRailã€Consulã€Apollo å®¹å™¨ Dockerã€LXCã€ç¬¬ä¸‰æ–¹å‚å•†å¦‚AWS ç¼–æ’ Kubernetesã€Coreã€Apache Mesosã€DC/OS æœåŠ¡æ³¨å†Œä¸å‘ç° Zookeeperã€etcdã€Consul è„šæœ¬è¯­è¨€ pythonã€rubyã€shell æ—¥å¿—ç®¡ç† ELKã€Logentries ç³»ç»Ÿç›‘æ§ Datadogã€Graphiteã€Icingaã€Nagios æ€§èƒ½ç›‘æ§ AppDynamicsã€New Relicã€Splunk å‹åŠ›æµ‹è¯• JMeterã€Blaze Meterã€loader.io é¢„è­¦ PagerDutyã€pingdomã€å‚å•†è‡ªå¸¦å¦‚AWS SNS HTTPåŠ é€Ÿå™¨ Varnish æ¶ˆæ¯æ€»çº¿ ActiveMQã€SQS åº”ç”¨æœåŠ¡å™¨ Tomcatã€JBoss WebæœåŠ¡å™¨ Apacheã€Nginxã€IIS æ•°æ®åº“ MySQLã€Oracleã€PostgreSQLç­‰å…³ç³»å‹æ•°æ®åº“ï¼›cassandraã€mongoDBã€redisç­‰NoSQLæ•°æ®åº“ é¡¹ç›®ç®¡ç†ï¼ˆPMï¼‰ Jiraã€Asanaã€Taigaã€Trelloã€Basecampã€Pivotal Tracker å‚è€ƒé“¾æ¥ ç»™ DevOps åˆå­¦è€…çš„å…¥é—¨æŒ‡å—","tags":[{"name":"Ansible","slug":"Ansible","permalink":"http://www.lockey.xyz/tags/Ansible/"},{"name":"è‡ªåŠ¨åŒ–","slug":"è‡ªåŠ¨åŒ–","permalink":"http://www.lockey.xyz/tags/%E8%87%AA%E5%8A%A8%E5%8C%96/"},{"name":"è¿ç»´","slug":"è¿ç»´","permalink":"http://www.lockey.xyz/tags/%E8%BF%90%E7%BB%B4/"}]},{"title":"Ansible","date":"2019-12-09T09:45:35.000Z","path":"2019/12/09/DevOps/Ansible/","text":"ä»€ä¹ˆæ˜¯ Ansible ï¼Ÿ æ˜¯ä¸€ç§ IT è‡ªåŠ¨åŒ–å·¥å…· ä¾èµ–ç°æœ‰çš„æ“ä½œç³»ç»Ÿçš„å‡­è¯æ¥è®¿é—®æ§åˆ¶è¿œç¨‹æœºå™¨ ç®€å•æ˜“ç”¨ã€å®‰å…¨å¯é  Ansible å¯ä»¥å®Œæˆå“ªäº›ä»»åŠ¡ï¼Ÿ ç³»ç»Ÿé…ç½® å¼€å‘è½¯ä»¶ ç¼–æ’é«˜çº§çš„ IT ä»»åŠ¡ï¼ˆæŒç»­é›†æˆç­‰ï¼‰ Ansible çš„ä¼˜ç‚¹ è½»é‡çº§ æ˜“å­¦ä¹  æ“ä½œçµæ´» æ— å®¢æˆ·ç«¯ æ¨é€å¼ Module ä¸°å¯Œ å•†ä¸šåŒ–æ”¯æŒï¼ˆTowerï¼‰ Ansible çš„ç¼ºç‚¹ æ•ˆç‡ä½ï¼ˆä¸²è¡Œæ‰§è¡Œï¼‰ æ˜“æŒ‚èµ· ä¸å…¶ä»–ç±»ä¼¼é¡¹ç›®å¯¹æ¯” é¡¹ç›® å®¢æˆ·ç«¯ é€šä¿¡æ–¹å¼ Web é¡µé¢ æ•ˆç‡ æ˜“ç”¨ å®ç°è¯­è¨€ API å¼€æºç¤¾åŒº Ansible æ—  ssh æœ‰ï¼ˆTowerï¼‰ ä½ é«˜ Python æœ‰ 40.8 K Puppet æœ‰ socket æœ‰ ä¸€èˆ¬ ä½ Ruby æœ‰ 5.6 K Chef æœ‰ ssh æœ‰ ä¸€èˆ¬ é«˜ Python æœ‰ 6.1 K Salt æœ‰ RabbitMQ æœ‰ é«˜ é«˜ Python æœ‰ 10.5 K ä½¿ç”¨ å®‰è£… Mac: pip install ansible é…ç½® Host é…ç½®: /etc/ansible/hosts é…ç½®é¡¹: Inventory | Inventory ä¸­æ–‡ ssh é…ç½®: ssh-copy-id -i .ssh/[å…¬é’¥æ–‡ä»¶] [ç”¨æˆ·]@[è¿œç¨‹ä¸»æœº] Ad-Hoc &amp; Playbook ç±»ä¼¼ shell &amp; shell scriptï¼Œä½† Playbook æ›´åŠ å¼ºå¤§ Playbook æ˜¯å¯¹ Ad-Hoc çš„ç¼–æ’ Ad-Hoc é€‚åˆç®€å•å¿«é€Ÿçš„ä»»åŠ¡ Playbook é€‚åˆå¤æ‚å¼‚æ­¥çš„ä»»åŠ¡ Playbook è§£å†³ shell script çš„ç¼–å†™å¤æ‚ã€æ“ä½œç¹çã€è·¨å¹³å°é—®é¢˜ Ad-Hoc è¯­æ³• ansible [è¿œç¨‹ä¸»æœº | åˆ†ç»„] -m [æ¨¡å—] -a 'æ¨¡å—å‚æ•°' Playbook ä»€ä¹ˆæ˜¯ Playbook ? ç”± YAML ç¼–å†™ ç®—æ˜¯ä¸€é—¨ç¼–ç¨‹è¯­è¨€ å‘½ä»¤é›†åˆ åŠŸèƒ½ å£°æ˜é…ç½® ç¼–æ’å¤æ‚ä»»åŠ¡ æ§åˆ¶ä»»åŠ¡æ‰§è¡Œ è¯­æ³• å˜é‡ï¼ˆInventory &amp; Playbookï¼‰ vars æµç¨‹æ§åˆ¶ å¾ªç¯ with_items with_nested (åµŒå¥—) åˆ¤æ–­ when [true, false, not] åŸºæœ¬ç»“æ„ host: è¢«æ“ä½œçš„æœºå™¨ remote_user: ç™»å½•æœºå™¨çš„ç”¨æˆ· tasks: éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ å¦‚æœè¯­å¥ä»¥ â€œ{â€ å¼€å¤´ï¼Œéœ€è¦ç”¨å¼•å·åŒ…èµ·æ¥ ä¾‹å­ $ vim test.yml --- - hosts: 192.168.1.111 // æŒ‡å®šä¸»æœº remote_user: root // æŒ‡å®šåœ¨è¢«ç®¡ç†çš„ä¸»æœºä¸Šæ‰§è¡Œä»»åŠ¡çš„ç”¨æˆ· tasks: // ä»»åŠ¡åˆ—è¡¨ - name: disable selinux // ä»»åŠ¡å command: '/sbin/setenforce 0' // è°ƒç”¨commandæ¨¡å— æ‰§è¡Œå…³é—­é˜²ç«å¢™å‘½ä»¤ - name: start nginx // ä»»åŠ¡å service: name=nginx state=started // è°ƒç”¨serviceæ¨¡å— å¼€å¯ nginx æœåŠ¡ $ ansible-playbook test.yml","tags":[{"name":"Ansible","slug":"Ansible","permalink":"http://www.lockey.xyz/tags/Ansible/"},{"name":"è‡ªåŠ¨åŒ–","slug":"è‡ªåŠ¨åŒ–","permalink":"http://www.lockey.xyz/tags/%E8%87%AA%E5%8A%A8%E5%8C%96/"},{"name":"è¿ç»´","slug":"è¿ç»´","permalink":"http://www.lockey.xyz/tags/%E8%BF%90%E7%BB%B4/"}]},{"title":"å¼¹æ€§ä¼¸ç¼©","date":"2019-12-09T06:37:59.000Z","path":"2019/12/09/Aliyun/å¼¹æ€§ä¼¸ç¼©/","text":"èƒ½åŠ› æ ¹æ®ä¸šåŠ¡éœ€æ±‚å’Œç­–ç•¥è‡ªåŠ¨è°ƒæ•´å¼¹æ€§è®¡ç®—èµ„æºï¼Œåœ¨ä¸šåŠ¡éœ€æ±‚å¢é•¿æ—¶æ— ç¼å¢åŠ  ECS å®ä¾‹æ»¡è¶³è®¡ç®—éœ€è¦ï¼Œåœ¨ä¸šåŠ¡éœ€æ±‚ä¸‹é™æ—¶è‡ªåŠ¨å‡å°‘ ECS å®ä¾‹èŠ‚çº¦æˆæœ¬ã€‚ ä½¿ç”¨ æ­¥éª¤ op1=>operation: åˆ›å»ºä¼¸ç¼©ç»„ op2=>operation: åˆ›å»ºä¼¸ç¼©é…ç½® op3=>operation: å¯ç”¨ä¼¸ç¼©ç»„ op4=>operation: åˆ›å»ºä¼¸ç¼©è§„åˆ™ op5=>operation: åˆ›å»ºå®šæ—¶ä»»åŠ¡ op6=>operation: åˆ›å»ºæŠ¥è­¦ä»»åŠ¡ op1(right)->op2 op2(right)->op3 op3(right)->op4 op4(right)->op5 op5(right)->op6{\"scale\":1,\"line-width\":2,\"line-length\":50,\"text-margin\":10,\"font-size\":12} var code = document.getElementById(\"flowchart-0-code\").value; var options = JSON.parse(decodeURIComponent(document.getElementById(\"flowchart-0-options\").value)); var diagram = flowchart.parse(code); diagram.drawSVG(\"flowchart-0\", options);","tags":[{"name":"å¼¹æ€§ä¼¸ç¼©","slug":"å¼¹æ€§ä¼¸ç¼©","permalink":"http://www.lockey.xyz/tags/%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9/"}]},{"title":"Docker-éƒ¨ç½²-Jenkins","date":"2019-12-09T01:19:13.000Z","path":"2019/12/09/DevOps/Docker-éƒ¨ç½²-Jenkins/","text":"éƒ¨ç½² Dockerfile FROM jenkins/jenkins:lts MAINTAINER Lockey USER root ARG dockerGid=999 RUN echo &quot;docker:x:${dockerGid}:jenkins&quot; &gt;&gt; /etc/group æ„å»º docker build . -t myjenkins è¿è¡Œ docker run -d --privileged=true -p 8005:8080 -p 50000:50000 --name myjenkins_1 -v /root/jenkins:/var/jenkins_home -v /root/.ssh:/var/jenkins_home/.ssh -v /var/run/docker.sock:/var/run/docker.sock -v /var/lib/docker:/var/lib/docker -v $(which docker):/usr/bin/docker -v $(which docker-compose):/usr/bin/docker-compose myjenkins Slave å®‰è£…Java(8) apt install openjdk-8-jre-headless é…ç½®å…å¯†ç™»å½• ssh-keygen -t rsa æ³¨æ„ .sshæ–‡ä»¶æŒ‚è½½ Gitè®¿é—® Slaveè®¿é—® Dockerfile å°†ç”¨æˆ·åŠ å…¥dockerç”¨æˆ·ç»„ï¼Œä¸ç„¶æ²¡æœ‰Dockerè®¿é—®æƒé™ æ›´æ¢æºã€å›½å†…ã€‘ æ‰“å¼€ï¼š http[s]://[URL]/pluginManager/advanced æ›¿æ¢å‡çº§ç«™ç‚¹URLï¼šhttps://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json PSï¼šå¦‚æœå‡ºç°æ›´æ¢åè¿˜æ˜¯èµ°äº†å®˜æ–¹æºï¼Œå¯ä»¥é…ç½® Nginxï¼š rewrite ^/download/plugins/(.*)$ https://mirrors.tuna.tsinghua.edu.cn/jenkins/plugins/$1? last;","tags":[{"name":"Jenkins","slug":"Jenkins","permalink":"http://www.lockey.xyz/tags/Jenkins/"}]},{"title":"Gitbook","date":"2019-12-05T03:58:04.000Z","path":"2019/12/05/Gitbook/","text":"Dockerfile FROM node WORKDIR /build EXPOSE 4000 RUN npm install gitbook -g; RUN npm install gitbook-cli -g; WORKDIR /build/work RUN gitbook init CMD [&quot;gitbook&quot;, &quot;serve&quot;] æ„å»º $ docker build . -t acgitbook è¿è¡Œ $ docker run -d --name acgitbook_1 -p 8006:4000 -v /root/jenkins/workspace/acdocs/work:/build/work acgitbook /bin/bash -c &quot;gitbook install;gitbook serve&quot;","tags":[{"name":"æ–‡æ¡£å·¥å…·","slug":"æ–‡æ¡£å·¥å…·","permalink":"http://www.lockey.xyz/tags/%E6%96%87%E6%A1%A3%E5%B7%A5%E5%85%B7/"}]}]