<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Lockey</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.lockey.xyz/"/>
  <updated>2020-04-21T10:07:18.031Z</updated>
  <id>http://www.lockey.xyz/</id>
  
  <author>
    <name>Lockey</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Uvicorn - æœ€å¼ºå¼‚æ­¥æœåŠ¡å™¨ç½‘å…³æ¥å£ï¼Ÿ</title>
    <link href="http://www.lockey.xyz/2020/04/20/Python/Uvicorn--%E6%9C%80%E5%BC%BA%E5%BC%82%E6%AD%A5%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9F/"/>
    <id>http://www.lockey.xyz/2020/04/20/Python/Uvicorn--%E6%9C%80%E5%BC%BA%E5%BC%82%E6%AD%A5%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9F/</id>
    <published>2020-04-20T06:47:47.000Z</published>
    <updated>2020-04-21T10:07:18.031Z</updated>
    
    <content type="html"><![CDATA[<h2 id="web-æœåŠ¡åŸºç¡€æ¦‚å¿µ"><a class="header-anchor" href="#web-æœåŠ¡åŸºç¡€æ¦‚å¿µ"></a>Web æœåŠ¡åŸºç¡€æ¦‚å¿µ</h2><section class="reference"><p>å¦‚æœéœ€è¦è·‘èµ·ä¸€ä¸ªæ™®é€šçš„ Web æœåŠ¡ï¼ˆç½‘ç«™ã€æ¥å£æœåŠ¡ï¼‰ï¼Œ ä¸€èˆ¬éœ€è¦æœ‰ä¸€å°ä¸»æœºï¼ˆäº‘ä¸»æœºç­‰ï¼‰ï¼Œç„¶ååœ¨ä¸»æœºä¸Šå¯åŠ¨ <strong>Web åº”ç”¨ç¨‹åº</strong>ã€‚</p><p>åœ¨ Python ä¸­ï¼Œå¤§éƒ¨åˆ† Web æ¡†æ¶ï¼ˆDjangoã€Flaskç­‰ï¼‰è‡ªå¸¦çš„ Web æœåŠ¡å™¨æ€§èƒ½è¾ƒå·®ï¼Œä¸é€‚åˆåœ¨ç”Ÿäº§ç¯å¢ƒæŠ•å…¥ä½¿ç”¨ï¼Œè¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆè¾ƒå¤šï¼Œç›®å‰ä½¿ç”¨è¾ƒå¤šçš„æ˜¯ä½¿ç”¨ä¸“ä¸šçš„ <strong>HTTP æœåŠ¡å™¨ï¼ˆè½¯ä»¶ï¼Œå¦‚ï¼šNginxã€Apacheã€IISç­‰ï¼‰</strong> æä¾› Web æœåŠ¡ï¼Œç”¨ <strong>æœåŠ¡å™¨ç½‘å…³æ¥å£ï¼ˆWSGIï¼‰æœåŠ¡å™¨</strong> ä½œä¸º HTTP æœåŠ¡å™¨å’Œ Web åº”ç”¨ç¨‹åºæˆ–æ¡†æ¶ä¹‹é—´çš„æ¥å£ï¼Œæ„æˆä¸€ä¸ªå®Œæ•´çš„ Web æœåŠ¡ã€‚</p></section><h3 id="ä»€ä¹ˆæ˜¯-web-åº”ç”¨ç¨‹åºï¼Ÿ"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-web-åº”ç”¨ç¨‹åºï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ Web åº”ç”¨ç¨‹åºï¼Ÿ</h3><section class="reference"><p>ä¸€ä¸ª Web åº”ç”¨ç¨‹åºæ˜¯ç”±å®Œæˆç‰¹å®šä»»åŠ¡çš„å„ç§ Web ç»„ä»¶æ„æˆï¼Œå¹¶é€šè¿‡ Web å°†æœåŠ¡å±•ç¤ºç»™å¤–ç•Œã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒWeb åº”ç”¨ç¨‹åºæ˜¯ç”±å¤šä¸ª Servletã€JSP é¡µé¢ã€HTML æ–‡ä»¶ä»¥åŠå›¾åƒæ–‡ä»¶ç­‰ç»„æˆã€‚æ‰€æœ‰è¿™äº›ç»„ä»¶ç›¸äº’åè°ƒä¸ºç”¨æˆ·æä¾›ä¸€ç»„å®Œæ•´çš„æœåŠ¡ã€‚</p></section><h3 id="ä»€ä¹ˆæ˜¯-http-æœåŠ¡å™¨ï¼Ÿ"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-http-æœåŠ¡å™¨ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ HTTP æœåŠ¡å™¨ï¼Ÿ</h3><section class="reference"><p>HTTP æœåŠ¡å™¨é€šå¸¸ä¹Ÿå« Web æœåŠ¡å™¨â€¦â€¦ï¼ˆï¼Ÿï¼Ÿï¼Ÿé»‘äººé—®å·è„¸ï¼Ÿï¼Ÿï¼Ÿï¼‰<br>å®ƒé€šè¿‡ HTTP åè®®å¤„ç† Web è¯·æ±‚ï¼ˆæ¥æ”¶å’Œç®¡ç†ï¼‰ã€‚</p></section><h3 id="ä»€ä¹ˆæ˜¯-wsgi-æœåŠ¡å™¨ï¼Ÿ"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-wsgi-æœåŠ¡å™¨ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ WSGI æœåŠ¡å™¨ï¼Ÿ</h3><section class="reference"><p>WSGIï¼ˆPython Web Server Gateway Interfaceï¼‰åŸºäº CGIï¼ˆCommon Gateway Interfaceï¼‰ æ ‡å‡†è®¾è®¡ï¼Œæ˜¯ä¸º Python å®šä¹‰çš„ Web æœåŠ¡å™¨å’Œ Web åº”ç”¨ç¨‹åºæˆ–æ¡†æ¶ä¹‹é—´çš„ä¸€ç§ç®€å•è€Œé€šç”¨çš„æ¥å£ï¼ˆå…¶ä»–è¯­è¨€åœ¨è¿™ä¹‹åä¹Ÿå‡ºç°ç±»ä¼¼çš„æ¥å£ï¼‰ã€‚WSGI æœåŠ¡å™¨æ˜¯åŸºäº WSGI åè®®å®ç°çš„ç”¨æ¥è°ƒç”¨ Web åº”ç”¨ç¨‹åºçš„æœåŠ¡å™¨ï¼Œå¦å¤–ï¼Œå®ƒä¹Ÿå¯ä»¥æ¥æ”¶æ¥è‡ª HTTP æœåŠ¡å™¨çš„å®ç° WSGI æ¥å£çš„è¯·æ±‚æ•°æ®ï¼Œå®Œç¾å¯¹æ¥äº† Web åº”ç”¨ç¨‹åºå’Œ HTTP æœåŠ¡å™¨çš„è¯·æ±‚ã€æ•°æ®äº¤äº’ã€‚</p></section><h2 id="wsgi-çš„ä¼˜ç¼ºç‚¹"><a class="header-anchor" href="#wsgi-çš„ä¼˜ç¼ºç‚¹"></a>WSGI çš„ä¼˜ç¼ºç‚¹</h2><section class="reference"></section><h4 id="ä¼˜ç‚¹"><a class="header-anchor" href="#ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h4><section class="reference"><ul><li>éƒ¨ç½²å¤šæ ·åŒ–</li><li>ç»„ä»¶é—´é«˜åº¦è§£è€¦ï¼ˆä»»ä½•ä¸€ä¸ªç¬¦åˆ WSGI è§„èŒƒçš„åº”ç”¨ç¨‹åºéƒ½å¯ä»¥éƒ¨ç½²åœ¨ä»»ä½•ä¸€ä¸ªå®ç°äº† WSGI è§„èŒƒçš„æœåŠ¡å™¨ä¸Šï¼‰</li></ul></section><h4 id="ç¼ºç‚¹"><a class="header-anchor" href="#ç¼ºç‚¹"></a>ç¼ºç‚¹</h4><section class="reference"><ul><li>æ— æ³•å¤„ç† WebSocketã€HTTP/2 ä¸€ä¸ª URL å¤šä¸ªè¯·æ±‚çš„æ¨¡å¼</li></ul></section><h2 id="ç»§ä»»è€…-asgi-å¼‚æ­¥æœåŠ¡å™¨ç½‘å…³æ¥å£"><a class="header-anchor" href="#ç»§ä»»è€…-asgi-å¼‚æ­¥æœåŠ¡å™¨ç½‘å…³æ¥å£"></a>ç»§ä»»è€… ASGIï¼ˆå¼‚æ­¥æœåŠ¡å™¨ç½‘å…³æ¥å£ï¼‰</h2><section class="reference"><p>ASGIï¼ˆAsynchronous Server Gateway Interfaceï¼‰æ˜¯ WSGI çš„ç²¾ç¥ç»§æ‰¿è€…ï¼Œæ—¨åœ¨åœ¨å…·æœ‰å¼‚æ­¥åŠŸèƒ½çš„ Python Web æœåŠ¡å™¨ï¼Œæ¡†æ¶å’Œåº”ç”¨ç¨‹åºä¹‹é—´æä¾›æ ‡å‡†æ¥å£ã€‚</p></section><h2 id="asgi-æœåŠ¡å™¨"><a class="header-anchor" href="#asgi-æœåŠ¡å™¨"></a>ASGI æœåŠ¡å™¨</h2><section class="reference"></section><h3 id="ä¸»æµå®ç°"><a class="header-anchor" href="#ä¸»æµå®ç°"></a>ä¸»æµå®ç°</h3><section class="reference"><ul><li>Uvicorn</li><li>Daphne</li><li>Hypercorn</li></ul></section><h2 id="uvicorn"><a class="header-anchor" href="#uvicorn"></a>Uvicorn</h2><section class="reference"><p><strong><em>The lightning-fast ASGI server.</em></strong><br>åŸºäº uvloop å’Œ httptools çš„ ASGI å®ç°ã€‚</p></section><h3 id="ä»€ä¹ˆæ˜¯-uvloopï¼Ÿ"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-uvloopï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ uvloopï¼Ÿ</h3><section class="reference"><ul><li>æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„å¼‚æ­¥éé˜»å¡æ¡†æ¶</li><li>æ˜¯å®Œæ•´çš„ asyncio äº‹ä»¶å¾ªç¯çš„æ›¿ä»£å“</li><li>å»ºç«‹åœ¨ libuv ä¹‹ä¸Š<ul><li>libuv æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ï¼Œäº‹ä»¶é©±åŠ¨çš„ I/O åº“ï¼Œå¹¶ä¸”æä¾›äº†è·¨å¹³å°ï¼ˆå¦‚windows, linuxï¼‰çš„ API</li></ul></li><li>ç”± Cython ç¼–å†™</li></ul></section><h4 id="ä»€ä¹ˆæ˜¯-å¼‚æ­¥éé˜»å¡-ï¼Ÿ"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-å¼‚æ­¥éé˜»å¡-ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ã€Œå¼‚æ­¥éé˜»å¡ã€ï¼Ÿ</h4><section class="reference"><p><strong>æœ‰å¼‚æ­¥å°±æœ‰åŒæ­¥ï¼Œæœ‰éé˜»å¡å°±æœ‰é˜»å¡</strong><br>ç»„åˆå¯å¾—ï¼šåŒæ­¥é˜»å¡ã€åŒæ­¥ä¸é˜»å¡ã€å¼‚æ­¥é˜»å¡ã€å¼‚æ­¥ä¸é˜»å¡</p></section><h5 id="ä¸€ä¸ªæ¥è‡ªé€¼ä¹ä¸Šçš„-ğŸŒ°"><a class="header-anchor" href="#ä¸€ä¸ªæ¥è‡ªé€¼ä¹ä¸Šçš„-ğŸŒ°"></a>ä¸€ä¸ªæ¥è‡ªé€¼ä¹ä¸Šçš„ ğŸŒ° â†“</h5><section class="reference"><blockquote><p>è€å¼ çˆ±å–èŒ¶ï¼ŒåºŸè¯ä¸è¯´ï¼Œç…®å¼€æ°´ã€‚<br>å‡ºåœºäººç‰©ï¼šè€å¼ ï¼Œæ°´å£¶ä¸¤æŠŠï¼ˆæ™®é€šæ°´å£¶ï¼Œç®€ç§°æ°´å£¶ï¼›ä¼šå“çš„æ°´å£¶ï¼Œç®€ç§°å“æ°´å£¶ï¼‰ã€‚</p><ol><li>è€å¼ æŠŠæ°´å£¶æ”¾åˆ°ç«ä¸Šï¼Œç«‹ç­‰æ°´å¼€ã€‚ï¼ˆåŒæ­¥é˜»å¡ï¼‰<br>è€å¼ è§‰å¾—è‡ªå·±æœ‰ç‚¹å‚»</li><li>è€å¼ æŠŠæ°´å£¶æ”¾åˆ°ç«ä¸Šï¼Œå»å®¢å…çœ‹ç”µè§†ï¼Œæ—¶ä¸æ—¶å»å¨æˆ¿çœ‹çœ‹æ°´å¼€æ²¡æœ‰ã€‚ï¼ˆåŒæ­¥éé˜»å¡ï¼‰<br>è€å¼ è¿˜æ˜¯è§‰å¾—è‡ªå·±æœ‰ç‚¹å‚»ï¼Œäºæ˜¯å˜é«˜ç«¯äº†ï¼Œä¹°äº†æŠŠä¼šå“ç¬›çš„é‚£ç§æ°´å£¶ã€‚æ°´å¼€ä¹‹åï¼Œèƒ½å¤§å£°å‘å‡ºå˜€~~~~çš„å™ªéŸ³ã€‚</li><li>è€å¼ æŠŠå“æ°´å£¶æ”¾åˆ°ç«ä¸Šï¼Œç«‹ç­‰æ°´å¼€ã€‚ï¼ˆå¼‚æ­¥é˜»å¡ï¼‰<br>è€å¼ è§‰å¾—è¿™æ ·å‚»ç­‰æ„ä¹‰ä¸å¤§</li><li>è€å¼ æŠŠå“æ°´å£¶æ”¾åˆ°ç«ä¸Šï¼Œå»å®¢å…çœ‹ç”µè§†ï¼Œæ°´å£¶å“ä¹‹å‰ä¸å†å»çœ‹å®ƒäº†ï¼Œå“äº†å†å»æ‹¿å£¶ã€‚ï¼ˆå¼‚æ­¥éé˜»å¡ï¼‰è€å¼ è§‰å¾—è‡ªå·±èªæ˜äº†ã€‚</li></ol><p>æ‰€è°“åŒæ­¥å¼‚æ­¥ï¼Œåªæ˜¯å¯¹äºæ°´å£¶è€Œè¨€ã€‚æ™®é€šæ°´å£¶ï¼ŒåŒæ­¥ï¼›å“æ°´å£¶ï¼Œå¼‚æ­¥ã€‚è™½ç„¶éƒ½èƒ½å¹²æ´»ï¼Œä½†å“æ°´å£¶å¯ä»¥åœ¨è‡ªå·±å®Œå·¥ä¹‹åï¼Œæç¤ºè€å¼ æ°´å¼€äº†ã€‚è¿™æ˜¯æ™®é€šæ°´å£¶æ‰€ä¸èƒ½åŠçš„ã€‚åŒæ­¥åªèƒ½è®©è°ƒç”¨è€…å»è½®è¯¢è‡ªå·±ï¼ˆæƒ…å†µ 2 ä¸­ï¼‰ï¼Œé€ æˆè€å¼ æ•ˆç‡çš„ä½ä¸‹ã€‚<br>æ‰€è°“é˜»å¡éé˜»å¡ï¼Œä»…ä»…å¯¹äºè€å¼ è€Œè¨€ã€‚ç«‹ç­‰çš„è€å¼ ï¼Œé˜»å¡ï¼›çœ‹ç”µè§†çš„è€å¼ ï¼Œéé˜»å¡ã€‚æƒ…å†µ 1 å’Œæƒ…å†µ 3 ä¸­è€å¼ å°±æ˜¯é˜»å¡çš„ï¼Œåª³å¦‡å–Šä»–éƒ½ä¸çŸ¥é“ã€‚è™½ç„¶ 3 ä¸­å“æ°´å£¶æ˜¯å¼‚æ­¥çš„ï¼Œå¯å¯¹äºç«‹ç­‰çš„è€å¼ æ²¡æœ‰å¤ªå¤§çš„æ„ä¹‰ã€‚æ‰€ä»¥ä¸€èˆ¬å¼‚æ­¥æ˜¯é…åˆéé˜»å¡ä½¿ç”¨çš„ï¼Œè¿™æ ·æ‰èƒ½å‘æŒ¥å¼‚æ­¥çš„æ•ˆç”¨ã€‚</p></blockquote></section><h4 id="ä»€ä¹ˆæ˜¯-äº‹ä»¶é©±åŠ¨-ï¼Ÿ"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-äº‹ä»¶é©±åŠ¨-ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ã€Œäº‹ä»¶é©±åŠ¨ã€ï¼Ÿ</h4><section class="reference"><p>ä¼ ç»Ÿç¼–ç¨‹å¤§éƒ¨åˆ†æ˜¯çº¿æ€§æ¨¡å¼çš„ï¼Œæ§åˆ¶æµç¨‹ç”±è¾“å…¥æ•°æ®å’Œç¼–å†™çš„ç¨‹åºå†³å®šï¼›åœ¨çŸ¥é“è¿™ä¸ªç¨‹åºå½“å‰çš„è¿è¡ŒçŠ¶æ€ï¼ˆåŒ…æ‹¬è¾“å…¥æ•°æ®å’Œç¨‹åºæœ¬èº«ï¼‰çš„å‰æä¸‹ï¼Œä½ å°±çŸ¥é“æ¥ä¸‹æ¥ç”šè‡³ä¸€ç›´åˆ°ç»“æŸå®ƒçš„è¿è¡Œæµç¨‹ã€‚</p><p>ã€Œäº‹ä»¶é©±åŠ¨ã€æ˜¯æŒ‡åœ¨æŒç»­äº‹åŠ¡ç®¡ç†è¿‡ç¨‹ä¸­ï¼Œè¿›è¡Œå†³ç­–çš„ä¸€ç§ç­–ç•¥ï¼Œå³è·Ÿéšå½“å‰æ—¶é—´ç‚¹ä¸Šå‡ºç°çš„äº‹ä»¶ï¼Œè°ƒåŠ¨å¯ç”¨èµ„æºï¼Œæ‰§è¡Œç›¸å…³ä»»åŠ¡ï¼Œä½¿ä¸æ–­å‡ºç°çš„é—®é¢˜å¾—ä»¥è§£å†³ï¼Œé˜²æ­¢äº‹åŠ¡å †ç§¯ã€‚äº‹ä»¶é©±åŠ¨æ¨¡å¼æ¯”è¾ƒé«˜å†·ï¼Œæœ‰ä¸ªå¥½è±ååŸåˆ™ï¼šâ€ä¸è¦æ‰“ç”µè¯ç»™æˆ‘ä»¬ï¼Œæˆ‘ä»¬ä¼šæ‰“ç”µè¯ç»™ä½ â€œã€‚äº‹ä»¶é©±åŠ¨ç¨‹åºåœ¨å¯åŠ¨åä¼šå¤„äºç­‰å¾…çŠ¶æ€ï¼Œä¼šç­‰å¾…äº‹ä»¶è§¦å‘ï¼Œç„¶åæ‰§è¡Œå“åº”å‡½æ•°ã€‚åˆè¢«ç§°ä¸º<code>I/O å¤šè·¯å¤ç”¨</code>â€¦â€¦</p></section><h5 id="âš -å‰ç½®åŸºç¡€æ¦‚å¿µ"><a class="header-anchor" href="#âš -å‰ç½®åŸºç¡€æ¦‚å¿µ"></a>âš ï¸ å‰ç½®åŸºç¡€æ¦‚å¿µ</h5><section class="reference"><ul><li>è¿›ç¨‹åœ°å€ç©ºé—´ï¼ˆè¿›ç¨‹è™šæ‹Ÿåœ°å€ï¼‰<ul><li>ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´ï¼ˆLinuxï¼‰<ul><li>å†…æ ¸å¯ä»¥è®¿é—®å—ä¿æŠ¤å†…å­˜ç©ºé—´ï¼Œä¹Ÿæœ‰è®¿é—®åº•å±‚æ‰€æœ‰è®¾å¤‡çš„æƒé™</li><li>ä¸ºäº†ä¿è¯å†…æ ¸å®‰å…¨ï¼ˆä¿è¯ç”¨æˆ·è¿›ç¨‹ä¸èƒ½ç›´æ¥æ“ä½œå†…æ ¸ï¼‰ï¼Œå°†è™šæ‹Ÿç©ºé—´åˆ’åˆ†ä¸ºç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´</li><li>32ä½æ“ä½œç³»ç»Ÿï¼š2^32 = 4GBï¼›å†…æ ¸ç©ºé—´ 1GBï¼ˆä»è™šæ‹Ÿåœ°å€0xC0000000åˆ°0xFFFFFFFFï¼‰ï¼Œç”¨æˆ·ç©ºé—´ 3GBï¼ˆä»è™šæ‹Ÿåœ°å€0x00000000åˆ°0xBFFFFFFFï¼‰</li><li>64ä½æ“ä½œç³»ç»Ÿï¼š2^48ï¼ˆä¸éœ€è¦64é‚£ä¹ˆå¤§ã€è¿‡å¤§ä¼šå¯¼è‡´èµ„æºæµªè´¹ï¼‰ = 256Tï¼›å†…æ ¸ã€ç”¨æˆ·ç©ºé—´åˆ†åˆ«å 128T</li></ul></li></ul></li><li>è¿›ç¨‹åˆ‡æ¢ï¼ˆä»»ä½•è¿›ç¨‹éƒ½åœ¨æ“ä½œç³»ç»Ÿçš„å†…æ ¸æ”¯æŒä¸‹è¿è¡Œï¼‰<ul><li>å¯ä»¥æŒ‚èµ·åœ¨ CPU ä¸Šè¿è¡Œçš„è¿›ç¨‹<ul><li>ä¿å­˜ä¸Šä¸‹æ–‡ï¼ˆè®¡æ•°å™¨ã€å¯„å­˜å™¨ç­‰ï¼‰</li><li>æ›´æ–° PCBï¼ˆè¿›ç¨‹æ§åˆ¶å—ï¼‰ä¿¡æ¯</li><li>æŠŠè¿›ç¨‹ PCB ç§»å…¥ç›¸åº”çš„é˜Ÿåˆ—ï¼ˆå°±ç»ªã€åœ¨æŸäº‹ä»¶é˜»å¡ç­‰é˜Ÿåˆ—ï¼‰</li></ul></li><li>å¯ä»¥æ¢å¤ä»¥å‰æŒ‚èµ·çš„è¿›ç¨‹<ul><li>é€‰æ‹©ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œï¼Œæ›´æ–°å…¶ PCB</li><li>æ›´æ–°å†…å­˜ç®¡ç†çš„æ•°æ®ç»“æ„</li><li>æ¢å¤ä¸Šä¸‹æ–‡</li></ul></li></ul></li><li>è¿›ç¨‹é˜»å¡ã€å”¤é†’<ul><li>è¿›ç¨‹çŠ¶æ€<ul><li>è¿è¡Œæ€ï¼šè¿›ç¨‹è·å¾— CPU å¹¶è¿è¡Œ</li><li>å°±ç»ªæ€ï¼šè¿›ç¨‹å…·å¤‡è¿è¡Œæ¡ä»¶ï¼Œä½†å°šæœªè·å¾— CPU</li><li>é˜»å¡æ€ï¼šè¿›ç¨‹å› ç­‰å¾…æŸäº‹ä»¶å‘ç”Ÿè€Œæš‚æ—¶ä¸èƒ½è¿è¡Œ</li></ul></li><li>æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œç”±äºæå‡ºç³»ç»ŸæœåŠ¡è¯·æ±‚ï¼ˆå¦‚ I/O æ“ä½œï¼‰æœªå¾—åˆ°ç³»ç»Ÿçš„ç«‹å³å“åº”ï¼Œè¯¥è¿›ç¨‹ä¼šè°ƒç”¨é˜»å¡åŸè¯­æŠŠè‡ªå·±é˜»å¡ï¼Œç­‰å¾…ç›¸åº”äº‹ä»¶å‡ºç°åè¢«å”¤é†’</li><li>åªæœ‰å¤„äºè·å¾— CPU çš„è¿›ç¨‹æ‰èƒ½å°†å…¶è½¬æ¢ä¸ºé˜»å¡çŠ¶æ€</li><li>é˜»å¡<ul><li>è¯·æ±‚ç³»ç»ŸæœåŠ¡ã€I/O æ“ä½œç­‰æœªå¾—åˆ°å³æ—¶å“åº”</li><li>æ‰¾åˆ°è¦è¢«é˜»å¡è¿›ç¨‹çš„æ ‡è¯†å·å¯¹åº”çš„ PCB</li><li>åœæ­¢æ‰§è¡Œ</li><li>è‹¥è¯¥è¿›ç¨‹ä¸ºè¿è¡ŒçŠ¶æ€ï¼ˆè·å¾— CPUï¼‰ï¼Œåˆ™ä¿æŠ¤ç°åœºï¼Œæ”¹å˜çŠ¶æ€ä¸ºé˜»å¡çŠ¶æ€</li><li>æŠŠ PCB æ’å…¥ç›¸åº”é˜»å¡é˜Ÿåˆ—</li></ul></li><li>å”¤é†’<ul><li>é˜»å¡åŸå› æœŸå¾…çš„äº‹ä»¶å‡ºç°</li><li>æŠŠè¢«é˜»å¡çš„è¿›ç¨‹ç§»å‡ºé˜»å¡é˜Ÿåˆ—</li><li>å°† PCB çŠ¶æ€æ”¹ä¸ºå°±ç»ªçŠ¶æ€</li><li>å°† PCB æ’å…¥åˆ°å°±ç»ªé˜Ÿåˆ—ä¸­</li></ul></li></ul></li><li>æ–‡ä»¶æè¿°ç¬¦ï¼ˆFDï¼‰ï¼ˆé€‚ç”¨äº Unixã€Linuxï¼›Windows ä¸­é€šå¸¸å« Handleï¼‰<ul><li><strong>åœ¨ Linux ä¸­ï¼Œä¸€åˆ‡çš†æ–‡ä»¶</strong><ul><li>å¯¹æ‰€æœ‰æ–‡ä»¶ï¼ˆç›®å½•ã€å­—ç¬¦è®¾å¤‡ã€å—è®¾å¤‡ã€å¥—æ¥å­—ã€æ‰“å°æœºã€è¿›ç¨‹ã€çº¿ç¨‹ã€ç®¡é“ç­‰ï¼‰æ“ä½œï¼Œè¯»å†™éƒ½å¯ç”¨fopen()/fclose()/fwrite()/fread()ç­‰å‡½æ•°è¿›è¡Œå¤„ç†</li></ul></li><li>ç”¨äºè¡¨è¿°æŒ‡å‘æ–‡ä»¶çš„å¼•ç”¨çš„æŠ½è±¡åŒ–æ¦‚å¿µ</li><li>æ ‡å‡†æ–‡ä»¶æè¿°ç¬¦<ul><li>0ï¼šæ ‡å‡†è¾“å…¥ï¼›1ï¼šæ ‡å‡†è¾“å‡ºï¼›2ï¼šæ ‡å‡†é”™è¯¯</li></ul></li></ul></li><li>ç¼“å­˜ I/Oï¼ˆæ ‡å‡†I/Oï¼‰<ul><li>å·¥ä½œè¿‡ç¨‹<ul><li>Linux ä¸­ï¼Œæ“ä½œç³»ç»Ÿä¼šå°† I/O çš„æ•°æ®ç¼“å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿçš„é¡µç¼“å­˜ä¸­<ul><li>æ•°æ®å…ˆè¢«æ‹·è´åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸ç¼“å†²åŒºä¸­</li><li>å†ä»å†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ°åº”ç”¨ç¨‹åºåœ°å€ç©ºé—´</li></ul></li></ul></li><li>ç¼ºç‚¹ï¼šå¼€é”€å¤§</li><li>åŸºäºç¼“å­˜ I/O å‡ºç°çš„æ¨¡å‹<ul><li>é˜»å¡ I/O</li><li>éé˜»å¡ I/O</li><li>I/O å¤šè·¯å¤ç”¨</li><li>ä¿¡å·é©±åŠ¨ I/Oï¼ˆä¸å¸¸ç”¨ï¼‰</li><li>å¼‚æ­¥ I/O</li></ul></li></ul></li></ul></section><h5 id="i-o-å¤šè·¯å¤ç”¨"><a class="header-anchor" href="#i-o-å¤šè·¯å¤ç”¨"></a>I/O å¤šè·¯å¤ç”¨</h5><section class="reference"><p>I/O å¤šè·¯å¤ç”¨å°±é€šè¿‡ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥ç›‘è§†å¤šä¸ªæè¿°ç¬¦ï¼Œä¸€æ—¦æŸä¸ªæè¿°ç¬¦å°±ç»ªï¼ˆä¸€èˆ¬æ˜¯è¯»å°±ç»ªæˆ–è€…å†™å°±ç»ªï¼‰ï¼Œèƒ½å¤Ÿé€šçŸ¥ç¨‹åºè¿›è¡Œç›¸åº”çš„è¯»å†™æ“ä½œã€‚</p><div class="warning"><p>é€šå¸¸åœ¨ I/O å¤šè·¯å¤ç”¨ä¸­ï¼ˆå¦‚ epollï¼‰ï¼Œsocket éœ€è¦è®¾ç½®ä¸º no-blocking æ¨¡å¼ï¼Œä¸ç„¶ä¼šå‡ºç°é—®é¢˜ â†“<br>ğŸŒ°ä½ çš„ã€Œè¯» fdã€éœ€è¦è¯»å– 200 Byte çš„æ•°æ®æ‰ä¼šè¿”å›ï¼Œä½†æ˜¯å‘é€æ•°æ®æ–¹åªå‘é€äº† 199 Byteï¼Œäºæ˜¯ä½ çš„ã€Œè¯» fdã€å°±ä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œå¹¶æœ€ç»ˆå¯¼è‡´ epoll å¤„äºè¢«é˜»å¡çŠ¶æ€ï¼Ÿ</p></div></section><h4 id="ä»€ä¹ˆæ˜¯-libuvï¼Ÿ"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-libuvï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ libuvï¼Ÿ</h4><section class="reference"></section><h5 id="libuv-æ¶æ„å›¾"><a class="header-anchor" href="#libuv-æ¶æ„å›¾"></a>libuv æ¶æ„å›¾ â†“</h5><section class="reference"><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="architecture.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure><ul><li>libuv æä¾›äº†ä¸åŒçš„æ¥å£æ¥æ“ä½œç½‘ç»œ I/Oã€æ–‡ä»¶ I/Oã€DNS ç›¸å…³å‡½æ•°ä»¥åŠç”¨æˆ·ä»£ç </li><li>ç½‘ç»œ I/O çš„å¤„ç†ï¼Œåœ¨ä¸åŒå¹³å°ä¸‹ä½¿ç”¨ä¸åŒçš„å¼‚æ­¥æ¨¡å‹<ul><li>Linux â€“ epoll</li><li>OSX &amp; BSDs â€“ kqueue</li><li>Windows â€“ IOCP</li><li>SunOS â€“ event ports</li></ul></li><li>æ–‡ä»¶ I/Oã€DNS å‡½æ•°åŠç”¨æˆ·ä»£ç å¤„ç†ä¸ä¾èµ–å¹³å°ï¼Œç›´æ¥ä½¿ç”¨çº¿ç¨‹æ± å¤„ç†</li></ul></section><h3 id="ä»€ä¹ˆæ˜¯-httptoolsï¼Ÿ"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-httptoolsï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ httptoolsï¼Ÿ</h3><section class="reference"><ul><li>æ˜¯ NodeJS HTTP è§£æçš„ Python å®ç°</li><li>ç”± Cython ç¼–å†™</li></ul></section><h2 id="å°ç»“"><a class="header-anchor" href="#å°ç»“"></a>å°ç»“</h2><section class="reference"><p>å·ç§°â€æœ€å¼ºâ€œçš„ Uvicornï¼Œæ˜¯ä¸€ä¸ªåŸºäºäº‹ä»¶çš„éé˜»å¡æ¡†æ¶ï¼Œä»£ç ç”± Cython å®ç°ï¼Œå¯¹æ¯” Daphne çš„ Twisted äº‹ä»¶é©±åŠ¨ï¼Œç†è®ºä¸Šæ¥è¯´ï¼Œé€Ÿåº¦ç¡®å®æ˜¯åœ¨ Daphone ä¹‹ä¸Šçš„ï¼ŒCython + éé˜»å¡ + äº‹ä»¶å¾ªç¯çš„ç»„åˆï¼Œç›®å‰æ¥çœ‹ï¼Œç¡®å®æ˜¯ä¸€ä¸ªæœ€å¼ºç»„åˆã€‚</p></section><h2 id="æ€»ç»“"><a class="header-anchor" href="#æ€»ç»“"></a>æ€»ç»“</h2><section class="reference"><p>ã€Œæˆ‘æ„¿ç§°ä½ ä¸ºæœ€å¼ºã€</p><p><a href="https://scoolor.github.io/2018/11/08/linux-everything-is-file/" target="_blank" rel="noopener">https://scoolor.github.io/2018/11/08/linux-everything-is-file/</a></p><p><a href="https://www.iminho.me/wiki/blog-23.html" target="_blank" rel="noopener">https://www.iminho.me/wiki/blog-23.html</a></p></section>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;web-æœåŠ¡åŸºç¡€æ¦‚å¿µ&quot;&gt;&lt;a class=&quot;header-anchor&quot; href=&quot;#web-æœåŠ¡åŸºç¡€æ¦‚å¿µ&quot;&gt;&lt;/a&gt;Web æœåŠ¡åŸºç¡€æ¦‚å¿µ&lt;/h2&gt;
&lt;section class=&quot;reference&quot;&gt;
&lt;p&gt;å¦‚æœéœ€è¦è·‘èµ·ä¸€ä¸ªæ™®é€šçš„ Web æœåŠ¡ï¼ˆç½‘ç«™ã€æ¥å£æœ
      
    
    </summary>
    
    
      <category term="Python" scheme="http://www.lockey.xyz/categories/Python/"/>
    
    
      <category term="Uvicorn" scheme="http://www.lockey.xyz/tags/Uvicorn/"/>
    
      <category term="å¼‚æ­¥æœåŠ¡å™¨" scheme="http://www.lockey.xyz/tags/%E5%BC%82%E6%AD%A5%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>K8S metrics-server æ­å»º/è¸©å‘</title>
    <link href="http://www.lockey.xyz/2020/04/02/DevOps/K8S_metrics-server_%E6%90%AD%E5%BB%BA_%E8%B8%A9%E5%9D%91/"/>
    <id>http://www.lockey.xyz/2020/04/02/DevOps/K8S_metrics-server_%E6%90%AD%E5%BB%BA_%E8%B8%A9%E5%9D%91/</id>
    <published>2020-04-02T03:59:05.000Z</published>
    <updated>2020-04-02T04:06:47.185Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a class="header-anchor" href="#ç®€ä»‹"></a>ç®€ä»‹</h2><section class="reference"></section><h2 id="æ­å»º"><a class="header-anchor" href="#æ­å»º"></a>æ­å»º</h2><section class="reference"><ol><li><a href="https://github.com/kubernetes-sigs/metrics-server" target="_blank" rel="noopener">ä¸‹è½½</a>é…ç½®æ–‡ä»¶</li><li>ä¿®æ”¹<code>deploy/kubernetes/metrics-server-deployment.yaml</code> imageï¼ˆå›½å†…ï¼‰</li><li>ä¿®æ”¹<code>deploy/kubernetes/metrics-server-deployment.yaml</code> args é…ç½®ï¼ˆåœ¨å‡ºç°ï¼š<code>no metrics known for pod</code> <code>timeout</code>ç­‰é”™è¯¯æ—¶ä¿®æ”¹ï¼›åº”è¯¥ä¼šæœ‰å®‰å…¨éšæ‚£ï¼Œæ…ç”¨ï¼‰<ol><li>å¢åŠ  - --kubelet-insecure-tls  # ä¸éªŒè¯TLS</li><li>å¢åŠ  - --kubelet-preferred-address-types=InternalDNS,InternalIP,ExternalDNS,ExternalIP,Hostname  # ç›´æ¥è®¿é—®IP</li></ol></li></ol></section><h2 id="æµ‹è¯•"><a class="header-anchor" href="#æµ‹è¯•"></a>æµ‹è¯•</h2><section class="reference"><p><code>kubectl top node</code><br><code>kubectl top pod</code><br>æ˜¾ç¤ºèµ„æºä¿¡æ¯</p></section>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ç®€ä»‹&quot;&gt;&lt;a class=&quot;header-anchor&quot; href=&quot;#ç®€ä»‹&quot;&gt;&lt;/a&gt;ç®€ä»‹&lt;/h2&gt;
&lt;section class=&quot;reference&quot;&gt;&lt;/section&gt;
&lt;h2 id=&quot;æ­å»º&quot;&gt;&lt;a class=&quot;header-anchor&quot; href=
      
    
    </summary>
    
    
      <category term="DevOps" scheme="http://www.lockey.xyz/categories/DevOps/"/>
    
    
      <category term="metrics-server" scheme="http://www.lockey.xyz/tags/metrics-server/"/>
    
  </entry>
  
  <entry>
    <title>Docker æ„å»ºç§æœ‰ pip ä»“åº“ï¼ˆdevpiï¼‰</title>
    <link href="http://www.lockey.xyz/2020/04/01/Python/Docker%E6%9E%84%E5%BB%BA%E7%A7%81%E6%9C%89pip%E4%BB%93%E5%BA%93/"/>
    <id>http://www.lockey.xyz/2020/04/01/Python/Docker%E6%9E%84%E5%BB%BA%E7%A7%81%E6%9C%89pip%E4%BB%93%E5%BA%93/</id>
    <published>2020-04-01T06:09:19.000Z</published>
    <updated>2020-04-01T06:22:31.542Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä½¿ç”¨åœºæ™¯"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h2><section class="reference"><ul><li>ç½‘ç»œç¯å¢ƒä¸ä½³ã€ä¸å…è®¸</li><li>éœ€è¦ç»å¸¸æ€§çš„ä½¿ç”¨pipï¼ˆæ¯”å¦‚ docker é•œåƒæ„å»ºï¼‰</li><li>è§‰å¾—ç¬¬ä¸‰æ–¹æºçš„ä½¿ç”¨ï¼Œä½¿å¸¦å®½å‹åŠ›å¤§</li></ul></section><h2 id="ä½¿ç”¨"><a class="header-anchor" href="#ä½¿ç”¨"></a>ä½¿ç”¨</h2><section class="reference"></section><h4 id="docker-å¯åŠ¨-devip-æœåŠ¡"><a class="header-anchor" href="#docker-å¯åŠ¨-devip-æœåŠ¡"></a>Docker å¯åŠ¨ï¼ˆdevipï¼‰æœåŠ¡</h4><section class="sample"><pre><code>docker run -d --name devpi \    --publish 3141:3141 \    --volume /Users/lockey/pypi:/data \  # è‡ªè¡Œæ›¿æ¢æŒ‚è½½ç›®å½•    --env=DEVPI_PASSWORD=secret \  # è‡ªè¡Œæ›´æ”¹ç™»å½•å¯†ç     --restart always \    muccg/devpi:4.5.0</code></pre></section><section class="reference"></section><h4 id="å‡†å¤‡"><a class="header-anchor" href="#å‡†å¤‡"></a>å‡†å¤‡</h4><section class="reference"><p><code>pip install devpi</code></p></section><h4 id="è®¾ç½®"><a class="header-anchor" href="#è®¾ç½®"></a>è®¾ç½®</h4><section class="reference"><p><code>devpi use http://10.0.0.38:3141/root/public</code></p></section><h4 id="ç™»å½•"><a class="header-anchor" href="#ç™»å½•"></a>ç™»å½•</h4><section class="reference"><p><code>devpi login root</code></p></section><h4 id="ä¸Šä¼ "><a class="header-anchor" href="#ä¸Šä¼ "></a>ä¸Šä¼ </h4><section class="reference"><ol><li>ä¸‹è½½éœ€è¦ä¸Šä¼ çš„ pip åŒ…ï¼ˆwhlã€gzã€zipç­‰ï¼‰</li><li><code>devpi upload --from-dir --formats=* .</code>  # è‡ªè¡Œä¿®æ”¹ä¸Šä¼ ç›®å½•</li></ol></section><h4 id="ä½¿ç”¨-v2"><a class="header-anchor" href="#ä½¿ç”¨-v2"></a>ä½¿ç”¨</h4><section class="reference"><p><a href="https://developer.aliyun.com/mirror/pypi?spm=a2c6h.13651102.0.0.3e221b11w9yGDx" target="_blank" rel="noopener">åŒæ™®é€šç¬¬ä¸‰æ–¹æºä¿®æ”¹æ­¥éª¤</a></p><p><strong><em>å‚è€ƒé“¾æ¥</em></strong><br><a href="https://hub.docker.com/r/muccg/devpi" target="_blank" rel="noopener">DockerHUB</a></p></section>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ä½¿ç”¨åœºæ™¯&quot;&gt;&lt;a class=&quot;header-anchor&quot; href=&quot;#ä½¿ç”¨åœºæ™¯&quot;&gt;&lt;/a&gt;ä½¿ç”¨åœºæ™¯&lt;/h2&gt;
&lt;section class=&quot;reference&quot;&gt;
&lt;ul&gt;
&lt;li&gt;ç½‘ç»œç¯å¢ƒä¸ä½³ã€ä¸å…è®¸&lt;/li&gt;
&lt;li&gt;éœ€è¦ç»å¸¸æ€§çš„ä½¿ç”¨pipï¼ˆæ¯”å¦‚ do
      
    
    </summary>
    
    
      <category term="Python" scheme="http://www.lockey.xyz/categories/Python/"/>
    
    
      <category term="Python" scheme="http://www.lockey.xyz/tags/Python/"/>
    
      <category term="pip" scheme="http://www.lockey.xyz/tags/pip/"/>
    
      <category term="devpi" scheme="http://www.lockey.xyz/tags/devpi/"/>
    
      <category term="ç§æœ‰" scheme="http://www.lockey.xyz/tags/%E7%A7%81%E6%9C%89/"/>
    
  </entry>
  
  <entry>
    <title>åœ¨K8Sé›†ç¾¤ä¸­æ­å»ºRedisé›†ç¾¤(istioç½‘ç»œ)</title>
    <link href="http://www.lockey.xyz/2020/03/25/DevOps/%E5%9C%A8K8S%E9%9B%86%E7%BE%A4%E4%B8%AD%E6%90%AD%E5%BB%BARedis%E9%9B%86%E7%BE%A4/"/>
    <id>http://www.lockey.xyz/2020/03/25/DevOps/%E5%9C%A8K8S%E9%9B%86%E7%BE%A4%E4%B8%AD%E6%90%AD%E5%BB%BARedis%E9%9B%86%E7%BE%A4/</id>
    <published>2020-03-25T06:46:50.000Z</published>
    <updated>2020-03-25T07:26:37.511Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a class="header-anchor" href="#èƒŒæ™¯"></a>èƒŒæ™¯</h2><section class="reference"><ul><li>åœ¨ K8S é›†ç¾¤ä¸­æ­å»º Redis é›†ç¾¤</li><li>K8S é›†ç¾¤ä½¿ç”¨ istio æ¥ç®¡ç½‘ç»œ</li></ul></section><h2 id="æ³¨æ„äº‹é¡¹"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><section class="reference"><div class="warning"><p>ç”±äº istio æ¥ç®¡ç½‘ç»œï¼Œä¼šé€ æˆ Redis é›†ç¾¤åˆå§‹åŒ–ä¸èƒ½æˆåŠŸï¼ˆä¸€ç›´å¡åœ¨ï¼šWaiting for the cluster to joinï¼‰<br>ä»¥ä¸Šé—®é¢˜éœ€è¦åœ¨ pod å¯åŠ¨çš„æ—¶å€™è®¾ç½® cluster-announce-ipï¼Œå…·ä½“è§ä¸‹ â†“</p></div></section><h2 id="éƒ¨ç½²é›†ç¾¤å‰æ"><a class="header-anchor" href="#éƒ¨ç½²é›†ç¾¤å‰æ"></a>éƒ¨ç½²é›†ç¾¤å‰æ</h2><section class="reference"><ul><li>ä½¿ç”¨ PV/PVC å­˜å‚¨ï¼ˆ<a href="../../Linux/Ubuntu18.04--NFS%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/">å¯æ­å»º NFS</a>ï¼‰</li><li>ä½¿ç”¨ StatefulSet é…ç½®é›†ç¾¤</li><li>ç¡®è®¤èŠ‚ç‚¹é—´ 6379ã€16379 ç«¯å£å¯è®¿é—®</li></ul></section><h2 id="éƒ¨ç½²"><a class="header-anchor" href="#éƒ¨ç½²"></a>éƒ¨ç½²</h2><section class="reference"></section><h4 id="éƒ¨ç½²-nfs-ç®¡ç†-nfs-client-provisioner"><a class="header-anchor" href="#éƒ¨ç½²-nfs-ç®¡ç†-nfs-client-provisioner"></a>éƒ¨ç½² NFS ç®¡ç†(nfs-client-provisioner)</h4><section class="sample"><pre><code>cat &lt;&lt; EOF &gt; ncp.yaml---kind: ServiceAccountapiVersion: v1metadata:  name: nfs-client-provisioner---kind: ClusterRoleapiVersion: rbac.authorization.k8s.io/v1metadata:  name: nfs-client-provisioner-runnerrules:  - apiGroups: [&quot;&quot;]    resources: [&quot;persistentvolumes&quot;]    verbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;, &quot;create&quot;, &quot;delete&quot;]  - apiGroups: [&quot;&quot;]    resources: [&quot;persistentvolumeclaims&quot;]    verbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;, &quot;update&quot;]  - apiGroups: [&quot;storage.k8s.io&quot;]    resources: [&quot;storageclasses&quot;]    verbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;]  - apiGroups: [&quot;&quot;]    resources: [&quot;events&quot;]    verbs: [&quot;list&quot;, &quot;watch&quot;, &quot;create&quot;, &quot;update&quot;, &quot;patch&quot;]  - apiGroups: [&quot;&quot;]    resources: [&quot;endpoints&quot;]    verbs: [&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;, &quot;create&quot;, &quot;update&quot;, &quot;patch&quot;]---kind: ClusterRoleBindingapiVersion: rbac.authorization.k8s.io/v1metadata:  name: run-nfs-client-provisionersubjects:  - kind: ServiceAccount    name: nfs-client-provisioner    namespace: defaultroleRef:  kind: ClusterRole  name: nfs-client-provisioner-runner  apiGroup: rbac.authorization.k8s.io---kind: DeploymentapiVersion: apps/v1metadata:  name: nfs-client-provisionerspec:  replicas: 1  selector:    matchLabels:      app: nfs-client-provisioner  strategy:    type: Recreate  template:    metadata:      labels:        app: nfs-client-provisioner    spec:      serviceAccountName: nfs-client-provisioner      containers:        - name: nfs-client-provisioner          image: &lt;é•œåƒä»“åº“(ç½‘ç»œæ–¹ä¾¿å¯ä»¥è‡ªè¡Œåˆ° Docker HUB æ‰¾é•œåƒã€ç‰ˆæœ¬)&gt;/nfs-client-provisioner:latest          volumeMounts:            - name: nfs-client-root              mountPath: /persistentvolumes          env:            - name: PROVISIONER_NAME              value: nfs-client-provisioner            - name: NFS_SERVER              value: &lt;NFS æœåŠ¡ç«¯ä¸»æœº IP&gt;            - name: NFS_PATH              value: &lt;NSF æœåŠ¡ç«¯å¯¼å‡ºç›®å½•&gt;      volumes:        - name: nfs-client-root          nfs:            server: &lt;NFS æœåŠ¡ç«¯ä¸»æœº IP&gt;            path: &lt;NSF æœåŠ¡ç«¯å¯¼å‡ºç›®å½•&gt;---apiVersion: storage.k8s.io/v1kind: StorageClassmetadata:  name: nfs-storageprovisioner: nfs-client-provisionerEOF</code></pre></section><section class="reference"></section><h4 id="éƒ¨ç½²-redis-é›†ç¾¤"><a class="header-anchor" href="#éƒ¨ç½²-redis-é›†ç¾¤"></a>éƒ¨ç½² Redis é›†ç¾¤</h4><section class="sample"><pre><code>cat &lt;&lt; EOF &gt; redis-cluster.yaml---apiVersion: v1kind: ConfigMapmetadata:  name: redis-clusterdata:  update-node.sh: |    #!/bin/sh    REDIS_NODES=&quot;/data/nodes.conf&quot;    sed -i -e &quot;/myself/ s/[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}/${POD_IP}/&quot; ${REDIS_NODES}    cp /conf/redis.conf /redis.conf    sed -i &quot;s/MY_IP/${POD_IP}/&quot; /redis.conf  # è§£å†³ istio ç½‘ç»œä¸‹ï¼ŒRedis é›†ç¾¤åˆå§‹åŒ–å¤±è´¥é—®é¢˜    exec &quot;$@&quot;  redis.conf: |+    cluster-enabled yes    cluster-require-full-coverage no    cluster-node-timeout 15000    cluster-config-file /data/nodes.conf    cluster-migration-barrier 1    appendonly yes    protected-mode no    cluster-announce-ip MY_IP  # è§£å†³ istio ç½‘ç»œä¸‹ï¼ŒRedis é›†ç¾¤åˆå§‹åŒ–å¤±è´¥é—®é¢˜#åˆ›å»ºstatefulsetæœåŠ¡---apiVersion: apps/v1kind: StatefulSetmetadata:  name: redis-clusterspec:  serviceName: redis-cluster  replicas: 6  selector:    matchLabels:      app: redis-cluster  template:    metadata:      labels:        app: redis-cluster    spec:      containers:      - name: redis        image: &lt;é•œåƒä»“åº“(ç½‘ç»œæ–¹ä¾¿å¯ä»¥è‡ªè¡Œåˆ° Docker HUB æ‰¾é•œåƒã€ç‰ˆæœ¬&gt;/redis:5.0.1-alpine        ports:        - containerPort: 6379          name: client        - containerPort: 16379          name: gossip        command: [&quot;/conf/update-node.sh&quot;, &quot;redis-server&quot;, &quot;/redis.conf&quot;]        env:        - name: POD_IP          valueFrom:            fieldRef:              fieldPath: status.podIP        volumeMounts:        - name: conf          mountPath: /conf          readOnly: false        - name: data          mountPath: /data          readOnly: false      volumes:      - name: conf        configMap:          name: redis-cluster          defaultMode: 0755  volumeClaimTemplates:  # pvcæ¨¡æ¿  - metadata:      name: data      annotations:        volume.beta.kubernetes.io/storage-class: nfs-storage  # æŒ‡å®šå­˜å‚¨ç±»ä¸ºnfs-storage    spec:      accessModes: [ &quot;ReadWriteOnce&quot; ]      resources:        requests:          storage: 1Gi  # æŒ‡å®šæŒä¹…å·å¤§å°---apiVersion: v1kind: Servicemetadata:  name: redis-clusterspec:  type: ClusterIP  ports:  - port: 6379    targetPort: 6379    name: client  - port: 16379    targetPort: 16379    name: gossip  selector:    app: redis-cluster</code></pre></section><section class="reference"></section><h4 id="åˆå§‹åŒ–é›†ç¾¤"><a class="header-anchor" href="#åˆå§‹åŒ–é›†ç¾¤"></a>åˆå§‹åŒ–é›†ç¾¤</h4><section class="reference"><p>$<code>kubectl exec -it redis-cluster-0 -- redis-cli --cluster create --cluster-replicas 1 $(kubectl get pods -l app=redis-cluster -o jsonpath='{range.items[*]}{.status.podIP}:6379 ')</code></p></section><h2 id="æµ‹è¯•"><a class="header-anchor" href="#æµ‹è¯•"></a>æµ‹è¯•</h2><section class="reference"><p>ä½¿ç”¨<code>redis-cli -c</code>æµ‹è¯•é›†ç¾¤å‘½ä»¤</p><p><strong><em>å‚è€ƒé“¾æ¥</em></strong><br><a href="https://rancher.com/blog/2019/deploying-redis-cluster/" target="_blank" rel="noopener">Deploying Redis Cluster on Top of Kubernetes</a><br><a href="https://stackoverflow.com/questions/58528831/is-it-possible-to-create-a-redis-cluster-within-kubernetes-using-a-istio-search" target="_blank" rel="noopener">Is it possible to create a Redis Cluster within Kubernetes using a Istio Search Mesh?</a></p></section>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a class=&quot;header-anchor&quot; href=&quot;#èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h2&gt;
&lt;section class=&quot;reference&quot;&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨ K8S é›†ç¾¤ä¸­æ­å»º Redis é›†ç¾¤&lt;/li&gt;
&lt;li&gt;K8S é›†ç¾¤ä½¿ç”¨ isti
      
    
    </summary>
    
    
      <category term="DevOps" scheme="http://www.lockey.xyz/categories/DevOps/"/>
    
    
      <category term="K8S" scheme="http://www.lockey.xyz/tags/K8S/"/>
    
      <category term="istio" scheme="http://www.lockey.xyz/tags/istio/"/>
    
      <category term="Redis" scheme="http://www.lockey.xyz/tags/Redis/"/>
    
      <category term="é›†ç¾¤" scheme="http://www.lockey.xyz/tags/%E9%9B%86%E7%BE%A4/"/>
    
  </entry>
  
  <entry>
    <title>Ubuntu18.04 NFS å®‰è£…ä½¿ç”¨</title>
    <link href="http://www.lockey.xyz/2020/03/25/Linux/Ubuntu18.04--NFS%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/"/>
    <id>http://www.lockey.xyz/2020/03/25/Linux/Ubuntu18.04--NFS%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/</id>
    <published>2020-03-25T06:12:31.000Z</published>
    <updated>2020-03-25T06:45:11.042Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç¯å¢ƒ"><a class="header-anchor" href="#ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><section class="reference"><ul><li>Ubuntu 18.04</li></ul></section><h2 id="å®‰è£…"><a class="header-anchor" href="#å®‰è£…"></a>å®‰è£…</h2><section class="reference"></section><h4 id="å®‰è£…è½¯ä»¶åŒ…"><a class="header-anchor" href="#å®‰è£…è½¯ä»¶åŒ…"></a>å®‰è£…è½¯ä»¶åŒ…</h4><section class="sample"><p>$<code>apt install nfs-kernel-server</code><br>å¦‚å‡ºç°ä¾èµ–é”™è¯¯ â†“</p><pre><code>...The following packages have unmet dependencies: nfs-kernel-server : Depends: libtirpc1 but it is not going to be installed                     Depends: nfs-common (= 1:1.2.8-6ubuntu1.2) but it is not going to be installedE: Unable to correct problems, you have held broken packages.</code></pre></section><section class="reference"></section><h5 id="é”™è¯¯è§£å†³åŠæ³•ï¼š"><a class="header-anchor" href="#é”™è¯¯è§£å†³åŠæ³•ï¼š"></a>é”™è¯¯è§£å†³åŠæ³•ï¼š</h5><section class="reference"><ol><li>apt å®‰è£…ä¾èµ–</li><li>ç¬¬ä¸€æ­¥å¦‚æœå‡ºç°æ›´å¤šä¾èµ–æŠ¥é”™çœ‹ç¬¬ 3 æ­¥</li><li>æ‰‹åŠ¨å®‰è£…<ol><li>ä¸‹è½½å®‰è£…åŒ…ï¼ˆ<a href="http://archive.ubuntu.com/ubuntu/pool/main/libt/libtirpc/libtirpc1_0.2.5-1.2ubuntu0.1_amd64.deb" target="_blank" rel="noopener">libtirpc1_0.2.5-1.2ubuntu0.1_amd64.deb</a>ï¼‰<a href="http://archive.ubuntu.com/ubuntu/pool/main/n/nfs-utils/nfs-kernel-server_1.3.4-2.1ubuntu5_amd64.deb" target="_blank" rel="noopener">nfs-kernel-server_1.3.4-2.1ubuntu5_amd64.deb</a><a href="http://archive.ubuntu.com/ubuntu/pool/main/n/nfs-utils/nfs-common_1.3.4-2.1ubuntu5_amd64.deb" target="_blank" rel="noopener">nfs-common_1.3.4-2.1ubuntu5_amd64.deb</a><a href="http://archive.ubuntu.com/ubuntu/pool/main/k/keyutils/keyutils_1.5.9-9.2ubuntu2_amd64.deb" target="_blank" rel="noopener">keyutils_1.5.9-9.2ubuntu2_amd64.deb</a></li><li>ä½¿ç”¨<code>dpkg -i</code>å®‰è£…ä¸‹è½½å¥½çš„ deb åŒ…ï¼›å¦‚å‡ºç°é”™è¯¯æç¤ºï¼Œå¯ä»¥æ ¹æ®æç¤ºä½¿ç”¨ apt æˆ–å†ä¸‹è½½å®‰è£…åŒ…å®‰è£…</li><li>å†æœ‰é—®é¢˜å¯ä»¥ä½¿ç”¨ journalctl ç­‰å·¥å…·æ’æŸ¥é—®é¢˜</li></ol></li></ol></section><h2 id="é…ç½®"><a class="header-anchor" href="#é…ç½®"></a>é…ç½®</h2><section class="reference"><ol><li>åˆ›å»ºå¯¼å‡ºç›®å½•ï¼ˆæœåŠ¡ç«¯ã€å®¢æˆ·ç«¯å…±äº«ç›®å½•ï¼‰$<code>mkdir -p /xxx/xxxxx</code></li><li>å¼€æ”¾æƒé™$<code>chown nobody:nogroup /xxx/xxxxx &amp;&amp; chmod 777 /xxx/xxxxx</code>(æƒé™å¼€æ”¾è‡ªå·±æ§åˆ¶ï¼Œå…¨å¼€æœ‰é£é™©ï¼Œéœ€è°¨æ…ä½¿ç”¨)</li><li>é…ç½®å¯¼å‡ºç›®å½•æƒé™$<code>vim /etc/exports</code>(å…·ä½“è§„åˆ™ exports é‡Œæœ‰ example)</li><li>é‡å¯ nfs-kernel-serverã€rpcbind æœåŠ¡</li></ol></section><h2 id="ä½¿ç”¨"><a class="header-anchor" href="#ä½¿ç”¨"></a>ä½¿ç”¨</h2><section class="reference"><div class="info"><p>å®¢æˆ·ç«¯ä¸»æœºéœ€è¦å®‰è£… nfs-common å®‰è£…æ–¹æ³•åŒä¸Š</p></div></section><h4 id="åœ¨å®¢æˆ·ç«¯ä¸»æœºåˆ›å»ºæŒ‚è½½ç›®å½•"><a class="header-anchor" href="#åœ¨å®¢æˆ·ç«¯ä¸»æœºåˆ›å»ºæŒ‚è½½ç›®å½•"></a>åœ¨å®¢æˆ·ç«¯ä¸»æœºåˆ›å»ºæŒ‚è½½ç›®å½•</h4><section class="reference"><p>$<code>mkdir -p /xxx/xxxxx</code></p></section><h4 id="æŒ‚è½½"><a class="header-anchor" href="#æŒ‚è½½"></a>æŒ‚è½½</h4><section class="reference"><p>$<code>mount -t nfs &lt;NFSæœåŠ¡ç«¯ä¸»æœºIP&gt;:&lt;NFSæœåŠ¡ç«¯ä¸»æœºå¯¼å‡ºç›®å½•&gt; &lt;å®¢æˆ·ç«¯ä¸»æœºæŒ‚è½½ç›®å½•&gt;</code></p></section><h2 id="æµ‹è¯•"><a class="header-anchor" href="#æµ‹è¯•"></a>æµ‹è¯•</h2><section class="reference"><ul><li>åœ¨å®¢æˆ·ç«¯æŒ‚è½½ç›®å½•ä¸­æ“ä½œï¼ˆåˆ›å»ºæ–‡ä»¶ã€æ–‡ä»¶å¤¹ç­‰ï¼‰ï¼Œèƒ½åœ¨æœåŠ¡ç«¯å¯¼å‡ºç›®å½•ä¸­åŒæ­¥</li><li>åœ¨æœåŠ¡ç«¯å¯¼å‡ºç›®å½•ä¸­æ“ä½œï¼ˆåˆ›å»ºæ–‡ä»¶ã€æ–‡ä»¶å¤¹ç­‰ï¼‰ï¼Œèƒ½åœ¨å®¢æˆ·ç«¯æŒ‚è½½ç›®å½•ä¸­åŒæ­¥</li></ul></section>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ç¯å¢ƒ&quot;&gt;&lt;a class=&quot;header-anchor&quot; href=&quot;#ç¯å¢ƒ&quot;&gt;&lt;/a&gt;ç¯å¢ƒ&lt;/h2&gt;
&lt;section class=&quot;reference&quot;&gt;
&lt;ul&gt;
&lt;li&gt;Ubuntu 18.04&lt;/li&gt;
&lt;/ul&gt;
&lt;/section&gt;
&lt;h2 id=&quot;
      
    
    </summary>
    
    
      <category term="Linux" scheme="http://www.lockey.xyz/categories/Linux/"/>
    
    
      <category term="NFS" scheme="http://www.lockey.xyz/tags/NFS/"/>
    
      <category term="nfs-kernel-server" scheme="http://www.lockey.xyz/tags/nfs-kernel-server/"/>
    
      <category term="Depends" scheme="http://www.lockey.xyz/tags/Depends/"/>
    
  </entry>
  
  <entry>
    <title>istio å®‰è£…ä½¿ç”¨</title>
    <link href="http://www.lockey.xyz/2020/03/16/DevOps/istio%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/"/>
    <id>http://www.lockey.xyz/2020/03/16/DevOps/istio%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/</id>
    <published>2020-03-16T08:06:48.000Z</published>
    <updated>2020-03-25T06:11:44.860Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ¦‚å¿µ"><a class="header-anchor" href="#æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><section class="reference"><p>Istio æ˜¯Googleã€IBM å’ŒLyft è”åˆå¼€æºçš„æœåŠ¡ç½‘æ ¼ï¼ˆService Meshï¼‰æ¡†æ¶ï¼Œæ—¨åœ¨è§£å†³å¤§é‡å¾®æœåŠ¡çš„å‘ç°ã€è¿æ¥ã€ç®¡ç†ã€ç›‘æ§ä»¥åŠå®‰å…¨ç­‰é—®é¢˜ã€‚ Istio å¯¹åº”ç”¨æ˜¯é€æ˜çš„ï¼Œä¸éœ€è¦æ”¹åŠ¨ä»»ä½•æœåŠ¡ä»£ç å°±å¯ä»¥å®ç°é€æ˜çš„æœåŠ¡æ²»ç†ã€‚</p></section><h2 id="å®˜æ–¹æ–‡æ¡£-ä¸­è‹±æ–‡å¯åˆ‡æ¢"><a class="header-anchor" href="#å®˜æ–¹æ–‡æ¡£-ä¸­è‹±æ–‡å¯åˆ‡æ¢"></a>å®˜æ–¹æ–‡æ¡£ï¼ˆä¸­è‹±æ–‡å¯åˆ‡æ¢ï¼‰</h2><section class="reference"><p><a href="https://istio.io/zh/docs/" target="_blank" rel="noopener">istio</a></p></section><h2 id="æ³¨æ„"><a class="header-anchor" href="#æ³¨æ„"></a>æ³¨æ„</h2><section class="reference"><div class="info"><p>å®˜æ–¹æ–‡æ¡£å®åœ¨å¤ªå…¨äº†ï¼Œæ²¡ä»€ä¹ˆå¥½æ•´ç†çš„</p></div><ol><li>ç¨å¾®é˜…è¯»æ–‡æ¡£é‡Œçš„â€œæ¦‚å¿µéƒ¨åˆ†â€</li><li>å®‰è£…istio<ol><li>æ¨èä½¿ç”¨ï¼šistioctlï¼›helm æ–¹å¼åœ¨æ–°ç‰ˆæœ¬å·²ç»å¼ƒç”¨</li><li>istio é»˜è®¤ä½¿ç”¨å›½å¤–é•œåƒä»“åº“ï¼Œå¯ä»¥è‡ªè¡Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆinstall &gt; kubenetesï¼‰</li></ol></li><li>å®‰è£…ç¤ºä¾‹èµ°ä¸€é</li><li>å®‰è£…ä»»åŠ¡èµ°ä¸€é</li><li><strong>istio æ¥ç®¡äº†ç½‘ç»œï¼Œä¼šå¯¹éƒ¨åˆ†ç¬¬ä¸‰æ–¹æœåŠ¡çš„ç½‘ç»œè®¿é—®é€ æˆå½±å“(å¦‚ï¼šRedis é›†ç¾¤çš„åˆå§‹åŒ–ç­‰)</strong></li></ol></section>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;æ¦‚å¿µ&quot;&gt;&lt;a class=&quot;header-anchor&quot; href=&quot;#æ¦‚å¿µ&quot;&gt;&lt;/a&gt;æ¦‚å¿µ&lt;/h2&gt;
&lt;section class=&quot;reference&quot;&gt;
&lt;p&gt;Istio æ˜¯Googleã€IBM å’ŒLyft è”åˆå¼€æºçš„æœåŠ¡ç½‘æ ¼ï¼ˆService Meshï¼‰æ¡†æ¶
      
    
    </summary>
    
    
      <category term="DevOps" scheme="http://www.lockey.xyz/categories/DevOps/"/>
    
    
      <category term="K8S" scheme="http://www.lockey.xyz/tags/K8S/"/>
    
      <category term="Kubernetes" scheme="http://www.lockey.xyz/tags/Kubernetes/"/>
    
      <category term="istio" scheme="http://www.lockey.xyz/tags/istio/"/>
    
      <category term="Server Mesh" scheme="http://www.lockey.xyz/tags/Server-Mesh/"/>
    
  </entry>
  
  <entry>
    <title>Docker å¼€æºä»“åº“ç³»ç»Ÿ Harbor æ­å»ºä¸ä½¿ç”¨</title>
    <link href="http://www.lockey.xyz/2020/03/12/DevOps/Docker%E5%BC%80%E6%BA%90%E4%BB%93%E5%BA%93%E7%B3%BB%E7%BB%9FHarbor%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8/"/>
    <id>http://www.lockey.xyz/2020/03/12/DevOps/Docker%E5%BC%80%E6%BA%90%E4%BB%93%E5%BA%93%E7%B3%BB%E7%BB%9FHarbor%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8/</id>
    <published>2020-03-12T10:21:45.000Z</published>
    <updated>2020-03-25T06:11:11.697Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a class="header-anchor" href="#ç®€ä»‹"></a>ç®€ä»‹</h2><section class="reference"><ul><li>å®˜æ–¹<ul><li><a href="https://goharbor.io/" target="_blank" rel="noopener">Harbor</a>æ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨é•œåƒç®¡ç†ç³»ç»Ÿï¼Œå®ƒé€šè¿‡åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶æ¥ä¿æŠ¤é•œåƒï¼Œæ‰«æé•œåƒä¸­çš„æ¼æ´ï¼Œå¹¶å°†å›¾åƒç­¾åä¸ºå¯ä¿¡çš„ã€‚ä½œä¸ºä¸€ä¸ªCNCFå­µåŒ–é¡¹ç›®ï¼ŒHarbor ä¸ºæ‚¨æä¾›äº†åˆè§„æ€§ã€æ€§èƒ½å’Œäº’æ“ä½œæ€§ï¼Œå¸®åŠ©æ‚¨è·¨äº‘åŸç”Ÿè®¡ç®—å¹³å°(å¦‚ Kubernetes å’Œ Docker )ä¸€è‡´è€Œå®‰å…¨åœ°ç®¡ç†é•œåƒã€‚</li></ul></li><li>éå®˜æ–¹<ul><li>å¼€æº</li><li>ä¼ä¸šçº§å®¹å™¨é•œåƒç®¡ç†ç³»ç»Ÿ</li><li>æˆç†Ÿ</li><li>ç”Ÿæ€å¥å…¨</li><li>ä½¿ç”¨çš„å¤§å‚ä¼—å¤š</li><li>æ­é…åœ¨é›†ç¾¤å†…éƒ¨ï¼ŒåŠ é€Ÿé›†ç¾¤åˆ›å»ºã€å‡çº§</li></ul></li></ul></section><h2 id="ç¯å¢ƒ"><a class="header-anchor" href="#ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><section class="reference"><p>æ“ä½œç³»ç»Ÿï¼šLinux(Ubuntu18.04)<br>å®¹å™¨ç®¡ç†ï¼šDocker + Docker-Compose</p></section><h2 id="å®‰è£…"><a class="header-anchor" href="#å®‰è£…"></a>å®‰è£…</h2><section class="reference"><ol><li><a href="https://github.com/goharbor/harbor/releases" target="_blank" rel="noopener">ä¸‹è½½å®‰è£…åŒ…</a></li><li>è§£å‹å¹¶è¿›å…¥å®‰è£…åŒ…</li><li>ä¿®æ”¹<code>harbor.yml</code>é…ç½®ï¼ˆhostnameã€harbor_admin_passwordç­‰ï¼‰</li><li>ä¿®æ”¹<code>docker-compose.yml</code>ï¼ˆå¦‚éœ€è¦ä¿®æ”¹é•œåƒæºç­‰ï¼Œæœ‰æ¡ä»¶å¯ä»¥ç•¥è¿‡ï¼‰</li><li>ä½¿ç”¨ docker-compose å¯åŠ¨ Harbor</li></ol></section><h2 id="ä½¿ç”¨"><a class="header-anchor" href="#ä½¿ç”¨"></a>ä½¿ç”¨</h2><section class="reference"><ul><li>å‘½ä»¤è¡Œæ“ä½œä¸ <a href="https://docs.docker.com/get-started/part3/" target="_blank" rel="noopener">DockerHUB</a> åŸºæœ¬ä¸€è‡´</li><li>æµè§ˆå™¨<ul><li>ä¿®æ”¹ /etc/hosts æ–‡ä»¶ï¼Œè®¾ç½®ç›®æ ‡ä¸»æœºIPå’Œ harbor.yml ä¸­è®¾ç½®çš„ hostname</li><li>ä½¿ç”¨é»˜è®¤ç”¨æˆ·å admin å’Œ harbor.yml ä¸­è®¾ç½®çš„å¯†ç ç™»å½•</li></ul></li></ul></section><h2 id="æ³¨æ„äº‹é¡¹"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><section class="sample"><ul><li>ä½¿ç”¨ç§æœ‰ä»“åº“æ—¶ï¼š<ul><li>é¦–å…ˆéœ€è¦åœ¨ Docker å®¢æˆ·æœºä¸Šç™»å½•ï¼ˆ$<code>docker login &lt;hostname&gt;</code>ï¼‰<ul><li>æ–°ç‰ˆæœ¬ä½¿ç”¨ httpsï¼Œå¦‚ç™»å½•ä¸ä¸Šï¼š<ul><li>ä¿®æ”¹ daemon.json å¢åŠ  insecure registriesï¼ˆè§ä¸‹é¢ç¤ºä¾‹ â†“ï¼‰</li><li>é‡å¯ docker æœåŠ¡</li></ul></li></ul></li></ul></li></ul><p><strong><em>Docker daemon.json å¢åŠ  insecure registries</em></strong></p><pre><code>vim /etc/docker/daemon.json---{  &quot;registry-mirrors&quot;: [&quot;https://xxx.mirror.aliyuncs.com&quot;],  &quot;insecure-registries&quot; : [&quot;&lt;harbor hostname&gt;&quot;]}---systemctl daemon-reloadsystemctl restart docker</code></pre></section>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ç®€ä»‹&quot;&gt;&lt;a class=&quot;header-anchor&quot; href=&quot;#ç®€ä»‹&quot;&gt;&lt;/a&gt;ç®€ä»‹&lt;/h2&gt;
&lt;section class=&quot;reference&quot;&gt;
&lt;ul&gt;
&lt;li&gt;å®˜æ–¹
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://goharbor.io/&quot; 
      
    
    </summary>
    
    
      <category term="DevOps" scheme="http://www.lockey.xyz/categories/DevOps/"/>
    
    
      <category term="Docker" scheme="http://www.lockey.xyz/tags/Docker/"/>
    
      <category term="Harbor" scheme="http://www.lockey.xyz/tags/Harbor/"/>
    
      <category term="å®¹å™¨" scheme="http://www.lockey.xyz/tags/%E5%AE%B9%E5%99%A8/"/>
    
      <category term="ä»“åº“" scheme="http://www.lockey.xyz/tags/%E4%BB%93%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>Ubuntu18.04 KVM å®‰è£…ä½¿ç”¨ï¼ˆGUIï¼‰</title>
    <link href="http://www.lockey.xyz/2020/03/12/Linux/Ubuntu18.04--KVM%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/"/>
    <id>http://www.lockey.xyz/2020/03/12/Linux/Ubuntu18.04--KVM%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/</id>
    <published>2020-03-12T06:22:05.000Z</published>
    <updated>2020-03-13T08:08:20.200Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‡†å¤‡"><a class="header-anchor" href="#å‡†å¤‡"></a>å‡†å¤‡</h2><section class="reference"></section><h5 id="æ£€æŸ¥ç¡¬ä»¶è™šæ‹ŸåŒ–æ”¯æŒ"><a class="header-anchor" href="#æ£€æŸ¥ç¡¬ä»¶è™šæ‹ŸåŒ–æ”¯æŒ"></a>æ£€æŸ¥ç¡¬ä»¶è™šæ‹ŸåŒ–æ”¯æŒ</h5><section class="reference"><p>$<code>egrep -c '(vmx|svm)' /proc/cpuinfo</code><br>è¾“å‡ºå¤§äº0å³å¯</p></section><h5 id="æ£€æŸ¥ç¡¬ä»¶åŠ é€Ÿ-kvm-æ”¯æŒ"><a class="header-anchor" href="#æ£€æŸ¥ç¡¬ä»¶åŠ é€Ÿ-kvm-æ”¯æŒ"></a>æ£€æŸ¥ç¡¬ä»¶åŠ é€Ÿ KVM æ”¯æŒ</h5><section class="reference"><p>$<code>apt install cpu-checker</code><br>$<code>kvm-ok</code><br>è¾“å‡ºï¼š<code>KVM acceleration can be used</code>å³å¯</p></section><h5 id="æ¡¥æ¥æ¨¡å¼-å¯é€‰"><a class="header-anchor" href="#æ¡¥æ¥æ¨¡å¼-å¯é€‰"></a>æ¡¥æ¥æ¨¡å¼(å¯é€‰)</h5><section class="reference"><p>è®¾ç½®å®¿ä¸»æœºæ¡¥æ¥ç½‘ç»œï¼ŒNetplan æ¨¡å¼ä¸‹çš„ NetworkManager ç®¡ç†æ–¹å¼ä½¿ç”¨ $<code>nm-connection-editor</code>è¿›è¡Œç®¡ç†</p></section><h2 id="å®‰è£…-kvm"><a class="header-anchor" href="#å®‰è£…-kvm"></a>å®‰è£… KVM</h2><section class="reference"><p>$<code>apt install -y qemu qemu-kvm libvirt-bin bridge-utils virt-manager</code></p></section><h5 id="å¯åŠ¨å’Œå¼€æœºå¯åŠ¨-libvirt-æœåŠ¡"><a class="header-anchor" href="#å¯åŠ¨å’Œå¼€æœºå¯åŠ¨-libvirt-æœåŠ¡"></a>å¯åŠ¨å’Œå¼€æœºå¯åŠ¨ libvirt æœåŠ¡</h5><section class="reference"><p>$<code>systemctl start libvirtd</code><br>$<code>systemctl enable libvirtd</code></p></section><h2 id="ä½¿ç”¨-kvm"><a class="header-anchor" href="#ä½¿ç”¨-kvm"></a>ä½¿ç”¨ KVM</h2><section class="reference"><p>å¯ä»¥ä½¿ç”¨ $<code>virt-manager</code> GUI ç•Œé¢ç®¡ç†<br>å®‰è£…å®Œç³»ç»Ÿï¼Œè®¾ç½®è®¾ç½®è™šæ‹Ÿæœº NIC ä¿¡æ¯ï¼ˆåœ¨è™šæ‹Ÿæœºä¿¡æ¯é¢æ¿ï¼‰ä¸ºï¼šæŒ‡å®šå…±äº«è®¾å¤‡ï¼Œè¾“å…¥å®¿ä¸»æœºæ¡¥æ¥ç½‘ç»œå(å¦‚ï¼šbr0)ï¼Œé€‰æ‹© virtio å³å¯</p><div class="warning"><p>åšä¸»æ¡¥æ¥ç½‘ç»œè®¾ç½®é™æ€ IP æ²¡æˆåŠŸï¼Œå®åœ¨ä¸è¡Œå¯ä»¥ä½¿ç”¨ DHCP è‡ªåŠ¨åˆ†å‘ï¼</p></div></section><h5 id="kvm-å¸¸ç”¨å‘½ä»¤"><a class="header-anchor" href="#kvm-å¸¸ç”¨å‘½ä»¤"></a>KVM å¸¸ç”¨å‘½ä»¤</h5><section class="reference"><p>å‘½ä»¤ | åŠŸèƒ½ | å¤‡æ³¨<br>â€”:---:â€”<br>virsh list | æŸ¥çœ‹è¿è¡Œè™šæ‹Ÿæœº | æŸ¥çœ‹æ‰€æœ‰å¯ä»¥åŠ <code>--all</code>å‚æ•°</p></section><h3 id="æœªå®Œ-å¾…ç»­"><a class="header-anchor" href="#æœªå®Œ-å¾…ç»­"></a>æœªå®Œâ€¦å¾…ç»­â€¦</h3><section class="reference"></section>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‡†å¤‡&quot;&gt;&lt;a class=&quot;header-anchor&quot; href=&quot;#å‡†å¤‡&quot;&gt;&lt;/a&gt;å‡†å¤‡&lt;/h2&gt;
&lt;section class=&quot;reference&quot;&gt;&lt;/section&gt;
&lt;h5 id=&quot;æ£€æŸ¥ç¡¬ä»¶è™šæ‹ŸåŒ–æ”¯æŒ&quot;&gt;&lt;a class=&quot;header-anchor
      
    
    </summary>
    
    
      <category term="Linux" scheme="http://www.lockey.xyz/categories/Linux/"/>
    
    
      <category term="KVM" scheme="http://www.lockey.xyz/tags/KVM/"/>
    
      <category term="Ubuntu18.04" scheme="http://www.lockey.xyz/tags/Ubuntu18-04/"/>
    
  </entry>
  
  <entry>
    <title>Linux åŸºç¡€éšç¬”</title>
    <link href="http://www.lockey.xyz/2020/03/12/Linux/Linux%E5%9F%BA%E7%A1%80%E9%9A%8F%E7%AC%94/"/>
    <id>http://www.lockey.xyz/2020/03/12/Linux/Linux%E5%9F%BA%E7%A1%80%E9%9A%8F%E7%AC%94/</id>
    <published>2020-03-12T02:58:56.000Z</published>
    <updated>2020-03-18T04:30:13.287Z</updated>
    
    <content type="html"><![CDATA[<h2 id="linux-ä¸-å‘è¡Œç‰ˆ"><a class="header-anchor" href="#linux-ä¸-å‘è¡Œç‰ˆ"></a>Linux ä¸ å‘è¡Œç‰ˆ</h2><section class="reference"></section><h2 id="å‘è¡Œç‰ˆ"><a class="header-anchor" href="#å‘è¡Œç‰ˆ"></a>å‘è¡Œç‰ˆ</h2><section class="reference"></section><h3 id="ubuntu"><a class="header-anchor" href="#ubuntu"></a>Ubuntu</h3><section class="reference"></section><h4 id="é•œåƒç‰ˆæœ¬ä¸åç¼€"><a class="header-anchor" href="#é•œåƒç‰ˆæœ¬ä¸åç¼€"></a>é•œåƒç‰ˆæœ¬ä¸åç¼€</h4><section class="reference"></section><h5 id="ç‰ˆæœ¬"><a class="header-anchor" href="#ç‰ˆæœ¬"></a>ç‰ˆæœ¬</h5><section class="reference"><p>ç‰ˆæœ¬é—´å…·ä½“åŒºåˆ«è§å®˜ç½‘</p><ul><li>æ›´æ–°é—´éš”é€šå¸¸ä¸º6ä¸ªæœˆ</li><li>æŠ€æœ¯æ”¯æŒè‡³å°‘æä¾›18ä¸ªæœˆï¼›LTSï¼ˆLong Time Supportï¼‰Desktopç‰ˆæœ¬è‡³å°‘3å¹´ï¼ŒServerç‰ˆæœ¬è‡³å°‘5å¹´</li><li>ç‰ˆæœ¬å·é€šå¸¸ä¸º  xx.10</li></ul></section><h5 id="desktop"><a class="header-anchor" href="#desktop"></a>Desktop</h5><section class="reference"><p>æ¡Œé¢ç‰ˆï¼šé€šå¸¸æŒ‡å¸¦æ“ä½œç•Œé¢çš„ç‰ˆæœ¬ï¼ˆç±»ä¼¼ Win ç³»ç»Ÿå’Œ Mac ç³»ç»Ÿï¼‰</p></section><h5 id="live-server"><a class="header-anchor" href="#live-server"></a>Live-Server</h5><section class="reference"><p>æœåŠ¡å™¨ç‰ˆï¼šé€šå¸¸ä¸åŒ…å«ç•Œé¢ï¼Œæ“ä½œé å‘½ä»¤ç»ˆç«¯ï¼Œå®‰è£…æ—¶å¯ä»¥é€‰æ‹©æ€§å®‰è£…é¢å¤–æ’ä»¶æˆ–æœ€å°åŒ–å®‰è£…ã€‚å¤§éƒ¨åˆ†æœåŠ¡å™¨ä¼šé€‰æ‹©è¿™ç§ç±»å‹çš„é•œåƒã€‚</p></section>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;linux-ä¸-å‘è¡Œç‰ˆ&quot;&gt;&lt;a class=&quot;header-anchor&quot; href=&quot;#linux-ä¸-å‘è¡Œç‰ˆ&quot;&gt;&lt;/a&gt;Linux ä¸ å‘è¡Œç‰ˆ&lt;/h2&gt;
&lt;section class=&quot;reference&quot;&gt;&lt;/section&gt;
&lt;h2 id=&quot;å‘è¡Œç‰ˆ&quot;&gt;&lt;a
      
    
    </summary>
    
    
      <category term="Linux" scheme="http://www.lockey.xyz/categories/Linux/"/>
    
    
      <category term="Linux" scheme="http://www.lockey.xyz/tags/Linux/"/>
    
      <category term="åŸºç¡€" scheme="http://www.lockey.xyz/tags/%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>é«˜å¯ç”¨K8Sæ­å»ºï¼ˆUbuntu18.04ï¼‰</title>
    <link href="http://www.lockey.xyz/2020/03/11/DevOps/%E9%AB%98%E5%8F%AF%E7%94%A8K8S%E6%90%AD%E5%BB%BA/"/>
    <id>http://www.lockey.xyz/2020/03/11/DevOps/%E9%AB%98%E5%8F%AF%E7%94%A8K8S%E6%90%AD%E5%BB%BA/</id>
    <published>2020-03-11T02:53:25.000Z</published>
    <updated>2020-03-18T03:44:35.704Z</updated>
    
    <content type="html"><![CDATA[<div class="warning"><p>æœ¬æ–‡èµ„æ–™æ•´ç†è‡ªç½‘ç»œï¼Œå¯¹å…¶ä¸­è¿‡æ—¶éƒ¨åˆ†è¿›è¡Œä¿®æ­£ï¼<br>è¿è¡Œç¯å¢ƒä¸ºï¼šKVM è™šæ‹Ÿæœºï¼ˆå…ˆæ ¹æ®ä¸‹æ–‡ç¬¬ä¸€éƒ¨åˆ†åˆ¶ä½œåŸºç¡€é•œåƒï¼Œå†ç”¨åŸºç¡€é•œåƒå…‹éš†ä¸ºå„ä¸ª masterã€worker èŠ‚ç‚¹ï¼Œå¯ä»¥èŠ‚çœæ—¶é—´ï¼‰<br>é€‚ç”¨ç‰ˆæœ¬ä¸ºï¼š<br>æ“ä½œç³»ç»Ÿï¼šUbuntu18.04<br>Kubeadmï¼šGitVersion:&quot;v1.17.3&quot;<br>K8Sç»„ä»¶ç‰ˆæœ¬å¦‚ä¸‹ï¼š<br>kube-apiserver:v1.17.4<br>kube-controller-manager:v1.17.4<br>kube-scheduler:v1.17.4<br>kube-proxy:v1.17.4<br>pause:3.1<br>etcd:3.4.3-0<br>coredns:1.6.5</p></div><h2 id="ç¬¬ä¸€éƒ¨åˆ†-åŸºç¡€é•œåƒå‡†å¤‡"><a class="header-anchor" href="#ç¬¬ä¸€éƒ¨åˆ†-åŸºç¡€é•œåƒå‡†å¤‡"></a>ç¬¬ä¸€éƒ¨åˆ†----åŸºç¡€é•œåƒå‡†å¤‡</h2><section class="reference"></section><h4 id="harbor-å®‰è£…"><a class="header-anchor" href="#harbor-å®‰è£…"></a>Harbor å®‰è£…</h4><section class="reference"><p>è¯¦è§</p></section><h4 id="ç¡®ä¿èŠ‚ç‚¹ä¹‹ä¸­ä¸å¯ä»¥æœ‰é‡å¤çš„ä¸»æœºå-mac-åœ°å€æˆ–-product-uuid"><a class="header-anchor" href="#ç¡®ä¿èŠ‚ç‚¹ä¹‹ä¸­ä¸å¯ä»¥æœ‰é‡å¤çš„ä¸»æœºå-mac-åœ°å€æˆ–-product-uuid"></a>ç¡®ä¿èŠ‚ç‚¹ä¹‹ä¸­ä¸å¯ä»¥æœ‰é‡å¤çš„ä¸»æœºåã€MAC åœ°å€æˆ– product_uuid</h4><section class="reference"></section><h5 id="hostname-ä¿®æ”¹"><a class="header-anchor" href="#hostname-ä¿®æ”¹"></a>hostname ä¿®æ”¹</h5><section class="reference"><ul><li>Ubuntuï¼š<code>hostnamectl set-hostname xxx</code></li></ul></section><h5 id="æŸ¥çœ‹-product-uuid"><a class="header-anchor" href="#æŸ¥çœ‹-product-uuid"></a>æŸ¥çœ‹ product_uuid</h5><section class="reference"><p><code>sudo cat /sys/class/dmi/id/product_uuid</code></p></section><h4 id="å…³é—­é˜²ç«å¢™-ç”Ÿäº§ç¯å¢ƒä¸å»ºè®®å…³é—­"><a class="header-anchor" href="#å…³é—­é˜²ç«å¢™-ç”Ÿäº§ç¯å¢ƒä¸å»ºè®®å…³é—­"></a>å…³é—­é˜²ç«å¢™ï¼ˆç”Ÿäº§ç¯å¢ƒä¸å»ºè®®å…³é—­ï¼‰</h4><section class="sample"><pre><code>systemctl stop ufwsystemctl disable ufw</code></pre></section><section class="reference"><div class="warning"><p>ç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®å¯ç”¨é˜²ç«å¢™ï¼Œå¹¶å¼€å¯ etcdã€apiserverç­‰å¤šä¸ªç«¯å£</p></div></section><h4 id="å…³é—­-swap"><a class="header-anchor" href="#å…³é—­-swap"></a>å…³é—­ swap</h4><section class="reference"><p>æŸ¥çœ‹ swapï¼š$<code>cat /proc/swaps</code><br>æ³¨é‡Š swap è®¾ç½®ï¼š$<code>vim /etc/fstab</code><br>å…³é—­ swapï¼š$<code>swapoff -a</code></p></section><h4 id="ç¦ç”¨-grub-ipv6"><a class="header-anchor" href="#ç¦ç”¨-grub-ipv6"></a>ç¦ç”¨ GRUB ipv6</h4><section class="sample"><p>ç¼–è¾‘ï¼š$<code>vim /etc/default/grub</code><br>ä¿®æ”¹ï¼š</p><pre><code>GRUB_CMDLINE_LINUX_DEFAULT=&quot;&quot;GRUB_CMDLINE_LINUX=&quot;&quot;</code></pre></section><section class="reference"><p>â†“</p><pre><code>GRUB_CMDLINE_LINUX_DEFAULT=&quot;ipv6.disable=1&quot;GRUB_CMDLINE_LINUX=&quot;ipv6.disable=1&quot;</code></pre><p>æ›´æ–°ï¼š$<code>update-grub</code></p></section><h4 id="è®¾ç½®å¯¹åº”æ—¶åŒº-å¦‚ä¸Šæµ·"><a class="header-anchor" href="#è®¾ç½®å¯¹åº”æ—¶åŒº-å¦‚ä¸Šæµ·"></a>è®¾ç½®å¯¹åº”æ—¶åŒºï¼ˆå¦‚ä¸Šæµ·ï¼‰</h4><section class="reference"><p>æ‰§è¡Œï¼š$<code>ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</code></p></section><h4 id="è®¾ç½®-dns"><a class="header-anchor" href="#è®¾ç½®-dns"></a>è®¾ç½® DNS</h4><section class="sample"><p>ç¼–è¾‘ï¼š$<code>vim /etc/systemd/resolved.conf</code><br>ä¿®æ”¹ï¼š</p><pre><code># åœ°å€æ¥è‡ªé˜¿é‡Œ DNSDNS=223.5.5.5 223.6.6.6 </code></pre></section><section class="reference"></section><h4 id="å‡çº§æ“ä½œç³»ç»Ÿå†…æ ¸"><a class="header-anchor" href="#å‡çº§æ“ä½œç³»ç»Ÿå†…æ ¸"></a>å‡çº§æ“ä½œç³»ç»Ÿå†…æ ¸</h4><section class="reference"><p>å‚è€ƒè‡ª<a href="https://qingmu.io/2019/05/17/Deploy-a-highly-available-cluster-with-kubeadm/#%E5%8D%87%E7%BA%A7%E5%86%85%E6%A0%B8" target="_blank" rel="noopener">é’æœ¨ã®Javaå°å±‹</a></p><p>æŸ¥çœ‹æœ¬æœºå†…æ ¸ï¼š$<code>uname -a</code></p><div class="info"><p>å¯ä»¥æ ¹æ®å®é™…æƒ…å†µ<a href="https://kernel.ubuntu.com/~kernel-ppa/mainline/" target="_blank" rel="noopener">é€‰æ‹©ç‰ˆæœ¬</a></p></div><p>æ‰§è¡Œï¼š$<code>dpkg -i xxx.deb</code>å‡çº§å†…æ ¸ï¼ˆå¯ä½¿ç”¨é€šé…ç¬¦ï¼‰</p><p>æ¸…ç†æ—§å†…æ ¸ï¼š$<code>dpkg --list | grep linux | awk '{print $2}' | grep æ—§å†…æ ¸ç‰ˆæœ¬ | xargs apt purge -y</code></p><div class="warning"><p>å†…æ ¸æ“ä½œé£é™©è¾ƒå¤§ï¼Œè¯·ä¸€æ­¥æ­¥ç¡®è®¤æ²¡é—®é¢˜å†æ‰§è¡Œï¼</p></div></section><h4 id="å¯ç”¨-ipvs-å†…æ ¸æ¨¡å—"><a class="header-anchor" href="#å¯ç”¨-ipvs-å†…æ ¸æ¨¡å—"></a>å¯ç”¨ IPVS å†…æ ¸æ¨¡å—</h4><section class="sample"><p>æ‰§è¡Œï¼š</p><pre><code>echo &gt; /etc/modules-load.d/ipvs.confmodule=(ip_vs        ip_vs_rr        ip_vs_wrr        ip_vs_sh        ip_vs_lc        br_netfilter        nf_conntrack)for kernel_module in ${module[@]};do    /sbin/modinfo -F filename $kernel_module |&amp; grep -qv ERROR &amp;&amp; echo $kernel_module &gt;&gt; /etc/modules-load.d/ipvs.conf || :done</code></pre></section><section class="reference"><p>æŸ¥çœ‹ï¼š$<code>lsmod | grep ip_vs</code><br>è¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ä¸ºæˆåŠŸ â†“</p><pre><code>ip_vs_sh               16384  0ip_vs_wrr              16384  0ip_vs_rr               16384  0ip_vs                 147456  6 ip_vs_rr,ip_vs_sh,ip_vs_wrrnf_conntrack          143360  6 xt_conntrack,nf_nat,ipt_MASQUERADE,nf_nat_ipv4,nf_conntrack_netlink,ip_vslibcrc32c              16384  5 nf_conntrack,nf_nat,btrfs,raid456,ip_vs</code></pre></section><h4 id="å†…æ ¸å‚æ•°è°ƒæ•´"><a class="header-anchor" href="#å†…æ ¸å‚æ•°è°ƒæ•´"></a>å†…æ ¸å‚æ•°è°ƒæ•´</h4><section class="sample"><pre><code>cat &gt; /etc/sysctl.conf &lt;&lt; EOF# https://github.com/moby/moby/issues/31208 # ipvsadm -l --timout# ä¿®å¤ipvsæ¨¡å¼ä¸‹é•¿è¿æ¥timeouté—®é¢˜ å°äº900å³å¯net.ipv4.tcp_keepalive_time = 800net.ipv4.tcp_keepalive_intvl = 30net.ipv4.tcp_keepalive_probes = 10net.ipv6.conf.all.disable_ipv6 = 1net.ipv6.conf.default.disable_ipv6 = 1net.ipv6.conf.lo.disable_ipv6 = 1net.ipv4.neigh.default.gc_stale_time = 120net.ipv4.conf.all.rp_filter = 0net.ipv4.conf.default.rp_filter = 0net.ipv4.conf.default.arp_announce = 2net.ipv4.conf.lo.arp_announce = 2net.ipv4.conf.all.arp_announce = 2net.ipv4.ip_forward = 1net.ipv4.tcp_max_tw_buckets = 5000net.ipv4.tcp_syncookies = 1net.ipv4.tcp_max_syn_backlog = 1024net.ipv4.tcp_synack_retries = 2net.bridge.bridge-nf-call-ip6tables = 1net.bridge.bridge-nf-call-iptables = 1fs.inotify.max_user_watches=89100fs.file-max=52706963fs.nr_open=52706963net.bridge.bridge-nf-call-arptables = 1vm.swappiness = 0vm.max_map_count=262144EOF</code></pre></section><section class="reference"></section><h4 id="ç¡®ä¿-iptables-å·¥å…·ä¸ä½¿ç”¨-nftables-åç«¯"><a class="header-anchor" href="#ç¡®ä¿-iptables-å·¥å…·ä¸ä½¿ç”¨-nftables-åç«¯"></a>ç¡®ä¿ iptables å·¥å…·ä¸ä½¿ç”¨ nftables åç«¯</h4><section class="reference"></section><h5 id="åˆ‡æ¢æ—§ç‰ˆ-ubuntu"><a class="header-anchor" href="#åˆ‡æ¢æ—§ç‰ˆ-ubuntu"></a>åˆ‡æ¢æ—§ç‰ˆï¼ˆUbuntuï¼‰</h5><section class="sample"><pre><code>update-alternatives --set iptables /usr/sbin/iptables-legacyupdate-alternatives --set ip6tables /usr/sbin/ip6tables-legacyupdate-alternatives --set arptables /usr/sbin/arptables-legacyupdate-alternatives --set ebtables /usr/sbin/ebtables-legacy</code></pre></section><section class="reference"></section><h4 id="docker-ce-å®‰è£…"><a class="header-anchor" href="#docker-ce-å®‰è£…"></a>docker-ce å®‰è£…</h4><section class="reference"><p>å®‰è£…ä¾èµ–ç³»ç»Ÿå·¥å…·ï¼š$<code>apt install -y apt-transport-https ca-certificates curl software-properties-common</code><br>å®‰è£…GPGè¯ä¹¦ï¼š$<code>curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</code><br>å†™å…¥æºï¼š$<code>add-apt-repository &quot;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable&quot;</code><br>æ‰§è¡Œï¼š$<code>apt update</code><br>å®‰è£… docker-ceï¼š$<code>apt install -y docker-ce</code>ï¼ˆå¦å¯æŒ‡å®šç‰ˆæœ¬å·å®‰è£…æŒ‡å®šç‰ˆæœ¬ï¼‰<br>è®¾ç½®é•œåƒåŠ é€Ÿï¼Œå¯ä»¥é€‰æ‹©é˜¿é‡Œäº‘é•œåƒåŠ é€ŸæœåŠ¡ï¼Œè¯¦è§é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿé¡µé¢æ–‡æ¡£</p></section><h4 id="docker-compose-å®‰è£…"><a class="header-anchor" href="#docker-compose-å®‰è£…"></a>docker-compose å®‰è£…</h4><section class="sample"><p>æ‰§è¡Œï¼š</p><pre><code>curl -L https://github.com/docker/compose/releases/download/1.25.4/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-composechmod +x /usr/local/bin/docker-compose</code></pre></section><section class="reference"></section><h4 id="kubeadm-å¥—ä»¶å®‰è£…-å›½å†…"><a class="header-anchor" href="#kubeadm-å¥—ä»¶å®‰è£…-å›½å†…"></a>Kubeadm å¥—ä»¶å®‰è£…ï¼ˆå›½å†…ï¼‰</h4><section class="reference"><p>æ–°å¢æºæ–‡ä»¶ï¼š$<code>vim /etc/apt/sources.list.d/kubernetes.list</code><br>å†™å…¥æºï¼š$<code>deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main</code><br>æ‰§è¡Œï¼š$<code>apt update</code> å¾—åˆ°é”™è¯¯ä¿¡æ¯çš„ key çš„æœ«å°¾8ä½<br>æ‰§è¡Œï¼š$<code>gpg --keyserver keyserver.ubuntu.com --recv-keys ã€8ä½keyã€‘</code><br>æ‰§è¡Œï¼š$<code>gpg --export --armor ã€8ä½keyã€‘ | sudo apt-key add -</code><br>å†æ¬¡æ‰§è¡Œï¼š$<code>apt update</code><br>å®‰è£… Kubeadm å¥—ä»¶ï¼š$<code>apt install -y kubelet kubeadm kubectl</code></p></section><h2 id="ç¬¬äºŒéƒ¨åˆ†-é«˜å¯ç”¨é›†ç¾¤æ­å»º"><a class="header-anchor" href="#ç¬¬äºŒéƒ¨åˆ†-é«˜å¯ç”¨é›†ç¾¤æ­å»º"></a>ç¬¬äºŒéƒ¨åˆ†----é«˜å¯ç”¨é›†ç¾¤æ­å»º</h2><section class="reference"><div class="info"><p>æœ¬æ–‡é«˜å¯ç”¨æ¨¡å¼ä¸ºï¼šETCD é«˜å¯ç”¨ + API-Server é«˜å¯ç”¨<br>ETCDï¼šç”±äº ETCD ä½¿ç”¨ Raft ç®—æ³•ï¼Œæ‰€ä»¥èŠ‚ç‚¹ä¸€èˆ¬ä¸ºå¥‡æ•°ä¸ªï¼Œæœ¬æ–‡ä½¿ç”¨3ä¸ªèŠ‚ç‚¹<br>API-Serverï¼šæœ¬æ–‡ä½¿ç”¨3ä¸ªèŠ‚ç‚¹</p></div></section><h4 id="nginx-æœ¬åœ°ä»£ç†"><a class="header-anchor" href="#nginx-æœ¬åœ°ä»£ç†"></a>Nginx æœ¬åœ°ä»£ç†</h4><section class="reference"><p>ç”¨äºè®¿é—® master èŠ‚ç‚¹ï¼Œå¹¶åœ¨å…¶ä¸­æŸäº› master èŠ‚ç‚¹ä¸å¯ç”¨æ—¶ï¼Œè‡ªåŠ¨è®¿é—®å¯ç”¨èŠ‚ç‚¹ã€‚<br>å¯ä»¥éƒ¨ç½²åœ¨æ¯ä¸€å° K8S èŠ‚ç‚¹ä¸Šéƒ¨ç½²ï¼Œä¹Ÿå¯å¦å¤–éƒ¨ç½²å¤–éƒ¨ Nginx è´Ÿè½½å‡è¡¡èŠ‚ç‚¹ï¼Œæœ¬æ–‡åœ¨æ¯å° K8S èŠ‚ç‚¹ä¸Šå‡æœ‰éƒ¨ç½²</p></section><h5 id="é…ç½®-master-èŠ‚ç‚¹-hosts"><a class="header-anchor" href="#é…ç½®-master-èŠ‚ç‚¹-hosts"></a>é…ç½® master èŠ‚ç‚¹ hosts</h5><section class="sample"><pre><code>cat &gt;&gt; /etc/hosts &lt;&lt; EOF127.0.0.1 server.k8s.local10.0.0.65 server1.k8s.local10.0.0.66 server2.k8s.local10.0.0.67 server3.k8s.localEOF</code></pre></section><section class="reference"><div class="warning"><p>IP è¯·è·Ÿè¯·æ ¹æ®å®é™…æƒ…å†µæ›¿æ¢</p></div></section><h5 id="ç¼–å†™-nginx-é…ç½®æ–‡ä»¶"><a class="header-anchor" href="#ç¼–å†™-nginx-é…ç½®æ–‡ä»¶"></a>ç¼–å†™ Nginx é…ç½®æ–‡ä»¶</h5><section class="sample"><pre><code>mkdir -p /etc/nginxcat &gt; /etc/nginx/nginx.conf &lt;&lt; EOFworker_processes auto;user root;events {    worker_connections  20240;    use epoll;}error_log /var/log/nginx_error.log info;stream {    upstream kube-servers {        hash $remote_addr consistent;        server server1.k8s.local:6443 weight=5 max_fails=1 fail_timeout=3s;        server server2.k8s.local:6443 weight=5 max_fails=1 fail_timeout=3s;        server server3.k8s.local:6443 weight=5 max_fails=1 fail_timeout=3s;    }    server {        listen 8443 reuseport;        proxy_connect_timeout 3s;        # åŠ å¤§timeout        proxy_timeout 3000s;        proxy_pass kube-servers;    }}EOF</code></pre></section><section class="reference"></section><h5 id="å¯åŠ¨-nginx"><a class="header-anchor" href="#å¯åŠ¨-nginx"></a>å¯åŠ¨ Nginx</h5><section class="sample"><pre><code>docker run --restart=always \-v /etc/apt/sources.list:/etc/apt/sources.list \-v /etc/nginx/nginx.conf:/etc/nginx/nginx.conf \--name kps \--net host \-it \-d \nginx</code></pre></section><section class="reference"></section><h4 id="é«˜å¯ç”¨å¤–éƒ¨-etcd-é›†ç¾¤æ­å»º"><a class="header-anchor" href="#é«˜å¯ç”¨å¤–éƒ¨-etcd-é›†ç¾¤æ­å»º"></a>é«˜å¯ç”¨å¤–éƒ¨ ETCD é›†ç¾¤æ­å»º</h4><section class="sample"><div class="info"><p>ç”±äº etcd ä¸éœ€è¦å¯¹å¤–å¼€æ”¾ï¼Œæ‰€ä»¥æœ¬æ–‡ä¸ä½¿ç”¨ tls</p></div><div class="warning"><p>å¯åŠ¨å‚æ•°<a href="https://qingmu.io/2019/05/17/Deploy-a-highly-available-cluster-with-kubeadm/#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" target="_blank" rel="noopener">æ³¨æ„äº‹é¡¹</a>ï¼š<br>â€“auto-compaction-retention<br>ç”±äºETCDæ•°æ®å­˜å‚¨å¤šç‰ˆæœ¬æ•°æ®ï¼Œéšç€å†™å…¥çš„ä¸»é”®å¢åŠ å†å²ç‰ˆæœ¬éœ€è¦å®šæ—¶æ¸…ç†ï¼Œé»˜è®¤çš„å†å²æ•°æ®æ˜¯ä¸ä¼šæ¸…ç†çš„ï¼Œæ•°æ®è¾¾åˆ°2Gå°±ä¸èƒ½å†™å…¥ï¼Œå¿…é¡»è¦æ¸…ç†å‹ç¼©å†å²æ•°æ®æ‰èƒ½ç»§ç»­å†™å…¥;æ‰€ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼Œåœ¨ä¸Šç”Ÿäº§ç¯å¢ƒä¹‹å‰å°±æå‰ç¡®å®šï¼Œå†å²æ•°æ®å¤šé•¿æ—¶é—´å‹ç¼©ä¸€æ¬¡;æ¨èä¸€å°æ—¶å‹ç¼©ä¸€æ¬¡æ•°æ®è¿™æ ·å¯ä»¥æå¤§çš„ä¿è¯é›†ç¾¤ç¨³å®šï¼Œå‡å°‘å†…å­˜å’Œç£ç›˜å ç”¨</p><p>â€“max-request-bytes<br>etcd Raftæ¶ˆæ¯æœ€å¤§å­—èŠ‚æ•°ï¼ŒETCDé»˜è®¤è¯¥å€¼ä¸º1.5M; ä½†æ˜¯å¾ˆå¤šä¸šåŠ¡åœºæ™¯å‘ç°åŒæ­¥æ•°æ®çš„æ—¶å€™1.5Må®Œå…¨æ²¡æ³•æ»¡è¶³è¦æ±‚ï¼Œæ‰€ä»¥æå‰ç¡®å®šåˆå§‹å€¼å¾ˆé‡è¦;ç”±äº1.5Må¯¼è‡´æˆ‘ä»¬çº¿ä¸Šçš„ä¸šåŠ¡æ— æ³•å†™å…¥å…ƒæ•°æ®çš„é—®é¢˜ï¼Œæˆ‘ä»¬ç´§æ€¥å‡çº§ä¹‹åæŠŠè¯¥å€¼ä¿®æ”¹ä¸ºé»˜è®¤32Mï¼Œä½†æ˜¯å®˜æ–¹æ¨èçš„æ˜¯10Mï¼Œå¤§å®¶å¯ä»¥æ ¹æ®ä¸šåŠ¡æƒ…å†µè‡ªå·±è°ƒæ•´</p><p>â€“quota-backend-bytes<br>ETCD dbæ•°æ®å¤§å°ï¼Œé»˜è®¤æ˜¯2Gï¼Œå½“æ•°æ®è¾¾åˆ°2Gçš„æ—¶å€™å°±ä¸å…è®¸å†™å…¥ï¼Œå¿…é¡»å¯¹å†å²æ•°æ®è¿›è¡Œå‹ç¼©æ‰èƒ½ç»§ç»­å†™å…¥;å‚åŠ 1é‡Œé¢è¯´çš„ï¼Œæˆ‘ä»¬å¯åŠ¨çš„æ—¶å€™å°±åº”è¯¥æå‰ç¡®å®šå¤§å°ï¼Œå®˜æ–¹æ¨èæ˜¯8Gï¼Œè¿™é‡Œæˆ‘ä»¬ä¹Ÿä½¿ç”¨8Gçš„é…ç½®</p></div><p>åœ¨ etcd é›†ç¾¤ä¸ªèŠ‚ç‚¹ä¸»æœºä¸Šè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ˆæ³¨æ„ä¿®æ”¹ä¸­æ‹¬å·å†…å¯¹åº”çš„ä¿¡æ¯ï¼‰ï¼š</p><pre><code>mkdir -p /var/etcddocker rm [name] -frm -rf /var/etcd/*docker run --restart=always --net host -it --name [name] -d \-v /var/etcd:/var/etcd \-v /etc/localtime:/etc/localtime \[ä»“åº“å]/etcd:[ç‰ˆæœ¬å·] \etcd --name [etcd name] \--auto-compaction-retention &quot;1h&quot; --max-request-bytes &quot;33554432&quot; --quota-backend-bytes &quot;8589934592&quot; \--data-dir=/var/etcd/etcd-data \--listen-client-urls http://0.0.0.0:2379 \--listen-peer-urls http://0.0.0.0:2380 \--initial-advertise-peer-urls http://[æœ¬èŠ‚ç‚¹åŸŸåæˆ–IP]:2380 \--advertise-client-urls http://[æœ¬èŠ‚ç‚¹åŸŸåæˆ–IP]:2379,http://[æœ¬èŠ‚ç‚¹åŸŸåæˆ–IP]:2380 \-initial-cluster-token etcd-cluster \-initial-cluster &quot;[æœ¬æœº etcd name]=http://[æœ¬èŠ‚ç‚¹åŸŸåæˆ–IP]:2380,[å…¶ä»–etcd name1]=http://[å…¶ä»–èŠ‚ç‚¹åŸŸåæˆ–IP]:2380,[å…¶ä»–etcd name2]=http://[å…¶ä»–èŠ‚ç‚¹åŸŸåæˆ–IP]:2380&quot; \-initial-cluster-state new</code></pre></section><section class="reference"></section><h5 id="æµ‹è¯•-etcd-é›†ç¾¤"><a class="header-anchor" href="#æµ‹è¯•-etcd-é›†ç¾¤"></a>æµ‹è¯• etcd é›†ç¾¤</h5><section class="sample"><p>è¿›å…¥æ­£åœ¨è¿è¡Œçš„ etcd å®¹å™¨ï¼š$<code>docker exec -it [name] sh</code><br>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š$<code>etcdctl --write-out=table --endpoints=&quot;http://[èŠ‚ç‚¹åŸŸåæˆ–IP]:2379,http://[èŠ‚ç‚¹åŸŸåæˆ–IP]:2379,http://[èŠ‚ç‚¹åŸŸåæˆ–IP]:2379&quot; endpoint status</code><br>æŸ¥çœ‹é›†ç¾¤å¥åº·ï¼š$<code>etcdctl --write-out=table --endpoints=&quot;http://[èŠ‚ç‚¹åŸŸåæˆ–IP]:2379,http://[èŠ‚ç‚¹åŸŸåæˆ–IP]:2379,http://[èŠ‚ç‚¹åŸŸåæˆ–IP]:2379&quot; endpoint health</code></p><p>æµ‹è¯•é›†ç¾¤å¯ç”¨æ€§ï¼š</p><pre><code># ä»»æ„èŠ‚ç‚¹å­˜å…¥æ•°æ®etcdctl put /test/key &quot;123&quot;# ä»»æ„èŠ‚ç‚¹å–å‡ºæ•°æ®ï¼Œå–å‡ºæ­£å¸¸ï¼Œé›†ç¾¤å¯ç”¨etcdctl get /test/key</code></pre></section><section class="reference"></section><h4 id="api-server-master-é«˜å¯ç”¨"><a class="header-anchor" href="#api-server-master-é«˜å¯ç”¨"></a>API-Serverï¼ˆMasterï¼‰ é«˜å¯ç”¨</h4><section class="reference"></section><h5 id="é…ç½®è‡ªå®šä¹‰-kubeadm-config-yaml"><a class="header-anchor" href="#é…ç½®è‡ªå®šä¹‰-kubeadm-config-yaml"></a>é…ç½®è‡ªå®šä¹‰ kubeadm-config.yaml</h5><section class="sample"><div class="warning"><p>æ³¨æ„ä¿®æ”¹å¯¹åº”çš„ç‰ˆæœ¬å·ï¼Œä»“åº“è·¯å¾„ç­‰</p></div><pre><code>apiVersion: kubeadm.k8s.io/v1beta1kind: ClusterConfigurationkubernetesVersion: v1.17.0imageRepository: [ä»“åº“è·¯å¾„]apiServer:  extraArgs:    storage-backend: etcd3  extraVolumes:    - hostPath: /etc/localtime      mountPath: /etc/localtime      name: localtime  certSANs:    - &quot;prod-server.k8s.local&quot;    - &quot;server1.k8s.local&quot;    - &quot;server2.k8s.local&quot;    - &quot;server3.k8s.local&quot;    - &quot;127.0.0.1&quot;    - &quot;10.0.0.65&quot;    - &quot;10.0.0.66&quot;    - &quot;10.0.0.67&quot;    - &quot;kubernetes&quot;    - &quot;kubernetes.default&quot;    - &quot;kubernetes.default.svc&quot;    - &quot;kubernetes.default.svc.cluster&quot;    - &quot;kubernetes.default.svc.cluster.local&quot;controllerManager:  extraArgs:    experimental-cluster-signing-duration: 867000h  extraVolumes:    - hostPath: /etc/localtime      mountPath: /etc/localtime      name: localtimescheduler:  extraVolumes:    - hostPath: /etc/localtime      mountPath: /etc/localtime      name: localtimenetworking:  # pod ç½‘æ®µ  podSubnet: 172.224.0.0/12  # SVC ç½‘ç»œ  serviceSubnet: 10.96.0.0/12controlPlaneEndpoint: server.k8s.local:8443etcd:  external:    endpoints:      - http://server1.k8s.local:2379      - http://server2.k8s.local:2379      - http://server3.k8s.local:2379---apiVersion: kubeproxy.config.k8s.io/v1alpha1kind: KubeProxyConfigurationmode: ipvsipvs:  scheduler: lc  minSyncPeriod: 5s  syncPeriod: 15s</code></pre></section><section class="reference"></section><h5 id="åˆå§‹åŒ–-master"><a class="header-anchor" href="#åˆå§‹åŒ–-master"></a>åˆå§‹åŒ– Master</h5><section class="reference"><p>æ‰§è¡Œï¼š$<code>kubeadm init --config=kubeadm-config.yaml --upload-certs</code></p><div class="info"><p>â€“config=kubeadm-config.yaml ä¸ºä¸Šä¸€æ­¥éª¤ç¼–å†™çš„æ–‡ä»¶<br>â€“upload-certs å‚æ•°å°†è¯ä¹¦ä¸Šä¼ åˆ° etcd ä¸­ï¼Œåç»­ä¸éœ€è¦æ‰‹åŠ¨åˆ†å‘</p></div><p>åˆå§‹åŒ–ç»“æŸï¼Œæ§åˆ¶å°è¾“å‡ºï¼š<br>Your Kubernetes control-plane has initialized successfully!</p><p>To start using your cluster, you need to run the following as a regular user:<br><strong><em>å¤åˆ¶å¹¶æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼šå¯ä»¥ä»¥æ™®é€šç”¨æˆ·æ“ä½œé›†ç¾¤</em></strong><br><font color=red>mkdir -p $HOME/.kube<br>sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config<br>sudo chown $(id -u):$(id -g) $HOME/.kube/config</font></p><p>You should now deploy a pod network to the cluster.<br>Run â€œkubectl apply -f [podnetwork].yamlâ€ with one of the options listed at:<br><a href="https://kubernetes.io/docs/concepts/cluster-administration/addons/" target="_blank" rel="noopener">https://kubernetes.io/docs/concepts/cluster-administration/addons/</a></p><p>You can now join any number of the control-plane node running the following command on each as root:<br><strong><em>å¤åˆ¶å¹¶æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼šå…¶ä½™ master å¯ä»¥åŠ å…¥åˆ°åˆ°è¯¥é›†ç¾¤</em></strong><br><font color=green>kubeadm join server.k8s.local:8443 --token uue99t.w9cenfznjoo2e1u6 <br>â€“discovery-token-ca-cert-hash sha256:afd406ce180ce4c9271c0e7b4c3381df72cd75e766f934fd439d101ae1022a43 <br>â€“control-plane --certificate-key 1621bb7101d2fa4050779aaa753e89d49ee7db57129b6b4986c82b45fb4dcbe5</font    ></p><p>Please note that the certificate-key gives access to cluster sensitive data, keep it secret!<br>As a safeguard, uploaded-certs will be deleted in two hours; If necessary, you can use<br>&quot;kubeadm init phase upload-certs --upload-certs&quot; to reload certs afterward.</p><p>Then you can join any number of worker nodes by running the following on each as root:<br><strong><em>å¤åˆ¶å¹¶æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼šworker å¯ä»¥åŠ å…¥åˆ°åˆ°è¯¥é›†ç¾¤</em></strong><br><font color=blue>kubeadm join server.k8s.local:8443 --token uue99t.w9cenfznjoo2e1u6 <br>â€“discovery-token-ca-cert-hash sha256:afd406ce180ce4c9271c0e7b4c3381df72cd75e766f934fd439d101ae1022a43<font></p><div class="warning"><p>ä»¥ä¸Šå‘½ä»¤ä¸­å‡ºç°çš„ hashã€key éœ€è¦è·Ÿä½¿ç”¨è€…å®‰è£…åå‡ºç°çš„ä¸€è‡´ï¼Œä¸å¯ç›´æ¥å¤åˆ¶ä½¿ç”¨ï¼<br>Token å¤±æ•ˆå¯ä»¥ä½¿ç”¨å‘½ä»¤é‡æ–°ç”Ÿæˆ â†“<br>åˆ›å»ºä¸€ä¸ªæ–°çš„tokenï¼š<br>kubeadm token create<br>æŸ¥çœ‹tokenåˆ—è¡¨ï¼š<br>kubeadm token list<br>è·å–caè¯ä¹¦sha256ç¼–ç hashå€¼ï¼š<br>openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2&gt;/dev/null | openssl dgst -sha256 -hex | sed 's/^.* //'<br>æœ€ç»ˆç”Ÿæˆçš„cmdï¼š<br>kubeadm join server.k8s.local:8443 --token ${TOKEN} --discovery-token-ca-cert-hash sha256:${CaSHA256}</p></div></section><h5 id="master-æµ‹è¯•"><a class="header-anchor" href="#master-æµ‹è¯•"></a>master æµ‹è¯•</h5><section class="reference"><p>æ‰§è¡Œï¼š$<code>kubectl get node</code> å¯ä»¥æŸ¥çœ‹é›†ç¾¤æ˜¯å¦åŠ å…¥æˆåŠŸï¼ˆå¯ä»¥æ˜¾ç¤ºåŠ å…¥é›†ç¾¤å†…çš„æ‰€æœ‰èŠ‚ç‚¹ï¼‰<br>æ‰§è¡Œï¼š$<code>kubectl get pod -A</code> å¯ä»¥æŸ¥çœ‹æ‰€æœ‰é›†ç¾¤å†…æ­£åœ¨è¿è¡Œçš„podï¼ˆæ£€æŸ¥ apiserverã€controller-managerã€proxyã€scheduler æ˜¯å¦æ˜¯ running çŠ¶æ€ï¼Œcoredns ç›®å‰ä¸º pending çŠ¶æ€ï¼‰</p></section><h4 id="ç»“æŸ"><a class="header-anchor" href="#ç»“æŸ"></a>ç»“æŸ</h4><section class="reference"><p>è‡³æ­¤ï¼Œé«˜å¯ç”¨ K8S å®‰è£…æˆåŠŸã€‚</p></section><h4 id="ç”œç‚¹"><a class="header-anchor" href="#ç”œç‚¹"></a>ç”œç‚¹</h4><section class="reference"><p>é›†ç¾¤é‡ç½®ï¼š$<code>kubeadm reset</code></p><div class="info"><p>å¦‚æœæ˜¯å¤–æ¥ ETCD ï¼Œéœ€è¦æ¸…ç©ºå¤–æ¥ ETCD æ•°æ®ï¼š$<code>etcdctl del &quot;&quot; --prefix</code></p></div><p><strong><em>å‚è€ƒé“¾æ¥</em></strong><br><a href="https://qingmu.io/2019/05/17/Deploy-a-highly-available-cluster-with-kubeadm/" target="_blank" rel="noopener">åœ¨é˜¿é‡Œäº‘çš„VPCéƒ¨ç½²é«˜å¯ç”¨kubernetes</a></p></section>]]></content>
    
    <summary type="html">
    
      
      
        &lt;div class=&quot;warning&quot;&gt;
&lt;p&gt;æœ¬æ–‡èµ„æ–™æ•´ç†è‡ªç½‘ç»œï¼Œå¯¹å…¶ä¸­è¿‡æ—¶éƒ¨åˆ†è¿›è¡Œä¿®æ­£ï¼&lt;br&gt;
è¿è¡Œç¯å¢ƒä¸ºï¼šKVM è™šæ‹Ÿæœºï¼ˆå…ˆæ ¹æ®ä¸‹æ–‡ç¬¬ä¸€éƒ¨åˆ†åˆ¶ä½œåŸºç¡€é•œåƒï¼Œå†ç”¨åŸºç¡€é•œåƒå…‹éš†ä¸ºå„ä¸ª masterã€worker èŠ‚ç‚¹ï¼Œå¯ä»¥èŠ‚çœæ—¶é—´ï¼‰&lt;br&gt;
é€‚ç”¨ç‰ˆæœ¬ä¸ºï¼š&lt;br&gt;
æ“ä½œç³»ç»Ÿï¼šU
      
    
    </summary>
    
    
      <category term="DevOps" scheme="http://www.lockey.xyz/categories/DevOps/"/>
    
    
      <category term="K8S" scheme="http://www.lockey.xyz/tags/K8S/"/>
    
      <category term="Kubernetes" scheme="http://www.lockey.xyz/tags/Kubernetes/"/>
    
      <category term="ç¼–æ’" scheme="http://www.lockey.xyz/tags/%E7%BC%96%E6%8E%92/"/>
    
      <category term="é«˜å¯ç”¨" scheme="http://www.lockey.xyz/tags/%E9%AB%98%E5%8F%AF%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>K8S</title>
    <link href="http://www.lockey.xyz/2019/12/31/DevOps/K8S/"/>
    <id>http://www.lockey.xyz/2019/12/31/DevOps/K8S/</id>
    <published>2019-12-31T06:33:19.000Z</published>
    <updated>2020-01-06T03:21:46.772Z</updated>
    
    <content type="html"><![CDATA[<h2 id="éƒ¨ç½²çš„æ¼”åŒ–å†å²"><a class="header-anchor" href="#éƒ¨ç½²çš„æ¼”åŒ–å†å²"></a>éƒ¨ç½²çš„æ¼”åŒ–å†å²</h2><section class="reference"><ul><li>ä¼ ç»Ÿéƒ¨ç½²<ul><li>èµ„æºåˆ†é…é—®é¢˜</li></ul></li><li>è™šæ‹ŸåŒ–éƒ¨ç½²<ul><li>é‡çº§è¾ƒé‡</li></ul></li><li>å®¹å™¨åŒ–éƒ¨ç½²<ul><li>æ•æ·åº”ç”¨ç¨‹åºçš„åˆ›å»ºå’Œéƒ¨ç½²</li><li>æŒç»­å¼€å‘ã€é›†æˆå’Œéƒ¨ç½²æ–¹ä¾¿</li><li>å¼€å‘è¿ç»´åˆ†ç¦»</li><li>å¯è§‚å¯Ÿæ€§ä¸°å¯Œ</li><li>è·¨å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒä¸€è‡´</li><li>äº‘å’Œæ“ä½œç³»ç»Ÿåˆ†å‘çš„å¯ç§»æ¤æ€§å¼º</li><li>ä»¥åº”ç”¨ç¨‹åºä¸ºä¸­å¿ƒç®¡ç†</li><li>é€‚åˆæ¾æ•£è€¦åˆã€åˆ†å¸ƒå¼ã€å¼¹æ€§ã€è§£æ”¾çš„å¾®æœåŠ¡</li><li>èµ„æºéš”ç¦»</li><li>èµ„æºåˆ©ç”¨ç‡é«˜</li></ul></li></ul><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="éƒ¨ç½²æ¼”è¿›å†å².svg" alt="" title="">                </div>                <div class="image-caption"></div>            </figure></section><h2 id="å®¹å™¨éƒ¨ç½²æ—¶ä»£é¢ä¸´çš„é—®é¢˜"><a class="header-anchor" href="#å®¹å™¨éƒ¨ç½²æ—¶ä»£é¢ä¸´çš„é—®é¢˜"></a>å®¹å™¨éƒ¨ç½²æ—¶ä»£é¢ä¸´çš„é—®é¢˜</h2><section class="reference"></section><h5 id="é—®é¢˜"><a class="header-anchor" href="#é—®é¢˜"></a>é—®é¢˜</h5><section class="reference"><ul><li>æœåŠ¡é›†ç¾¤è¶Šæ¥è¶Šå¤§</li><li>ä¼ ç»Ÿçš„é›†ç¾¤å®¹å™¨éƒ¨ç½²æ–¹å¼è¾ƒç¹ç</li><li>å·¥ä½œé‡æ—¥ç›ŠåŠ å¤§</li><li>å®¹æ˜“å‡ºé”™</li></ul></section><h5 id="è§£å†³æ–¹å‘"><a class="header-anchor" href="#è§£å†³æ–¹å‘"></a>è§£å†³æ–¹å‘</h5><section class="reference"><p>éœ€è¦ä¸€ä¸ªå¼ºå¤§çš„å®¹å™¨ç®¡ç†ã€ç¼–æ’ç³»ç»Ÿ</p></section><h5 id="è§£å†³æ–¹æ¡ˆ"><a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h5><section class="reference"><p>kubernetes[K8S]</p></section><h2 id="k8sæ˜¯ä»€ä¹ˆï¼Ÿ"><a class="header-anchor" href="#k8sæ˜¯ä»€ä¹ˆï¼Ÿ"></a>K8Sæ˜¯ä»€ä¹ˆï¼Ÿ</h2><section class="reference"></section><h5 id="ç‰¹ç‚¹"><a class="header-anchor" href="#ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h5><section class="reference"><ul><li>å¯ç§»æ¤</li><li>å¯æ‰©å±•</li><li>å¼€æº</li><li>ç”Ÿæ€ç³»ç»Ÿåºå¤§ä¸”æœ‰æ´»åŠ›</li></ul></section><h5 id="ä½œç”¨"><a class="header-anchor" href="#ä½œç”¨"></a>ä½œç”¨</h5><section class="reference"><ul><li>æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡</li><li>å­˜å‚¨ç¼–æ’</li><li>è‡ªåŠ¨éƒ¨ç½²å’Œå›æ»š</li><li>è‡ªåŠ¨äºŒè¿›åˆ¶æ‰“åŒ…</li><li>è‡ªæˆ‘ä¿®å¤</li><li>ç§˜é’¥ä¸é…ç½®ç®¡ç†</li></ul></section><h5 id="å…¶å®ƒæ„ä¹‰"><a class="header-anchor" href="#å…¶å®ƒæ„ä¹‰"></a>å…¶å®ƒæ„ä¹‰</h5><section class="reference"><ul><li>ä¿ƒè¿›å£°æ˜å¼é…ç½®</li><li>è‡ªåŠ¨åŒ–</li></ul></section><h2 id="æ¶æ„"><a class="header-anchor" href="#æ¶æ„"></a>æ¶æ„</h2><section class="reference"><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="k8sæ¶æ„å›¾.png" alt="æ¶æ„å›¾" title="">                </div>                <div class="image-caption">æ¶æ„å›¾</div>            </figure></section><h2 id="ç»„ä»¶"><a class="header-anchor" href="#ç»„ä»¶"></a>ç»„ä»¶</h2><section class="reference"><ul><li>Masterã€é›†ç¾¤æ§åˆ¶å¹³é¢ã€‘<ul><li>kube-apiservice<ul><li>ä¸»èŠ‚ç‚¹ä¸Šè´Ÿè´£æä¾› Kubernetes API æœåŠ¡çš„ç»„ä»¶</li><li>æ”¯æŒ<a href="https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/high-availability/" target="_blank" rel="noopener">æ°´å¹³æ‰©ç¼©</a></li></ul></li><li><a href="https://github.com/etcd-io/etcd/blob/master/Documentation/docs.md" target="_blank" rel="noopener">etcd</a><ul><li>ä½œä¸ºä¿å­˜ Kubernetes æ‰€æœ‰é›†ç¾¤æ•°æ®çš„åå°æ•°æ®åº“</li><li>å…¼å…·ä¸€è‡´æ€§å’Œé«˜å¯ç”¨æ€§çš„é”®å€¼æ•°æ®åº“</li><li>é€šå¸¸éœ€è¦æœ‰ä¸ªå¤‡ä»½è®¡åˆ’</li></ul></li><li>kube-scheduler<ul><li>ç›‘è§†æ–°åˆ›å»ºçš„æœªæŒ‡å®šè¿è¡ŒèŠ‚ç‚¹çš„ Pod</li><li>é€‰æ‹©èŠ‚ç‚¹è®© Pod åœ¨ä¸Šé¢è¿è¡Œ</li></ul></li><li>kube-controller-manager<ul><li>Node Controller<ul><li>è´Ÿè´£åœ¨èŠ‚ç‚¹æ•…éšœæ—¶è¿›è¡Œé€šçŸ¥å’Œå“åº”</li></ul></li><li>Replication Controllerï¼ˆRCï¼‰<ul><li>è´Ÿè´£ä¸ºç³»ç»Ÿä¸­æ¯ä¸ªå‰¯æœ¬æ§åˆ¶å™¨å¯¹è±¡ç»´æŠ¤æ­£ç¡®æ•°é‡çš„ Pod</li></ul></li><li>Endpoints Controller<ul><li>å¡«å……ç«¯ç‚¹ï¼ˆEndpointsï¼‰å¯¹è±¡ï¼ˆå³åŠ å…¥ Service ä¸ Podï¼‰</li></ul></li><li>Service Account &amp; Token Controllers<ul><li>ä¸ºæ–°çš„å‘½åç©ºé—´åˆ›å»ºé»˜è®¤è´¦æˆ·å’Œ API è®¿é—®ä»¤ç‰Œ</li></ul></li></ul></li><li>cloud-controller-manager<ul><li>è¿è¡Œä¸åŸºç¡€äº‘æä¾›å•†äº¤äº’çš„æ§åˆ¶å™¨</li></ul></li></ul></li></ul><p><img src="Master.png" alt="Master"></p><ul><li>Nodeã€ç»´æŠ¤è¿è¡Œçš„ Pod å¹¶æä¾› Kubernetes è¿è¡Œç¯å¢ƒã€‘<ul><li>kubelet<ul><li>ä¿è¯å®¹å™¨éƒ½è¿è¡Œåœ¨ Pod ä¸­</li><li>æ¥æ”¶ä¸€ç»„é€šè¿‡å„ç±»æœºåˆ¶æä¾›ç»™å®ƒçš„ PodSpecsï¼Œç¡®ä¿ PodSpecs ä¸­æè¿°çš„å®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€ä¸”å¥åº·</li><li>ä¸ä¼šç®¡ç†ä¸æ˜¯ç”± Kubernetes åˆ›å»ºçš„å®¹å™¨</li></ul></li><li>kube-proxy<ul><li>æ˜¯é›†ç¾¤ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ç½‘ç»œä»£ç†ï¼Œå®ç° Kubernetes Service æ¦‚å¿µçš„ä¸€éƒ¨åˆ†</li><li>ç»´æŠ¤èŠ‚ç‚¹ä¸Šçš„ç½‘ç»œè§„åˆ™<ul><li>å…è®¸ä»é›†ç¾¤å†…éƒ¨æˆ–å¤–éƒ¨ç½‘ç»œä¼šè¯ä¸ Pod è¿›è¡Œç½‘ç»œé€šä¿¡</li></ul></li></ul></li><li>å®¹å™¨è¿è¡Œç¯å¢ƒï¼ˆDocker ç­‰ï¼‰<ul><li>è´Ÿè´£è¿è¡Œå®¹å™¨</li></ul></li></ul></li><li><a href="https://kubernetes.io/zh/docs/concepts/cluster-administration/addons/" target="_blank" rel="noopener">Addons</a>ã€ä½¿ç”¨ Kubernetes èµ„æº (DaemonSet, Deploymentç­‰) å®ç°é›†ç¾¤åŠŸèƒ½ï¼›å‘½åç©ºé—´ä¸ºï¼škube-systemã€‘<ul><li>DNS<ul><li>æ‰€æœ‰ Kubernetes é›†ç¾¤éƒ½åº”å…·æœ‰ DNS (éå¼ºåˆ¶æ€§è¦æ±‚)</li><li>ä¸º Kubernetes é›†ç¾¤æä¾› DNS è®°å½•</li><li>Kubernetes å¯åŠ¨çš„å®¹å™¨è‡ªåŠ¨å°† DNS æœåŠ¡å™¨åŒ…å«åœ¨ DNS æœç´¢ä¸­</li></ul></li><li>Dashboard<ul><li><a href="https://kubernetes.io/zh/docs/tasks/access-application-cluster/web-ui-dashboard/" target="_blank" rel="noopener">Web UI</a></li><li>ä½¿ç”¨æˆ·å¯ä»¥ç®¡ç†é›†ç¾¤ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºä»¥åŠé›†ç¾¤æœ¬èº«è¿›è¡Œæ•…éšœæ’é™¤</li></ul></li><li>å®¹å™¨èµ„æºç›‘æ§<ul><li>å°†å…³äºå®¹å™¨çš„ä¸€äº›å¸¸è§çš„æ—¶é—´åºåˆ—åº¦é‡å€¼ä¿å­˜åˆ°ä¸€ä¸ªé›†ç¾¤æ•°æ®åº“ä¸­</li><li>æä¾›ç”¨äºæµè§ˆè¿™äº›æ•°æ®çš„ç•Œé¢</li></ul></li><li>é›†ç¾¤å±‚é¢æ—¥å¿—<ul><li>è´Ÿè´£å°†å®¹å™¨çš„æ—¥å¿—ä¿å­˜åˆ°ä¸€ä¸ªé›†ä¸­çš„æ—¥å¿—å­˜å‚¨ä¸­</li><li>æä¾›æœç´¢å’Œæµè§ˆæ¥å£</li></ul></li></ul></li></ul><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="Node.png" alt="Node" title="">                </div>                <div class="image-caption">Node</div>            </figure><p><strong><em>å…¶ä»–ç»„ä»¶</em></strong></p><ul><li><a href="https://kubernetes.io/zh/docs/reference/kubectl/overview/" target="_blank" rel="noopener">kubectl</a>ã€æ“æ§ Kubernetes é›†ç¾¤ã€‘<ul><li>è´Ÿè´£ç®¡ç† Pods å’Œå®ƒä»¬ä¸Šé¢çš„å®¹å™¨ï¼Œé•œåƒã€volumesã€etc</li></ul></li></ul></section><h2 id="è®¾è®¡ç†å¿µ"><a class="header-anchor" href="#è®¾è®¡ç†å¿µ"></a>è®¾è®¡ç†å¿µ</h2><section class="reference"><div class="info"><p>æ ¸å¿ƒç†å¿µï¼š</p><ol><li>å®¹é”™æ€§</li><li>æ‰©å±•æ€§</li></ol></div></section><h5 id="api-è®¾è®¡åŸåˆ™"><a class="header-anchor" href="#api-è®¾è®¡åŸåˆ™"></a>API è®¾è®¡åŸåˆ™</h5><section class="reference"><ol><li>æ‰€æœ‰ API åº”è¯¥æ˜¯å£°æ˜å¼çš„</li><li>AIP å¯¹è±¡æ˜¯å½¼æ­¤äº’è¡¥ä¸”å¯ç»„åˆçš„</li><li>é«˜å±‚ API ä»¥æ“ä½œæ„å›¾ä¸ºåŸºç¡€è®¾è®¡</li><li>åº•å±‚ API æ ¹æ®é«˜å±‚ API çš„æ§åˆ¶éœ€è¦è®¾è®¡</li><li>å°½é‡é¿å…ç®€å•å°è£…ï¼Œä¸è¦æœ‰åœ¨å¤–éƒ¨ API æ— æ³•æ˜¾å¼çŸ¥é“çš„å†…éƒ¨éšè—æœºåˆ¶</li><li>API æ“ä½œå¤æ‚åº¦ä¸å¯¹è±¡æ•°é‡æˆæ­£æ¯”</li><li>API å¯¹è±¡çŠ¶æ€ä¸èƒ½ä¾èµ–äºç½‘ç»œè¿æ¥çŠ¶æ€</li><li>å°½é‡é¿å…è®©æ“ä½œæœºåˆ¶ä¾èµ–äºå…¨å±€çŠ¶æ€</li></ol></section><h5 id="æ§åˆ¶æœºåˆ¶è®¾è®¡åŸåˆ™"><a class="header-anchor" href="#æ§åˆ¶æœºåˆ¶è®¾è®¡åŸåˆ™"></a>æ§åˆ¶æœºåˆ¶è®¾è®¡åŸåˆ™</h5><section class="reference"><ol><li>æ§åˆ¶é€»è¾‘åº”è¯¥åªä¾èµ–äºå½“å‰çŠ¶æ€</li><li>å‡è®¾ä»»ä½•é”™è¯¯çš„å¯èƒ½ï¼Œå¹¶åšå®¹é”™å¤„ç†</li><li>å°½é‡é¿å…å¤æ‚çŠ¶æ€æœºï¼Œæ§åˆ¶é€»è¾‘ä¸è¦ä¾èµ–æ— æ³•ç›‘æ§çš„å†…éƒ¨çŠ¶æ€</li><li>å‡è®¾ä»»ä½•æ“ä½œéƒ½å¯èƒ½è¢«ä»»ä½•æ“ä½œå¯¹è±¡æ‹’ç»ï¼Œç”šè‡³è¢«é”™è¯¯è§£æ</li><li>æ¯ä¸ªæ¨¡å—éƒ½å¯ä»¥åœ¨å‡ºé”™åè‡ªåŠ¨æ¢å¤</li><li>æ¯ä¸ªæ¨¡å—éƒ½å¯ä»¥åœ¨å¿…è¦çš„æ—¶å€™ä¼˜é›…çš„é™çº§æœåŠ¡</li></ol></section><h5 id="æ ¸å¿ƒæŠ€æœ¯æ¦‚å¿µ"><a class="header-anchor" href="#æ ¸å¿ƒæŠ€æœ¯æ¦‚å¿µ"></a>æ ¸å¿ƒæŠ€æœ¯æ¦‚å¿µ</h5><section class="reference"><table><thead><tr><th>æœ¯è¯­</th><th>è¯­ä¹‰</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>Pod</td><td>é›†ç¾¤ä¸­éƒ¨ç½²åº”ç”¨æˆ–æœåŠ¡çš„æœ€å°å•å…ƒï¼Œå¯ä»¥åŒ…å«å¤šä¸ªå®¹å™¨</td><td></td></tr><tr><td>å‰¯æœ¬é›†ï¼ˆReplica Setï¼ŒRSï¼‰</td><td>æ–°ä¸€ä»£ RCï¼Œæ”¯æŒæ›´å¤šåŒ¹é…æ¨¡å¼</td><td></td></tr><tr><td>éƒ¨ç½²ï¼ˆDeploymentï¼‰</td><td>è¡¨ç¤ºç”¨æˆ·å¯¹é›†ç¾¤çš„ä¸€æ¬¡æ›´æ–°æ“ä½œ</td><td></td></tr><tr><td>æœåŠ¡ï¼ˆServiceï¼‰</td><td>å®¢æˆ·ç«¯è¦è®¿é—®çš„æœåŠ¡å°±æ˜¯ Service å¯¹è±¡</td><td>æ¯ä¸ª Service ä¼šå¯¹åº”ä¸€ä¸ªé›†ç¾¤å†…éƒ¨çš„è™šæ‹Ÿ IPï¼Œé›†ç¾¤å†…éƒ¨é€šè¿‡è™šæ‹Ÿ IP è®¿é—®æœåŠ¡</td></tr><tr><td>ä»»åŠ¡ï¼ˆJobï¼‰</td><td>æ§åˆ¶æ‰¹å¤„ç†å‹ä»»åŠ¡çš„å¯¹è±¡</td><td></td></tr><tr><td>åå°æ”¯æ’‘æœåŠ¡é›†ï¼ˆDaemonSetï¼‰</td><td>ä¿è¯æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰æ­¤ç±» Pod è¿è¡Œ</td><td>å…¸å‹çš„æ”¯æŒæœåŠ¡æœ‰ï¼šå­˜å‚¨ã€æ—¥å¿—ã€ç›‘æ§ç­‰</td></tr><tr><td>æœ‰çŠ¶æ€æœåŠ¡é›†ï¼ˆPetSetï¼‰</td><td>æ¯ä¸ª Pod çš„åå­—è¦äº‹å…ˆç¡®å®šï¼ŒæŒ‚è½½è‡ªå·±ç‹¬ç«‹çš„å­˜å‚¨</td><td>é€‚åˆ PetSet çš„ä¸šåŠ¡ï¼šMySQLã€PostgreSQLã€Zookeeperç­‰</td></tr><tr><td>é›†ç¾¤è”é‚¦ï¼ˆFederationï¼‰</td><td>æä¾›æ‰©åŒºåŸŸè·¨æœåŠ¡å•†èƒ½åŠ›</td><td>æ¯ä¸ª Federation æœ‰è‡ªå·±çš„åˆ†å¸ƒå¼å­˜å‚¨ã€API Server å’Œ Controller Manager</td></tr><tr><td>å­˜å‚¨å·ï¼ˆVolumeï¼‰</td><td>ä¸ Docker å­˜å‚¨å·ç±»ä¼¼ï¼Œä¸è¿‡ä½œç”¨è®¿é—®æ˜¯ Pod</td><td></td></tr><tr><td>æŒä¹…å­˜å‚¨å·ï¼ˆPersistent Volumeï¼ŒPVï¼‰å’ŒæŒä¹…å­˜å‚¨å·å£°æ˜ï¼ˆPersistent Volume Claimï¼ŒPVCï¼‰</td><td>ä½¿é›†ç¾¤å…·å¤‡å­˜å‚¨çš„é€»è¾‘æŠ½è±¡èƒ½åŠ›</td><td>PV å’Œ PVC çš„å…³ç³»ç›¸å½“äº Node å’Œ Pod çš„å…³ç³»</td></tr><tr><td>åç§°ï¼ˆNamesï¼‰</td><td>Kubernetes REST API ä¸­çš„æ‰€æœ‰å¯¹è±¡éƒ½ç”±åç§°å’Œ UID æ˜ç¡®æ ‡è¯†ï¼›ä¸€æ¬¡åªèƒ½æœ‰ä¸€ä¸ªç»™å®šç±»å‹çš„å¯¹è±¡å…·æœ‰ç»™å®šçš„åç§°ï¼ˆå¦‚æœåˆ é™¤å¯¹è±¡ï¼Œåˆ™å¯ä»¥åˆ›å»ºåŒåçš„æ–°å¯¹è±¡ï¼‰</td><td></td></tr><tr><td>UIDs</td><td>ç³»ç»Ÿç”Ÿæˆçš„å­—ç¬¦ä¸²ï¼Œå”¯ä¸€æ ‡è¯†å¯¹è±¡ï¼›åœ¨é›†ç¾¤çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­åˆ›å»ºçš„æ¯ä¸€ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªä¸åŒçš„ UIDï¼Œç”¨æ¥åŒºåˆ†ç±»ä¼¼å®ä½“çš„å†å²äº‹ä»¶</td><td></td></tr><tr><td>å‘½åç©ºé—´ï¼ˆNamespaceï¼‰</td><td>Kubernetes æ”¯æŒå¤šä¸ªè™šæ‹Ÿé›†ç¾¤ï¼Œä¾èµ–äºåŒä¸€ç‰©ç†é›†ç¾¤ã€‚è¿™äº›è™šæ‹Ÿé›†ç¾¤è¢«ç§°ä¸ºå‘½åç©ºé—´ã€‚</td><td></td></tr><tr><td>æ ‡ç­¾å’Œé€‰æ‹©å™¨ï¼ˆLabels &amp; Selectorsï¼‰</td><td>æ ‡ç­¾æ˜¯é™„åŠ åˆ° Kubernetes å¯¹è±¡ä¸Šçš„é”®å€¼å¯¹ï¼Œç”¨äºæŒ‡å®šå¯¹ç”¨æˆ·æœ‰æ„ä¹‰ä¸”ç›¸å…³çš„å¯¹è±¡æ ‡è¯†å±æ€§ï¼Œä½†ä¸ç›´æ¥å¯¹æ ¸å¿ƒç³»ç»Ÿæœ‰è¯­ä¹‰å«ä¹‰</td><td>æ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥å®šä¹‰ä¸€ç»„é”®/å€¼æ ‡ç­¾ï¼Œæ¯ä¸ªé”®å¯¹äºç»™å®šå¯¹è±¡å¿…é¡»å”¯ä¸€</td></tr><tr><td>æ³¨è§£ï¼ˆAnnotationsï¼‰</td><td>å¯ä»¥ä½¿ç”¨æ³¨è§£ä¸ºå¯¹è±¡é™„åŠ ä»»æ„çš„éæ ‡è¯†çš„å…ƒæ•°æ®</td><td></td></tr><tr><td>å­—æ®µé€‰æ‹©å™¨ï¼ˆField Selectorsï¼‰</td><td>å…è®¸æ ¹æ®å¤šä¸ªæˆ–å¤šä¸ªèµ„æºå­—æ®µçš„å€¼ç­›é€‰ Kubernetes èµ„æº</td><td></td></tr></tbody></table></section><h2 id="kubernetes-å¯¹è±¡ç®¡ç†"><a class="header-anchor" href="#kubernetes-å¯¹è±¡ç®¡ç†"></a>Kubernetes å¯¹è±¡ç®¡ç†</h2><section class="reference"><div class="warning"><p>åº”è¯¥åªä½¿ç”¨ä¸€ç§æŠ€æœ¯æ¥ç®¡ç† Kubernetes å¯¹è±¡ï¼›æ··åˆå’ŒåŒ¹é…æŠ€æœ¯ä½œç”¨äºåŒä¸€å¯¹è±¡ä¸Šå°†å¯¼è‡´æœªå®šä¹‰è¡Œä¸º</p></div><table><thead><tr><th>ç±»å‹</th><th>ä½¿ç”¨ç¯å¢ƒ</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>å‘½ä»¤å¼å‘½ä»¤</td><td>æµ‹è¯•</td><td>1. å‘½ä»¤ç®€å•ï¼Œæ˜“å­¦ã€æ˜“è®°ï¼›</br>2. å¿«é€Ÿæ›´æ”¹é›†ç¾¤</td><td>1. å‘½ä»¤ä¸ä¸å˜æ›´å®¡æŸ¥æµç¨‹é›†æˆï¼›<br>2. ä¸æä¾›ä¸æ›´æ”¹ç®¡ç†çš„å®¡æ ¸è·Ÿè¸ªï¼›<br>3.é™¤äº†å®æ—¶å†…å®¹ï¼Œå‘½ä»¤ä¸æä¾›è®°å½•æºï¼›<br>4. ä¸æä¾›ç”¨äºåˆ›å»ºæ–°å¯¹è±¡çš„æ¨¡æ¿</td></tr><tr><td>å‘½ä»¤å¼å¯¹è±¡é…ç½®</td><td>ç”Ÿäº§</td><td>ä¸å‘½ä»¤å¼å‘½ä»¤ç›¸æ¯”ï¼š<br>1. å¯ä»¥å­˜å‚¨åœ¨æºæ§åˆ¶ç³»ç»Ÿä¸­ï¼Œå¦‚ï¼šGitï¼›<br>2. å¯ä»¥ä¸æµç¨‹é›†æˆï¼Œå¦‚ï¼šåœ¨æ¨é€å’Œå®¡è®¡ä¹‹å‰æ£€æŸ¥æ›´æ–°ï¼›<br>3.æä¾›ç”¨äºåˆ›å»ºæ–°å¯¹è±¡çš„æ¨¡æ¿ï¼›<br><br>ä¸å£°æ˜å¼å¯¹è±¡é…ç½®ç›¸æ¯”ï¼š<br>1. é…ç½®è¡Œä¸ºç®€å•æ˜“æ‡‚ï¼›<br>2. æ›´åŠ æˆç†Ÿ</td><td>ä¸å‘½ä»¤å¼å‘½ä»¤ç›¸æ¯”ï¼š<br>1. éœ€è¦å¯¹å¯¹è±¡æ¶æ„æœ‰äº†è§£ï¼›<br>2. éœ€è¦äº› YAML æ–‡ä»¶ï¼›<br><br>ä¸å£°æ˜å¼å¯¹è±¡é…ç½®ç›¸æ¯”ï¼š<br>1. å¯¹æ´»åŠ¨å¯¹è±¡çš„æ›´æ–°å¿…é¡»åæ˜ åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå¦åˆ™å°†åœ¨ä¸‹ä¸€æ¬¡æ›¿æ¢æ—¶ä¸¢å¤±ï¼›<br>2. é’ˆå¯¹æ–‡ä»¶è€Œä¸æ˜¯ç›®å½•</td></tr><tr><td>å£°æ˜å¼å¯¹è±¡é…ç½®</td><td>ç”Ÿäº§</td><td>1. å³ä½¿æœªå°†å¯¹æ´»åŠ¨å¯¹è±¡æ‰€åšçš„æ›´æ”¹æœªåˆå¹¶å›é…ç½®æ–‡ä»¶ä¸­ï¼Œä¹Ÿå°†ä¿ç•™è¿™äº›æ›´æ”¹ï¼›<br>2. æ›´å¥½çš„æ”¯æŒå¯¹ç›®å½•è¿›è¡Œæ“ä½œå¹¶è‡ªåŠ¨æ£€æµ‹æ¯ä¸ªå¯¹è±¡çš„æ“ä½œç±»å‹ï¼ˆåˆ›å»ºã€ä¿®è¡¥ã€åˆ é™¤ï¼‰</td><td>1. é…ç½®éš¾äºè°ƒè¯•å¹¶ä¸”å‡ºç°å¼‚å¸¸æ—¶éš¾ä»¥ç†è§£ï¼›<br>2. ä½¿ç”¨å·®å¼‚çš„éƒ¨åˆ†æ›´æ–°ä¼šåˆ›å»ºå¤æ‚çš„åˆå¹¶å’Œè¡¥ä¸æ“ä½œ</td></tr></tbody></table></section><h2 id="ä½¿ç”¨"><a class="header-anchor" href="#ä½¿ç”¨"></a>ä½¿ç”¨</h2><section class="reference"></section><h5 id="å®‰è£…"><a class="header-anchor" href="#å®‰è£…"></a>å®‰è£…</h5><section class="sample"><pre><code>cat &lt;&lt;EOF &gt; /etc/apt/sources.list.d/kubernetes.listdeb http://mirrors.ustc.edu.cn/kubernetes/apt kubernetes-xenial mainEOFapt-get updateapt-get install -y kubelet kubeadm kubectlapt-mark hold kubelet kubeadm kubectl</code></pre></section><section class="reference"><p><strong><em>å‚è€ƒèµ„æ–™</em></strong><br><a href="https://kubernetes.io/zh/docs/concepts/" target="_blank" rel="noopener">K8S(å®˜æ–¹)</a><br><a href="http://docs.kubernetes.org.cn/" target="_blank" rel="noopener">Kubernetes ä¸­æ–‡ç¤¾åŒº | ä¸­æ–‡æ–‡æ¡£</a><br><a href="https://www.kubernetes.org.cn/docs" target="_blank" rel="noopener">Kubernetes ä¸­æ–‡æ‰‹å†Œ</a></p></section>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;éƒ¨ç½²çš„æ¼”åŒ–å†å²&quot;&gt;&lt;a class=&quot;header-anchor&quot; href=&quot;#éƒ¨ç½²çš„æ¼”åŒ–å†å²&quot;&gt;&lt;/a&gt;éƒ¨ç½²çš„æ¼”åŒ–å†å²&lt;/h2&gt;
&lt;section class=&quot;reference&quot;&gt;
&lt;ul&gt;
&lt;li&gt;ä¼ ç»Ÿéƒ¨ç½²
&lt;ul&gt;
&lt;li&gt;èµ„æºåˆ†é…é—®é¢˜&lt;/li&gt;
&lt;/
      
    
    </summary>
    
    
      <category term="DevOps" scheme="http://www.lockey.xyz/categories/DevOps/"/>
    
    
      <category term="K8S" scheme="http://www.lockey.xyz/tags/K8S/"/>
    
      <category term="Kubernetes" scheme="http://www.lockey.xyz/tags/Kubernetes/"/>
    
      <category term="ç¼–æ’" scheme="http://www.lockey.xyz/tags/%E7%BC%96%E6%8E%92/"/>
    
  </entry>
  
  <entry>
    <title>ELK</title>
    <link href="http://www.lockey.xyz/2019/12/20/DevOps/ELK/"/>
    <id>http://www.lockey.xyz/2019/12/20/DevOps/ELK/</id>
    <published>2019-12-20T02:00:31.000Z</published>
    <updated>2019-12-26T02:00:08.478Z</updated>
    
    <content type="html"><![CDATA[<h2 id="elk-æ˜¯ä»€ä¹ˆ"><a class="header-anchor" href="#elk-æ˜¯ä»€ä¹ˆ"></a>ELK æ˜¯ä»€ä¹ˆ?</h2><section class="reference"><ul><li>æ˜¯ ElasticSearchã€Logstashã€Kibana ä¸‰ä¸ªå¼€æºè½¯ä»¶çš„ç»„åˆ</li><li>å…·å¤‡æ•°æ®æ”¶é›†ã€å­˜å‚¨ã€åˆ†æåŠŸèƒ½</li><li>é€‚åˆå®æ—¶æ•°æ®åˆ†æå’Œæ£€ç´¢çš„åœºæ™¯</li><li>å…·æœ‰åˆ†å¸ƒå¼ç‰¹æ€§</li><li>æ˜“æ‰©å±•</li></ul></section><h2 id="elk-åŠŸèƒ½"><a class="header-anchor" href="#elk-åŠŸèƒ½"></a>ELK åŠŸèƒ½</h2><section class="reference"><ul><li>ElasticSearch<ul><li>å­˜å‚¨</li><li>ç´¢å¼•</li></ul></li><li>Logstash<ul><li>æ”¶é›†</li><li>å¤„ç†</li></ul></li><li>Kibana<ul><li>å¯è§†åŒ–</li><li>ç»Ÿè®¡åˆ†æ</li></ul></li><li>Beatï¼ˆæ‰©å±•ç»„ä»¶ï¼‰<ul><li>MetricBeat<ul><li>æ”¶é›†å„ç§ä¸»æœºä¿¡æ¯ï¼ˆCPUã€å†…å­˜â€¦â€¦ï¼‰ï¼Œè¯¦è§å®˜ç½‘</li></ul></li><li>Filebeat<ul><li>è½»é‡çº§æ—¥å¿—æ”¶é›†ç»„ä»¶</li></ul></li></ul></li></ul></section><h2 id="ç®€å•æ¶æ„"><a class="header-anchor" href="#ç®€å•æ¶æ„"></a>ç®€å•æ¶æ„</h2><section class="reference"><div id="flowchart-0" class="flow-chart"></div></section><h2 id="ä½¿ç”¨"><a class="header-anchor" href="#ä½¿ç”¨"></a>ä½¿ç”¨</h2><section class="reference"></section><h4 id="ä½¿ç”¨-docker-å®‰è£…-elk"><a class="header-anchor" href="#ä½¿ç”¨-docker-å®‰è£…-elk"></a>ä½¿ç”¨ Docker å®‰è£… ELK</h4><section class="reference"><p>å‚è€ƒ <a href="https://github.com/deviantony/docker-elk.git" target="_blank" rel="noopener">https://github.com/deviantony/docker-elk.git</a></p><div class="info"><ul><li>Kibana ä¸­æ–‡è®¾ç½®<br><code>$ vim kibana/config/kibana.yml</code></li><li>æ–°å¢ä¸­æ–‡é…ç½® â†“â†“â†“</li><li>i18n.locale: â€œzh-CNâ€</li></ul></div><div class="warning"><ul><li>ElasticSearch é»˜è®¤éœ€è¦ 4G å†…å­˜ï¼›å¯ä»¥é€šè¿‡è®¾ç½® ES_JAVA_OPTS æ¥ä¿®æ”¹</li><li>å¦‚ï¼š<code>ES_JAVA_OPTS=&quot;-Xms512m -Xmx512m&quot;</code></li></ul></div></section><h4 id="ä½¿ç”¨-docker-å®‰è£…-metricbeat"><a class="header-anchor" href="#ä½¿ç”¨-docker-å®‰è£…-metricbeat"></a>ä½¿ç”¨ Docker å®‰è£… MetricBeat</h4><section class="sample"><p><strong><em>è·å–é…ç½®æ–‡ä»¶</em></strong></p><ul><li>ä¸‹è½½ <code>$ wget https://artifacts.elastic.co/downloads/beats/metricbeat/metricbeat-7.4.1-linux-x86_64.tar.gz</code></li><li>è§£å‹ <code>$ tar zxvf metricbeat-7.4.1-linux-x86_64.tar.gz</code></li><li>æå– <code>metricbeat.yml modules.d</code></li></ul><p><strong><em>ä½¿ç”¨ Docker Compose</em></strong><br><code>$ vim docker-compose.yml</code></p><pre><code class="language-yml">version: '2'services:  metricbeat:    image: docker.elastic.co/beats/metricbeat:7.4.1    container_name: metricbeat    volumes:      - /var/run/docker.sock:/var/run/docker.sock:ro      - /proc:/hostfs/proc:ro      - /sys/fs/cgroup:/hostfs/sys/fs/cgroup:ro      - /:/hostfs:ro      - ./metricbeat/metricbeat.yml:/usr/share/metricbeat/metricbeat.yml:ro      - ./metricbeat/modules.d:/usr/share/metricbeat/modules.d:ro      -  /usr/share/zoneinfo/Asia/Shanghai:/etc/localtime:ro    user: &quot;root&quot;    command: -system.hostfs=/hostfs -e    restart: always</code></pre></section><section class="reference"><p><code>docker exec -it metricbeat metricbeat modules enable system</code><script src="https://cdn.bootcss.com/raphael/2.3.0/raphael.min.js"></script><script src="https://cdn.bootcss.com/flowchart/1.12.2/flowchart.min.js"></script><textarea id="flowchart-0-code" style="display: none">op0=>operation: Dataï¼ˆLogï¼‰op1=>operation: MetricBeatop2=>operation: Redisop3=>operation: Logstashop4=>operation: ElasticSearchop5=>operation: Kibanaop0(right)->op2op1(right)->op4op2(right)->op3op3(right)->op4op4(right)->op5</textarea><textarea id="flowchart-0-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-0-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-0", options);</script></p></section>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;elk-æ˜¯ä»€ä¹ˆ&quot;&gt;&lt;a class=&quot;header-anchor&quot; href=&quot;#elk-æ˜¯ä»€ä¹ˆ&quot;&gt;&lt;/a&gt;ELK æ˜¯ä»€ä¹ˆ?&lt;/h2&gt;
&lt;section class=&quot;reference&quot;&gt;
&lt;ul&gt;
&lt;li&gt;æ˜¯ ElasticSearchã€Logstashã€Ki
      
    
    </summary>
    
    
      <category term="DevOps" scheme="http://www.lockey.xyz/categories/DevOps/"/>
    
    
      <category term="ELK" scheme="http://www.lockey.xyz/tags/ELK/"/>
    
      <category term="ElasticSearch" scheme="http://www.lockey.xyz/tags/ElasticSearch/"/>
    
      <category term="Logstash" scheme="http://www.lockey.xyz/tags/Logstash/"/>
    
      <category term="Kibana" scheme="http://www.lockey.xyz/tags/Kibana/"/>
    
      <category term="MetricBeat" scheme="http://www.lockey.xyz/tags/MetricBeat/"/>
    
      <category term="æ—¥å¿—" scheme="http://www.lockey.xyz/tags/%E6%97%A5%E5%BF%97/"/>
    
  </entry>
  
  <entry>
    <title>Zabbix</title>
    <link href="http://www.lockey.xyz/2019/12/13/DevOps/Zabbix/"/>
    <id>http://www.lockey.xyz/2019/12/13/DevOps/Zabbix/</id>
    <published>2019-12-13T07:07:21.000Z</published>
    <updated>2019-12-13T08:26:19.861Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯-zabbix-ï¼Ÿ"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-zabbix-ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ Zabbix ï¼Ÿ</h2><section class="reference"><p>Zabbix æ˜¯ä¸€ç§ç³»ç»Ÿç›‘æ§ã€‚ç½‘ç»œç›‘æ§ã€æœåŠ¡ç›‘æ§å·¥å…·ã€‚</p></section><h4 id="ç›‘æ§å¯¹è±¡"><a class="header-anchor" href="#ç›‘æ§å¯¹è±¡"></a>ç›‘æ§å¯¹è±¡</h4><section class="reference"><ul><li>ä¸»æœº</li><li>è½¯ä»¶</li></ul></section><h4 id="æ¨¡å—åŠŸèƒ½"><a class="header-anchor" href="#æ¨¡å—åŠŸèƒ½"></a>æ¨¡å—åŠŸèƒ½</h4><section class="reference"><ul><li>Monitoring<ul><li>ä¿¡æ¯èšåˆ</li><li>çŠ¶æ€å±•ç¤º</li><li>ä¿¡æ¯æŸ¥è¯¢</li><li>ç›‘æ§ç»Ÿè®¡</li></ul></li><li>Inventory<ul><li>èµ„äº§ä¿¡æ¯<ul><li>ç®¡ç†</li><li>æŸ¥è¯¢</li></ul></li></ul></li><li>Report<ul><li>æŠ¥è¡¨</li><li>å®¡è®¡</li><li>æ—¥å¿—</li></ul></li><li>Configuration<ul><li>ä¸»æœºä¿¡æ¯é…ç½®</li><li>ç›‘æ§è§„åˆ™é…ç½®</li><li>æŠ¥è­¦è§„åˆ™é…ç½®</li><li>ç»Ÿè®¡å›¾è¡¨é…ç½®</li><li>è‡ªåŠ¨å‘ç°é…ç½®</li></ul></li><li>Administrator<ul><li>ç”¨æˆ·æƒé™ç®¡ç†</li><li>æŠ¥è­¦æ–¹å¼é…ç½®</li><li>è„šæœ¬é…ç½®</li><li>ä»£ç†é…ç½®</li></ul></li><li>Personal<ul><li>æ¥æ”¶æŠ¥è­¦é…ç½®</li><li>æ¥æ”¶æŠ¥è­¦è§„åˆ™</li><li>ä¸ªäººä¿¡æ¯ç®¡ç†</li></ul></li></ul></section><h2 id="zabbix-ç‰¹ç‚¹"><a class="header-anchor" href="#zabbix-ç‰¹ç‚¹"></a>Zabbix ç‰¹ç‚¹</h2><section class="reference"><ul><li>å®‰è£…ç®€å•</li><li>ç›‘æ§æ–¹ä¾¿</li><li>å…è´¹å¼€æº</li><li>è‡ªåŠ¨åŒ–</li><li>C/S ç»“æ„ã€åˆ†å¸ƒå¼æ¶æ„</li></ul></section><h2 id="ä¸åŒç±»å‹æ¯”è¾ƒ"><a class="header-anchor" href="#ä¸åŒç±»å‹æ¯”è¾ƒ"></a>ä¸åŒç±»å‹æ¯”è¾ƒ</h2><section class="reference"><table><thead><tr><th>ç³»ç»Ÿåç§°</th><th>é»˜è®¤ç›‘æ§</th><th>è‡ªå®šä¹‰ç›‘æ§</th><th>æ‰¹é‡ç›‘æ§</th><th>ä¿®æ”¹ç›‘æ§</th><th>å›¾è¡¨</th><th>æŠ¥è­¦</th><th>å…¶ä»–</th></tr></thead><tbody><tr><td>Zabbix</td><td>è‡ªå¸¦ç›‘æ§å¤š</td><td>å¯è‡ªå®šä¹‰ç¼–å†™æ’ä»¶</td><td>server ç«¯å¯é…ç½®è‡ªåŠ¨æ³¨å†Œè§„åˆ™ï¼›client ç«¯æ— éœ€æ“ä½œ</td><td>æ‰‹åŠ¨åœ¨æ¨¡æ¿ä¸­æ–°å¢ç›‘æ§</td><td>è‡ªå¸¦å›¾è¡¨æ’ä»¶</td><td>æ”¯æŒå¤šç§æŠ¥è­¦ï¼Œä¾èµ–æ’ä»¶</td><td>è‡ªå¸¦ Web ç›‘æ§</td></tr><tr><td>Nagios</td><td>è‡ªå¸¦ç›‘æ§å°‘</td><td>å¯è‡ªå®šä¹‰ç¼–å†™æ’ä»¶</td><td>ç”¨è„šæœ¬åœ¨ server ç«¯æ–°å¢ hostï¼Œ å¹¶æ‹·è´ service æ–‡ä»¶</td><td>ç”¨è„šæœ¬ä¿®æ”¹æ‰€æœ‰ä¸»æœºçš„ service æ–‡ä»¶ï¼ŒåŠ å…¥æ–°å¢æœåŠ¡</td><td>å¯ä»¥æŒ‰ç…§å›¾è¡¨æ’ä»¶</td><td>æ”¯æŒå¤šç§æŠ¥è­¦ï¼Œä¾èµ–æ’ä»¶</td><td></td></tr></tbody></table><hr><div class="info"><ul><li>Zabbix ä½¿ç”¨æ›´å‹å¥½ï¼Œæ¢ç´¢åŠŸèƒ½éœ€è¦è¾ƒå¤šæ—¶é—´ï¼Œå­¦ä¹ æˆæœ¬è¾ƒå¤§</li><li>Nagios å®¹æ˜“ä¸Šæ‰‹ï¼Œè„šæœ¬å¾ˆå¼ºå¤§ï¼Œä½†å†™èµ·æ¥ä¹Ÿè´¹æ—¶è´¹åŠ›</li></ul></div></section><h2 id="æ¶æ„å›¾"><a class="header-anchor" href="#æ¶æ„å›¾"></a>æ¶æ„å›¾</h2><section class="reference"><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/images/DevOps/Zabbixæ¶æ„.png" alt="" title="">                </div>                <div class="image-caption"></div>            </figure></section><h4 id="éƒ¨ç½²æ–¹å¼"><a class="header-anchor" href="#éƒ¨ç½²æ–¹å¼"></a>éƒ¨ç½²æ–¹å¼</h4><section class="reference"><ul><li>ç½‘ç»œåè®®æ¨¡å¼ï¼šserver-client</li><li>ä»£ç†æ¨¡å¼ï¼šserver-proxy-client</li><li>èŠ‚ç‚¹æ¨¡å¼ï¼šmaster-node-client</li></ul></section><h2 id="ä½¿ç”¨"><a class="header-anchor" href="#ä½¿ç”¨"></a>ä½¿ç”¨</h2><section class="reference"></section><h4 id="å®‰è£…"><a class="header-anchor" href="#å®‰è£…"></a>å®‰è£…</h4><section class="reference"><ol><li>æ‰“å¼€<a href="https://www.zabbix.com/download" target="_blank" rel="noopener">å®˜ç½‘ä¸‹è½½é¡µé¢</a></li><li>é€‰æ‹©æ“ä½œç³»ç»Ÿ</li><li>æŒ‰å¼•å¯¼å®‰è£…<ol><li>å®‰è£… Server ç«¯<ol><li>æ·»åŠ æº</li><li>å®‰è£… Server</li><li>å®‰è£… MySQL</li><li>åˆå§‹åŒ– MySQL</li><li>å¯åŠ¨ zabbix-server</li></ol></li><li>å®‰è£… Web ç«¯<ol><li>å®‰è£… Web</li><li>é…ç½® timezoneï¼š<ol><li><code>$ vim /etc/php-fpm.d/zabbix.conf</code></li><li><code>; php_value[date.timezone] = Asian/Shanghai</code></li></ol></li><li>å¯åŠ¨ [httpd|nginx|apache2] php-fpm</li><li>æ‰“å¼€ <code>http://[ip]/zabbix</code><ol><li>é»˜è®¤ç”¨æˆ·å¯†ç ï¼š<code>Admin : zabbix</code></li></ol></li></ol></li><li>å®‰è£… Agent ç«¯<ol><li>æ·»åŠ æº</li><li>å®‰è£… Agent</li><li>é…ç½®è¿æ¥çš„ Server<ol><li><code>$ vim /etc/zabbix/zabbix_agentd.conf</code></li></ol></li><li>å¯åŠ¨ zabbix-agent</li></ol></li></ol></li></ol><p><strong><em>è¸©å‘æŒ‡å—</em></strong></p><div class="warning"><ul><li>Mariadb ä»£æ›¿ MySQL</li><li>å…³é—­ SeLinuxï¼Œå¦åˆ™å¯èƒ½å‡ºç°ï¼šcannot set resource limit</li><li>é»˜è®¤ä½¿ç”¨ httpd ä½œä¸º Web æœåŠ¡</li></ul></div></section><h4 id="web-ä½¿ç”¨"><a class="header-anchor" href="#web-ä½¿ç”¨"></a>Web ä½¿ç”¨</h4><section class="reference"><p><strong><em>é…ç½®è‡ªåŠ¨å‘ç°</em></strong></p><div id="flowchart-0" class="flow-chart"></div><p><strong><em>é…ç½®æŠ¥è­¦</em></strong></p><div id="flowchart-1" class="flow-chart"></div><p><strong><em>é…ç½®å‘é€æŠ¥è­¦</em></strong></p><div id="flowchart-2" class="flow-chart"></div><p><strong><em>é…ç½®æ¥æ”¶æŠ¥è­¦</em></strong></p><div id="flowchart-3" class="flow-chart"></div><p><strong><em>é…ç½®ç»Ÿè®¡å›¾è¡¨</em></strong></p><div id="flowchart-4" class="flow-chart"></div><p><strong><em>é…ç½®èšåˆå›¾è¡¨</em></strong></p><div id="flowchart-5" class="flow-chart"></div><p><strong><em>ç”¨æˆ·ç®¡ç†</em></strong></p><div id="flowchart-6" class="flow-chart"></div><p><strong><em>é…ç½®èšåˆå›¾è¡¨</em></strong></p><div id="flowchart-7" class="flow-chart"></div></section><h4 id="é€šç”¨è®¾ç½®å¥—è·¯"><a class="header-anchor" href="#é€šç”¨è®¾ç½®å¥—è·¯"></a>é€šç”¨è®¾ç½®å¥—è·¯</h4><section class="reference"><div id="flowchart-8" class="flow-chart"></div></section><h4 id="web-api"><a class="header-anchor" href="#web-api"></a>Web API</h4><section class="reference"></section><h5 id="åŠŸèƒ½"><a class="header-anchor" href="#åŠŸèƒ½"></a>åŠŸèƒ½</h5><section class="reference"><ul><li>è¿œç¨‹ç®¡ç† Zabbix é…ç½®</li><li>è¿œç¨‹æ£€ç´¢é…ç½®å’Œå†å²æ•°æ®</li></ul></section><h5 id="æ¥å…¥æ–¹å¼"><a class="header-anchor" href="#æ¥å…¥æ–¹å¼"></a>æ¥å…¥æ–¹å¼</h5><section class="reference"><ul><li><code>http://[ip]:[port]/zabbix/api_jsonrpc.php</code><ul><li>ä½¿ç”¨ JSON-RPC å®ç°</li><li>æ•°æ®ä¼ è¾“ä»¥ JSON æ ¼å¼</li></ul></li><li>Headers<ul><li><code>Content-Type: application/json-rpc</code></li><li><code>Content-Type: application/json</code></li><li><code>Content-Type: application/jsonrequest</code></li></ul></li></ul></section><h5 id="æ¥å…¥æ­¥éª¤"><a class="header-anchor" href="#æ¥å…¥æ­¥éª¤"></a>æ¥å…¥æ­¥éª¤</h5><section class="reference"><ul><li>ç™»å½•è·å– token</li><li>è¯·æ±‚å¤´å¸¦å…¥ Authorization: [token]</li></ul><p><strong><em>å‚è€ƒèµ„æ–™</em></strong><br><a href="https://coding.imooc.com/class/239.html#Anchor" target="_blank" rel="noopener">ä¸­å°å‹ä¼ä¸šé€šç”¨è‡ªåŠ¨åŒ–è¿ç»´æ¶æ„</a><br><a href="https://blog.csdn.net/u010285974/article/details/86702421" target="_blank" rel="noopener">zabbixä¸nagioså¯¹æ¯”</a><script src="https://cdn.bootcss.com/raphael/2.3.0/raphael.min.js"></script><script src="https://cdn.bootcss.com/flowchart/1.12.2/flowchart.min.js"></script><textarea id="flowchart-0-code" style="display: none">op1=>operation: Configurationop2=>operation: Discovery   op3=>operation: Create Discovery Rulesop4=>operation: Create Rulesop1(right)->op2op2(right)->op3op3(right)->op4</textarea><textarea id="flowchart-0-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-0-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-0", options);</script><textarea id="flowchart-1-code" style="display: none">op1=>operation: Configurationop2=>operation: Create Action   op3=>operation: Create Conditionop4=>operation: Create Operationop1(right)->op2op2(right)->op3op3(right)->op4</textarea><textarea id="flowchart-1-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-1-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-1-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-1", options);</script><textarea id="flowchart-2-code" style="display: none">op1=>operation: Administratorop2=>operation: Media Typeop3=>operation: Emailop4=>operation: Updateop1(right)->op2op2(right)->op3op3(right)->op4</textarea><textarea id="flowchart-2-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-2-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-2-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-2", options);</script><textarea id="flowchart-3-code" style="display: none">op1=>operation: Administratorop2=>operation: Usersop3=>operation: Adminop4=>operation: Mediaop5=>operation: Addop1(right)->op2op2(right)->op3op3(right)->op4op4(right)->op5</textarea><textarea id="flowchart-3-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-3-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-3-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-3", options);</script><textarea id="flowchart-4-code" style="display: none">op1=>operation: Configurationop2=>operation: Hostsop3=>operation: Graphsop4=>operation: æ¡ç›®é€‰æ‹©op1(right)->op2op2(right)->op3op3(right)->op4</textarea><textarea id="flowchart-4-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-4-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-4-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-4", options);</script><textarea id="flowchart-5-code" style="display: none">op1=>operation: Monitoringop2=>operation: Screensop3=>operation: Addop4=>operation: Edit Screenop1(right)->op2op2(right)->op3op3(right)->op4</textarea><textarea id="flowchart-5-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-5-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-5-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-5", options);</script><textarea id="flowchart-6-code" style="display: none">op1=>operation: Administratorop2=>operation: Usersop3=>operation: User Groupsop1(right)->op2op2(right)->op3</textarea><textarea id="flowchart-6-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-6-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-6-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-6", options);</script><textarea id="flowchart-7-code" style="display: none">op1=>operation: Monitoringop2=>operation: Screensop3=>operation: Addop4=>operation: Edit Screenop1(right)->op2op2(right)->op3op3(right)->op4</textarea><textarea id="flowchart-7-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-7-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-7-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-7", options);</script><textarea id="flowchart-8-code" style="display: none">op1=>operation: åˆ›å»ºç›‘æ§è„šæœ¬op2=>operation: åˆ›å»º Zabbix Itemop3=>operation: åˆ›å»º Zabbix Triggerop4=>operation: åˆ›å»º Zabbix Actionop1(right)->op2op2(right)->op3op3(right)->op4</textarea><textarea id="flowchart-8-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-8-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-8-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-8", options);</script></p></section>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ä»€ä¹ˆæ˜¯-zabbix-ï¼Ÿ&quot;&gt;&lt;a class=&quot;header-anchor&quot; href=&quot;#ä»€ä¹ˆæ˜¯-zabbix-ï¼Ÿ&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯ Zabbix ï¼Ÿ&lt;/h2&gt;
&lt;section class=&quot;reference&quot;&gt;
&lt;p&gt;Zabbix æ˜¯ä¸€ç§ç³»ç»Ÿç›‘æ§ã€‚ç½‘ç»œç›‘æ§
      
    
    </summary>
    
    
      <category term="DevOps" scheme="http://www.lockey.xyz/categories/DevOps/"/>
    
    
      <category term="è¿ç»´" scheme="http://www.lockey.xyz/tags/%E8%BF%90%E7%BB%B4/"/>
    
      <category term="Zabbix" scheme="http://www.lockey.xyz/tags/Zabbix/"/>
    
      <category term="ç›‘æ§" scheme="http://www.lockey.xyz/tags/%E7%9B%91%E6%8E%A7/"/>
    
  </entry>
  
  <entry>
    <title>äº‘è®¡ç®—</title>
    <link href="http://www.lockey.xyz/2019/12/10/DevOps/%E4%BA%91%E8%AE%A1%E7%AE%97/"/>
    <id>http://www.lockey.xyz/2019/12/10/DevOps/%E4%BA%91%E8%AE%A1%E7%AE%97/</id>
    <published>2019-12-10T07:43:55.000Z</published>
    <updated>2019-12-10T09:14:08.009Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ¦‚å¿µ"><a class="header-anchor" href="#æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><section class="reference"><p>äº‘è®¡ç®—ï¼ˆcloud computingï¼‰æ˜¯åˆ†å¸ƒå¼è®¡ç®—çš„ä¸€ç§ï¼ŒæŒ‡çš„æ˜¯é€šè¿‡ç½‘ç»œâ€œäº‘â€å°†å·¨å¤§çš„æ•°æ®è®¡ç®—å¤„ç†ç¨‹åºåˆ†è§£æˆæ— æ•°ä¸ªå°ç¨‹åºï¼Œç„¶åï¼Œé€šè¿‡å¤šéƒ¨æœåŠ¡å™¨ç»„æˆçš„ç³»ç»Ÿè¿›è¡Œå¤„ç†å’Œåˆ†æè¿™äº›å°ç¨‹åºå¾—åˆ°ç»“æœå¹¶è¿”å›ç»™ç”¨æˆ·ã€‚äº‘è®¡ç®—æ—©æœŸï¼Œç®€å•åœ°è¯´ï¼Œå°±æ˜¯ç®€å•çš„åˆ†å¸ƒå¼è®¡ç®—ï¼Œè§£å†³ä»»åŠ¡åˆ†å‘ï¼Œå¹¶è¿›è¡Œè®¡ç®—ç»“æœçš„åˆå¹¶ã€‚å› è€Œï¼Œäº‘è®¡ç®—åˆç§°ä¸ºç½‘æ ¼è®¡ç®—ã€‚é€šè¿‡è¿™é¡¹æŠ€æœ¯ï¼Œå¯ä»¥åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…ï¼ˆå‡ ç§’ç§ï¼‰å®Œæˆå¯¹æ•°ä»¥ä¸‡è®¡çš„æ•°æ®çš„å¤„ç†ï¼Œä»è€Œè¾¾åˆ°å¼ºå¤§çš„ç½‘ç»œæœåŠ¡ã€‚<br>ç°é˜¶æ®µæ‰€è¯´çš„äº‘æœåŠ¡å·²ç»ä¸å•å•æ˜¯ä¸€ç§åˆ†å¸ƒå¼è®¡ç®—ï¼Œè€Œæ˜¯åˆ†å¸ƒå¼è®¡ç®—ã€æ•ˆç”¨è®¡ç®—ã€è´Ÿè½½å‡è¡¡ã€å¹¶è¡Œè®¡ç®—ã€ç½‘ç»œå­˜å‚¨ã€çƒ­å¤‡ä»½å†—æ‚å’Œè™šæ‹ŸåŒ–ç­‰è®¡ç®—æœºæŠ€æœ¯æ··åˆæ¼”è¿›å¹¶è·ƒå‡çš„ç»“æœã€‚</p></section><h2 id="ç‰¹ç‚¹"><a class="header-anchor" href="#ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h2><section class="reference"><ul><li>è™šæ‹ŸåŒ–(è®¡ç®—ã€å­˜å‚¨ã€ç½‘ç»œç­‰)</li><li>äº§å“æœåŠ¡åŒ–(IaaSã€PaaSã€SaaSâ€¦â€¦)</li><li>å¼¹æ€§ä¼¸ç¼©</li></ul></section><h2 id="æ¶æ„"><a class="header-anchor" href="#æ¶æ„"></a>æ¶æ„</h2><section class="reference"><ul><li>åŸºç¡€è®¾æ–½å±‚(IaaS)</li><li>å¹³å°å±‚(PaaS)</li><li>è½¯ä»¶æœåŠ¡å±‚(SaaS)</li></ul><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/images/DevOps/äº‘æ¶æ„.jpg" alt="" title="">                </div>                <div class="image-caption"></div>            </figure></section><h2 id="åˆ†ç±»"><a class="header-anchor" href="#åˆ†ç±»"></a>åˆ†ç±»</h2><section class="reference"><ul><li>ç§æœ‰äº‘</li><li>å…¬æœ‰äº‘</li><li>æ··åˆäº‘</li></ul><p><strong><em>è¤æ®µå­è®º</em></strong></p><blockquote><p>ç”·äººæ‰¾ä¸ªå¥³å‹æˆ–è€å©†æ˜¯è‡ªå»º<strong>ç§æœ‰äº‘</strong>ï¼Œå•èº«çº¦ç‚®æˆ–è€…åˆ°å¨±ä¹åœºæ‰€æ¶ˆè´¹æ˜¯<strong>å…¬æœ‰äº‘</strong>æœåŠ¡ï¼ŒæŒ‰éœ€ä½¿ç”¨å¹¶å¯å¼¹æ€§æ‰©å®¹ï¼Œå·²å©šç”·äººæ‰¾äºŒå¥¶å°èœœåˆ™å±äº<strong>æ··åˆäº‘</strong>ã€‚</p></blockquote></section>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;æ¦‚å¿µ&quot;&gt;&lt;a class=&quot;header-anchor&quot; href=&quot;#æ¦‚å¿µ&quot;&gt;&lt;/a&gt;æ¦‚å¿µ&lt;/h2&gt;
&lt;section class=&quot;reference&quot;&gt;
&lt;p&gt;äº‘è®¡ç®—ï¼ˆcloud computingï¼‰æ˜¯åˆ†å¸ƒå¼è®¡ç®—çš„ä¸€ç§ï¼ŒæŒ‡çš„æ˜¯é€šè¿‡ç½‘ç»œâ€œäº‘â€å°†å·¨å¤§çš„æ•°æ®è®¡ç®—å¤„
      
    
    </summary>
    
    
      <category term="DevOps" scheme="http://www.lockey.xyz/categories/DevOps/"/>
    
    
      <category term="äº‘è®¡ç®—" scheme="http://www.lockey.xyz/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/"/>
    
  </entry>
  
  <entry>
    <title>DevOps</title>
    <link href="http://www.lockey.xyz/2019/12/09/DevOps/DevOps/"/>
    <id>http://www.lockey.xyz/2019/12/09/DevOps/DevOps/</id>
    <published>2019-12-09T10:06:13.000Z</published>
    <updated>2019-12-11T06:59:24.359Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰ç½®çŸ¥è¯†"><a class="header-anchor" href="#å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h2><section class="reference"><a href="/2019/12/10/DevOps/%E4%BA%91%E8%AE%A1%E7%AE%97/" title="äº‘è®¡ç®—">äº‘è®¡ç®—</a></section><h2 id="æ¦‚å¿µ"><a class="header-anchor" href="#æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><section class="reference"><p><code>DevOps = Development(å¼€å‘äººå‘˜) + Operations(è¿ç»´äººå‘˜)</code></p><p>DevOps æ˜¯ä¸€ç§é‡è§†â€œå¼€å‘äººå‘˜â€å’Œâ€œè¿ç»´äººå‘˜â€ä¹‹é—´æ²Ÿé€šåˆä½œçš„æ–‡åŒ–ã€è¿åŠ¨æˆ–è€…æƒ¯ä¾‹ã€‚é€šè¿‡è‡ªåŠ¨åŒ–â€œè½¯ä»¶äº¤ä»˜â€å’Œâ€œæ¶æ„å˜æ›´â€çš„æµç¨‹ï¼Œä½¿æ„å»ºã€æµ‹è¯•ã€å‘å¸ƒè½¯ä»¶èƒ½æ›´å¿«ã€æ›´é¢‘ç¹å’Œæ›´å¯é ã€‚</p><p><strong><em>å„éƒ¨é—¨å…³ç³»å›¾</em></strong></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/images/DevOps/DevOps.jpg" alt="" title="">                </div>                <div class="image-caption"></div>            </figure></section><h2 id="å¯¹åº”ç”¨ç¨‹åºå‘å¸ƒçš„å½±å“"><a class="header-anchor" href="#å¯¹åº”ç”¨ç¨‹åºå‘å¸ƒçš„å½±å“"></a>å¯¹åº”ç”¨ç¨‹åºå‘å¸ƒçš„å½±å“</h2><section class="reference"><ul><li>å‡å°‘å˜æ›´èŒƒå›´</li><li>æ¶ˆé™¤ç­‰å¾…ã€å¿«é€Ÿåé¦ˆ</li><li>ä½¿é—®é¢˜å®šä½ã€è°ƒè¯•å˜å¾—ç®€å•</li><li>åŠ å¼ºå‘å¸ƒè°è°ƒï¼Œæå‡äº¤ä»˜è´¨é‡</li><li>è‡ªåŠ¨åŒ–ï¼Œç¨³å®šã€å¿«é€Ÿã€äº¤ä»˜ç»“æœå¯é¢„æµ‹</li><li>èµ„æºåˆ©ç”¨æœ€å¤§åŒ–</li></ul></section><h2 id="å…³é”®ç‚¹"><a class="header-anchor" href="#å…³é”®ç‚¹"></a>å…³é”®ç‚¹</h2><section class="reference"><blockquote><ol><li>Automated infrastructureï¼ˆè‡ªåŠ¨åŒ–ï¼Œç³»ç»Ÿä¹‹é—´çš„é›†æˆï¼‰</li><li>shared version controlï¼ˆSVNå…±äº«æºç ï¼‰</li><li>one step build and deployï¼ˆæŒç»­æ„å»ºå’Œéƒ¨ç½²ï¼‰</li><li>feature flagsï¼ˆä¸»å¹²å¼€å‘ï¼‰</li><li>Shared metrics</li><li>IRC and IM robotsï¼ˆä¿¡æ¯æ•´åˆï¼‰</li></ol></blockquote><ul><li>CI/CD ä¸€çº¿è´¯ç©¿ä»¥ä¸ŠæŠ€æœ¯è¦ç‚¹</li><li>ä¸»å¹²å¼€å‘æ˜¯ CI çš„å‰æ</li><li>è‡ªåŠ¨åŒ–ä»¥åŠä»£ç å‘¨è¾¹é›†ä¸­ç®¡ç†æ˜¯å®æ–½ CI çš„å¿…è¦æ¡ä»¶</li></ul><div class="warning"><p>CI/CD æ˜¯ DevOps çš„æŠ€æœ¯æ ¸å¿ƒï¼Œåœ¨æ²¡æœ‰è‡ªåŠ¨åŒ–æµ‹è¯•ã€CI/CD ä¹‹ä¸‹ï¼ŒDevOps å°±æ˜¯ç©ºä¸­æ¥¼é˜</p></div></section><h2 id="å·¥ä½œæµ"><a class="header-anchor" href="#å·¥ä½œæµ"></a>å·¥ä½œæµ</h2><section class="reference"><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/images/DevOps/DevOpså›è·¯.jpg" alt="" title="">                </div>                <div class="image-caption"></div>            </figure></section><h2 id="å·¥å…·ç®±"><a class="header-anchor" href="#å·¥å…·ç®±"></a>å·¥å…·ç®±</h2><section class="reference"><ul><li>ä»£ç ç®¡ç†ï¼ˆSCMï¼‰<ul><li>GitHubã€GitLabã€BitBucketã€SubVersion</li></ul></li><li>æ„å»ºå·¥å…·<ul><li>Antã€Gradleã€maven</li></ul></li><li>è‡ªåŠ¨éƒ¨ç½²<ul><li>Capistranoã€CodeDeployã€Ansibleã€Jenkins</li></ul></li><li>æŒç»­é›†æˆï¼ˆCIï¼‰<ul><li>Bambooã€Hudsonã€Jenkins</li></ul></li><li>é…ç½®ç®¡ç†<ul><li>Ansibleã€Chefã€Puppetã€SaltStackã€ScriptRock GuardRailã€Consulã€Apollo</li></ul></li><li>å®¹å™¨<ul><li>Dockerã€LXCã€ç¬¬ä¸‰æ–¹å‚å•†å¦‚AWS</li></ul></li><li>ç¼–æ’<ul><li>Kubernetesã€Coreã€Apache Mesosã€DC/OS</li></ul></li><li>æœåŠ¡æ³¨å†Œä¸å‘ç°<ul><li>Zookeeperã€etcdã€Consul</li></ul></li><li>è„šæœ¬è¯­è¨€<ul><li>pythonã€rubyã€shell</li></ul></li><li>æ—¥å¿—ç®¡ç†<ul><li>ELKã€Logentries</li></ul></li><li>ç³»ç»Ÿç›‘æ§<ul><li>Datadogã€Graphiteã€Icingaã€Nagios</li></ul></li><li>æ€§èƒ½ç›‘æ§<ul><li>AppDynamicsã€New Relicã€Splunk</li></ul></li><li>å‹åŠ›æµ‹è¯•<ul><li>JMeterã€Blaze Meterã€<a href="http://loader.io" target="_blank" rel="noopener">loader.io</a></li></ul></li><li>é¢„è­¦<ul><li>PagerDutyã€pingdomã€å‚å•†è‡ªå¸¦å¦‚AWS SNS</li></ul></li><li>HTTPåŠ é€Ÿå™¨<ul><li>Varnish</li></ul></li><li>æ¶ˆæ¯æ€»çº¿<ul><li>ActiveMQã€SQS</li></ul></li><li>åº”ç”¨æœåŠ¡å™¨<ul><li>Tomcatã€JBoss</li></ul></li><li>WebæœåŠ¡å™¨<ul><li>Apacheã€Nginxã€IIS</li></ul></li><li>æ•°æ®åº“<ul><li>MySQLã€Oracleã€PostgreSQLç­‰å…³ç³»å‹æ•°æ®åº“ï¼›cassandraã€mongoDBã€redisç­‰NoSQLæ•°æ®åº“</li></ul></li><li>é¡¹ç›®ç®¡ç†ï¼ˆPMï¼‰<ul><li>Jiraã€Asanaã€Taigaã€Trelloã€Basecampã€Pivotal Tracker</li></ul></li></ul><p><strong><em>å‚è€ƒé“¾æ¥</em></strong><br><a href="https://www.jianshu.com/p/47287f203637" target="_blank" rel="noopener">ç»™ DevOps åˆå­¦è€…çš„å…¥é—¨æŒ‡å—</a></p></section>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰ç½®çŸ¥è¯†&quot;&gt;&lt;a class=&quot;header-anchor&quot; href=&quot;#å‰ç½®çŸ¥è¯†&quot;&gt;&lt;/a&gt;å‰ç½®çŸ¥è¯†&lt;/h2&gt;
&lt;section class=&quot;reference&quot;&gt;
&lt;a href=&quot;/2019/12/10/DevOps/%E4%BA%91%E8%AE%A1
      
    
    </summary>
    
    
      <category term="DevOps" scheme="http://www.lockey.xyz/categories/DevOps/"/>
    
    
      <category term="Ansible" scheme="http://www.lockey.xyz/tags/Ansible/"/>
    
      <category term="è‡ªåŠ¨åŒ–" scheme="http://www.lockey.xyz/tags/%E8%87%AA%E5%8A%A8%E5%8C%96/"/>
    
      <category term="è¿ç»´" scheme="http://www.lockey.xyz/tags/%E8%BF%90%E7%BB%B4/"/>
    
  </entry>
  
  <entry>
    <title>Ansible</title>
    <link href="http://www.lockey.xyz/2019/12/09/DevOps/Ansible/"/>
    <id>http://www.lockey.xyz/2019/12/09/DevOps/Ansible/</id>
    <published>2019-12-09T09:45:35.000Z</published>
    <updated>2019-12-13T02:15:13.186Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯-ansible-ï¼Ÿ"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-ansible-ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ Ansible ï¼Ÿ</h2><section class="reference"><ul><li>æ˜¯ä¸€ç§ IT è‡ªåŠ¨åŒ–å·¥å…·</li><li>ä¾èµ–ç°æœ‰çš„æ“ä½œç³»ç»Ÿçš„å‡­è¯æ¥è®¿é—®æ§åˆ¶è¿œç¨‹æœºå™¨</li><li>ç®€å•æ˜“ç”¨ã€å®‰å…¨å¯é </li></ul></section><h2 id="ansible-å¯ä»¥å®Œæˆå“ªäº›ä»»åŠ¡ï¼Ÿ"><a class="header-anchor" href="#ansible-å¯ä»¥å®Œæˆå“ªäº›ä»»åŠ¡ï¼Ÿ"></a>Ansible å¯ä»¥å®Œæˆå“ªäº›ä»»åŠ¡ï¼Ÿ</h2><section class="reference"><ul><li>ç³»ç»Ÿé…ç½®</li><li>å¼€å‘è½¯ä»¶</li><li>ç¼–æ’é«˜çº§çš„ IT ä»»åŠ¡ï¼ˆæŒç»­é›†æˆç­‰ï¼‰</li></ul></section><h2 id="ansible-çš„ä¼˜ç‚¹"><a class="header-anchor" href="#ansible-çš„ä¼˜ç‚¹"></a>Ansible çš„ä¼˜ç‚¹</h2><section class="reference"><ul><li>è½»é‡çº§</li><li>æ˜“å­¦ä¹ </li><li>æ“ä½œçµæ´»</li><li>æ— å®¢æˆ·ç«¯</li><li>æ¨é€å¼</li><li>Module ä¸°å¯Œ</li><li>å•†ä¸šåŒ–æ”¯æŒï¼ˆTowerï¼‰</li></ul></section><h2 id="ansible-çš„ç¼ºç‚¹"><a class="header-anchor" href="#ansible-çš„ç¼ºç‚¹"></a>Ansible çš„ç¼ºç‚¹</h2><section class="reference"><ul><li>æ•ˆç‡ä½ï¼ˆä¸²è¡Œæ‰§è¡Œï¼‰</li><li>æ˜“æŒ‚èµ·</li></ul></section><h2 id="ä¸å…¶ä»–ç±»ä¼¼é¡¹ç›®å¯¹æ¯”"><a class="header-anchor" href="#ä¸å…¶ä»–ç±»ä¼¼é¡¹ç›®å¯¹æ¯”"></a>ä¸å…¶ä»–ç±»ä¼¼é¡¹ç›®å¯¹æ¯”</h2><section class="reference"><table><thead><tr><th>é¡¹ç›®</th><th>å®¢æˆ·ç«¯</th><th>é€šä¿¡æ–¹å¼</th><th>Web é¡µé¢</th><th>æ•ˆç‡</th><th>æ˜“ç”¨</th><th>å®ç°è¯­è¨€</th><th>API</th><th>å¼€æºç¤¾åŒº</th></tr></thead><tbody><tr><td>Ansible</td><td>æ— </td><td>ssh</td><td>æœ‰ï¼ˆTowerï¼‰</td><td>ä½</td><td>é«˜</td><td>Python</td><td>æœ‰</td><td>40.8 K</td></tr><tr><td>Puppet</td><td>æœ‰</td><td>socket</td><td>æœ‰</td><td>ä¸€èˆ¬</td><td>ä½</td><td>Ruby</td><td>æœ‰</td><td>5.6 K</td></tr><tr><td>Chef</td><td>æœ‰</td><td>ssh</td><td>æœ‰</td><td>ä¸€èˆ¬</td><td>é«˜</td><td>Python</td><td>æœ‰</td><td>6.1 K</td></tr><tr><td>Salt</td><td>æœ‰</td><td>RabbitMQ</td><td>æœ‰</td><td>é«˜</td><td>é«˜</td><td>Python</td><td>æœ‰</td><td>10.5 K</td></tr></tbody></table></section><h2 id="ä½¿ç”¨"><a class="header-anchor" href="#ä½¿ç”¨"></a>ä½¿ç”¨</h2><section class="reference"></section><h3 id="å®‰è£…"><a class="header-anchor" href="#å®‰è£…"></a>å®‰è£…</h3><section class="reference"><ul><li>Mac: <code>pip install ansible</code></li></ul></section><h3 id="é…ç½®"><a class="header-anchor" href="#é…ç½®"></a>é…ç½®</h3><section class="reference"><ul><li>Host é…ç½®: <code>/etc/ansible/hosts</code><ul><li>é…ç½®é¡¹: <a href="https://docs.ansible.com/ansible/2.4/ansible-inventory.html" target="_blank" rel="noopener">Inventory</a> | <a href="http://www.ansible.com.cn/docs/intro_inventory.html" target="_blank" rel="noopener">Inventory ä¸­æ–‡</a></li></ul></li><li>ssh é…ç½®: <code>ssh-copy-id -i .ssh/[å…¬é’¥æ–‡ä»¶] [ç”¨æˆ·]@[è¿œç¨‹ä¸»æœº]</code></li></ul></section><h3 id="ad-hoc-playbook"><a class="header-anchor" href="#ad-hoc-playbook"></a>Ad-Hoc &amp; Playbook</h3><section class="reference"><ul><li>ç±»ä¼¼ <code>shell</code> &amp; <code>shell script</code>ï¼Œä½† Playbook æ›´åŠ å¼ºå¤§</li><li>Playbook æ˜¯å¯¹ Ad-Hoc çš„ç¼–æ’</li><li>Ad-Hoc é€‚åˆç®€å•å¿«é€Ÿçš„ä»»åŠ¡</li><li>Playbook é€‚åˆå¤æ‚å¼‚æ­¥çš„ä»»åŠ¡</li><li>Playbook è§£å†³ shell script çš„ç¼–å†™å¤æ‚ã€æ“ä½œç¹çã€è·¨å¹³å°é—®é¢˜</li></ul></section><h4 id="ad-hoc"><a class="header-anchor" href="#ad-hoc"></a>Ad-Hoc</h4><section class="reference"></section><h5 id="è¯­æ³•"><a class="header-anchor" href="#è¯­æ³•"></a>è¯­æ³•</h5><section class="reference"><p><code>ansible [è¿œç¨‹ä¸»æœº | åˆ†ç»„] -m [æ¨¡å—] -a 'æ¨¡å—å‚æ•°'</code></p></section><h4 id="playbook"><a class="header-anchor" href="#playbook"></a>Playbook</h4><section class="reference"></section><h5 id="ä»€ä¹ˆæ˜¯-playbook"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯-playbook"></a>ä»€ä¹ˆæ˜¯ Playbook ?</h5><section class="reference"><ul><li>ç”± YAML ç¼–å†™</li><li>ç®—æ˜¯ä¸€é—¨ç¼–ç¨‹è¯­è¨€</li><li>å‘½ä»¤é›†åˆ</li></ul></section><h5 id="åŠŸèƒ½"><a class="header-anchor" href="#åŠŸèƒ½"></a>åŠŸèƒ½</h5><section class="reference"><ul><li>å£°æ˜é…ç½®</li><li>ç¼–æ’å¤æ‚ä»»åŠ¡</li><li>æ§åˆ¶ä»»åŠ¡æ‰§è¡Œ</li></ul></section><h5 id="è¯­æ³•-v2"><a class="header-anchor" href="#è¯­æ³•-v2"></a>è¯­æ³•</h5><section class="reference"><ul><li>å˜é‡ï¼ˆInventory &amp; Playbookï¼‰<ul><li>vars</li></ul></li><li>æµç¨‹æ§åˆ¶<ul><li>å¾ªç¯<ul><li>with_items</li><li>with_nested (åµŒå¥—)</li></ul></li><li>åˆ¤æ–­<ul><li>when [true, false, not]</li></ul></li></ul></li></ul></section><h5 id="åŸºæœ¬ç»“æ„"><a class="header-anchor" href="#åŸºæœ¬ç»“æ„"></a>åŸºæœ¬ç»“æ„</h5><section class="sample"><ul><li>host: è¢«æ“ä½œçš„æœºå™¨</li><li>remote_user: ç™»å½•æœºå™¨çš„ç”¨æˆ·</li><li>tasks: éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡</li></ul><div class="warning"><p>å¦‚æœè¯­å¥ä»¥ â€œ{â€ å¼€å¤´ï¼Œéœ€è¦ç”¨<strong>å¼•å·</strong>åŒ…èµ·æ¥</p></div><p><strong><em>ä¾‹å­</em></strong><br><code>$ vim test.yml</code></p><pre><code>---- hosts: 192.168.1.111                      // æŒ‡å®šä¸»æœº  remote_user: root                       // æŒ‡å®šåœ¨è¢«ç®¡ç†çš„ä¸»æœºä¸Šæ‰§è¡Œä»»åŠ¡çš„ç”¨æˆ·  tasks:                                  // ä»»åŠ¡åˆ—è¡¨  - name: disable selinux                // ä»»åŠ¡å    command: '/sbin/setenforce 0'        // è°ƒç”¨commandæ¨¡å— æ‰§è¡Œå…³é—­é˜²ç«å¢™å‘½ä»¤  - name: start nginx                    // ä»»åŠ¡å    service: name=nginx state=started    // è°ƒç”¨serviceæ¨¡å— å¼€å¯ nginx æœåŠ¡</code></pre></section><section class="reference"><p><code>$ ansible-playbook test.yml</code></p></section>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;ä»€ä¹ˆæ˜¯-ansible-ï¼Ÿ&quot;&gt;&lt;a class=&quot;header-anchor&quot; href=&quot;#ä»€ä¹ˆæ˜¯-ansible-ï¼Ÿ&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯ Ansible ï¼Ÿ&lt;/h2&gt;
&lt;section class=&quot;reference&quot;&gt;
&lt;ul&gt;
&lt;li&gt;æ˜¯ä¸€ç§ IT è‡ªåŠ¨åŒ–
      
    
    </summary>
    
    
      <category term="DevOps" scheme="http://www.lockey.xyz/categories/DevOps/"/>
    
    
      <category term="Ansible" scheme="http://www.lockey.xyz/tags/Ansible/"/>
    
      <category term="è‡ªåŠ¨åŒ–" scheme="http://www.lockey.xyz/tags/%E8%87%AA%E5%8A%A8%E5%8C%96/"/>
    
      <category term="è¿ç»´" scheme="http://www.lockey.xyz/tags/%E8%BF%90%E7%BB%B4/"/>
    
  </entry>
  
  <entry>
    <title>å¼¹æ€§ä¼¸ç¼©</title>
    <link href="http://www.lockey.xyz/2019/12/09/Aliyun/%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9/"/>
    <id>http://www.lockey.xyz/2019/12/09/Aliyun/%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9/</id>
    <published>2019-12-09T06:37:59.000Z</published>
    <updated>2019-12-10T09:42:51.768Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒ½åŠ›"><a class="header-anchor" href="#èƒ½åŠ›"></a>èƒ½åŠ›</h2><section class="reference"><p>æ ¹æ®ä¸šåŠ¡éœ€æ±‚å’Œç­–ç•¥è‡ªåŠ¨è°ƒæ•´å¼¹æ€§è®¡ç®—èµ„æºï¼Œåœ¨ä¸šåŠ¡éœ€æ±‚å¢é•¿æ—¶æ— ç¼å¢åŠ  ECS å®ä¾‹æ»¡è¶³è®¡ç®—éœ€è¦ï¼Œåœ¨ä¸šåŠ¡éœ€æ±‚ä¸‹é™æ—¶è‡ªåŠ¨å‡å°‘ ECS å®ä¾‹èŠ‚çº¦æˆæœ¬ã€‚</p></section><h2 id="ä½¿ç”¨"><a class="header-anchor" href="#ä½¿ç”¨"></a>ä½¿ç”¨</h2><section class="reference"></section><h4 id="æ­¥éª¤"><a class="header-anchor" href="#æ­¥éª¤"></a>æ­¥éª¤</h4><section class="reference"><div id="flowchart-0" class="flow-chart"></div><script src="https://cdn.bootcss.com/raphael/2.3.0/raphael.min.js"></script><script src="https://cdn.bootcss.com/flowchart/1.12.2/flowchart.min.js"></script><textarea id="flowchart-0-code" style="display: none">op1=>operation: åˆ›å»ºä¼¸ç¼©ç»„op2=>operation: åˆ›å»ºä¼¸ç¼©é…ç½®    op3=>operation: å¯ç”¨ä¼¸ç¼©ç»„op4=>operation: åˆ›å»ºä¼¸ç¼©è§„åˆ™op5=>operation: åˆ›å»ºå®šæ—¶ä»»åŠ¡op6=>operation: åˆ›å»ºæŠ¥è­¦ä»»åŠ¡op1(right)->op2op2(right)->op3op3(right)->op4op4(right)->op5op5(right)->op6</textarea><textarea id="flowchart-0-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-0-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-0", options);</script></section>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;èƒ½åŠ›&quot;&gt;&lt;a class=&quot;header-anchor&quot; href=&quot;#èƒ½åŠ›&quot;&gt;&lt;/a&gt;èƒ½åŠ›&lt;/h2&gt;
&lt;section class=&quot;reference&quot;&gt;
&lt;p&gt;æ ¹æ®ä¸šåŠ¡éœ€æ±‚å’Œç­–ç•¥è‡ªåŠ¨è°ƒæ•´å¼¹æ€§è®¡ç®—èµ„æºï¼Œåœ¨ä¸šåŠ¡éœ€æ±‚å¢é•¿æ—¶æ— ç¼å¢åŠ  ECS å®ä¾‹æ»¡è¶³è®¡ç®—éœ€è¦ï¼Œåœ¨ä¸šåŠ¡
      
    
    </summary>
    
    
      <category term="é˜¿é‡Œäº‘" scheme="http://www.lockey.xyz/categories/%E9%98%BF%E9%87%8C%E4%BA%91/"/>
    
    
      <category term="å¼¹æ€§ä¼¸ç¼©" scheme="http://www.lockey.xyz/tags/%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9/"/>
    
  </entry>
  
  <entry>
    <title>Docker-éƒ¨ç½²-Jenkins</title>
    <link href="http://www.lockey.xyz/2019/12/09/DevOps/Docker-%E9%83%A8%E7%BD%B2-Jenkins/"/>
    <id>http://www.lockey.xyz/2019/12/09/DevOps/Docker-%E9%83%A8%E7%BD%B2-Jenkins/</id>
    <published>2019-12-09T01:19:13.000Z</published>
    <updated>2019-12-10T09:15:57.602Z</updated>
    
    <content type="html"><![CDATA[<h2 id="éƒ¨ç½²"><a class="header-anchor" href="#éƒ¨ç½²"></a>éƒ¨ç½²</h2><section class="reference"></section><h4 id="dockerfile"><a class="header-anchor" href="#dockerfile"></a>Dockerfile</h4><section class="sample"><pre><code>FROM jenkins/jenkins:ltsMAINTAINER LockeyUSER rootARG dockerGid=999RUN echo &quot;docker:x:${dockerGid}:jenkins&quot; &gt;&gt; /etc/group</code></pre></section><section class="reference"></section><h4 id="æ„å»º"><a class="header-anchor" href="#æ„å»º"></a>æ„å»º</h4><section class="reference"><p><code>docker build . -t myjenkins</code></p></section><h4 id="è¿è¡Œ"><a class="header-anchor" href="#è¿è¡Œ"></a>è¿è¡Œ</h4><section class="reference"><p><code>docker run -d --privileged=true -p 8005:8080 -p 50000:50000 --name myjenkins_1 -v /root/jenkins:/var/jenkins_home -v /root/.ssh:/var/jenkins_home/.ssh -v /var/run/docker.sock:/var/run/docker.sock -v /var/lib/docker:/var/lib/docker -v $(which docker):/usr/bin/docker -v $(which docker-compose):/usr/bin/docker-compose myjenkins</code></p></section><h2 id="slave"><a class="header-anchor" href="#slave"></a>Slave</h2><section class="reference"><ul><li>å®‰è£…Java(8)<ul><li>apt install openjdk-8-jre-headless</li></ul></li><li>é…ç½®å…å¯†ç™»å½•<ul><li>ssh-keygen -t rsa</li></ul></li></ul><p><strong><em>æ³¨æ„</em></strong></p><ul><li>.sshæ–‡ä»¶æŒ‚è½½<ul><li>Gitè®¿é—®</li><li>Slaveè®¿é—®</li></ul></li><li>Dockerfile<ul><li>å°†ç”¨æˆ·åŠ å…¥dockerç”¨æˆ·ç»„ï¼Œä¸ç„¶æ²¡æœ‰Dockerè®¿é—®æƒé™</li></ul></li></ul></section><h2 id="æ›´æ¢æº-å›½å†…"><a class="header-anchor" href="#æ›´æ¢æº-å›½å†…"></a>æ›´æ¢æºã€å›½å†…ã€‘</h2><section class="reference"><p>æ‰“å¼€ï¼š <code>http[s]://[URL]/pluginManager/advanced</code></p><p>æ›¿æ¢å‡çº§ç«™ç‚¹URLï¼š<code>https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</code></p><p>PSï¼šå¦‚æœå‡ºç°æ›´æ¢åè¿˜æ˜¯èµ°äº†å®˜æ–¹æºï¼Œå¯ä»¥é…ç½® Nginxï¼š<br><code>rewrite ^/download/plugins/(.*)$ https://mirrors.tuna.tsinghua.edu.cn/jenkins/plugins/$1? last;</code></p></section>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;éƒ¨ç½²&quot;&gt;&lt;a class=&quot;header-anchor&quot; href=&quot;#éƒ¨ç½²&quot;&gt;&lt;/a&gt;éƒ¨ç½²&lt;/h2&gt;
&lt;section class=&quot;reference&quot;&gt;&lt;/section&gt;
&lt;h4 id=&quot;dockerfile&quot;&gt;&lt;a class=&quot;header-ancho
      
    
    </summary>
    
    
      <category term="DevOps" scheme="http://www.lockey.xyz/categories/DevOps/"/>
    
    
      <category term="Jenkins" scheme="http://www.lockey.xyz/tags/Jenkins/"/>
    
  </entry>
  
  <entry>
    <title>Gitbook</title>
    <link href="http://www.lockey.xyz/2019/12/05/Gitbook/"/>
    <id>http://www.lockey.xyz/2019/12/05/Gitbook/</id>
    <published>2019-12-05T03:58:04.000Z</published>
    <updated>2019-12-05T10:25:35.796Z</updated>
    
    <content type="html"><![CDATA[<h2 id="dockerfile"><a class="header-anchor" href="#dockerfile"></a>Dockerfile</h2><section class="sample"><pre><code>FROM nodeWORKDIR /buildEXPOSE 4000RUN npm install gitbook -g;RUN npm install gitbook-cli -g;WORKDIR /build/workRUN gitbook initCMD [&quot;gitbook&quot;, &quot;serve&quot;]</code></pre></section><section class="reference"></section><h2 id="æ„å»º"><a class="header-anchor" href="#æ„å»º"></a>æ„å»º</h2><section class="reference"><p><code>$ docker build . -t acgitbook</code></p></section><h2 id="è¿è¡Œ"><a class="header-anchor" href="#è¿è¡Œ"></a>è¿è¡Œ</h2><section class="reference"><p><code>$ docker run -d --name acgitbook_1 -p 8006:4000 -v /root/jenkins/workspace/acdocs/work:/build/work acgitbook /bin/bash -c &quot;gitbook install;gitbook serve&quot;</code></p></section>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;dockerfile&quot;&gt;&lt;a class=&quot;header-anchor&quot; href=&quot;#dockerfile&quot;&gt;&lt;/a&gt;Dockerfile&lt;/h2&gt;
&lt;section class=&quot;sample&quot;&gt;
&lt;pre&gt;&lt;code&gt;FROM node
WORKDIR /b
      
    
    </summary>
    
    
      <category term="å·¥å…·" scheme="http://www.lockey.xyz/categories/%E5%B7%A5%E5%85%B7/"/>
    
      <category term="æ–‡æ¡£ç®¡ç†" scheme="http://www.lockey.xyz/categories/%E5%B7%A5%E5%85%B7/%E6%96%87%E6%A1%A3%E7%AE%A1%E7%90%86/"/>
    
    
      <category term="æ–‡æ¡£å·¥å…·" scheme="http://www.lockey.xyz/tags/%E6%96%87%E6%A1%A3%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
</feed>
